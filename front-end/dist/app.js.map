{
  "version": 3,
  "sources": ["../assets/js/api.js", "../assets/components/site-header.js", "../assets/components/num-router.js", "../assets/components/state-ui.js", "../assets/api_client.js", "../assets/components/app-state.js", "../assets/pages/home-page.js", "../assets/pages/delivery-page.js", "../assets/pages/orders-page.js", "../assets/pages/profile-page.js", "../assets/pages/pay-page.js", "../assets/pages/login-page.js", "../assets/components/date-time-picker.js", "../assets/components/sh-cart.js", "../assets/components/offer-card.js", "../assets/components/offer-list.js", "../assets/components/delivery-cart.js", "../assets/components/offer-modal.js", "../assets/components/confirm-modal.js", "../assets/components/order-confirm.js", "../assets/components/d-orders.js", "../assets/components/del-order-details.js", "../assets/components/delivery-data.js", "../assets/components/del-order-progress.js", "../assets/components/person-detail.js", "../assets/components/courier-card.js", "../assets/components/rating.js"],
  "sourcesContent": ["const originalFetch = window.fetch.bind(window);\r\n\r\nwindow.fetch = (input, init = {}) => {\r\n  // \u2705 Authorization header \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0430\u0430\u0440 \u043D\u044D\u043C\u044D\u0445\u044D\u044D \u0431\u043E\u043B\u0438\u043D\u043E\r\n  // const token = localStorage.getItem(\"auth_token\") || \"\";\r\n\r\n  if (!init.headers) init.headers = {};\r\n  const headers = new Headers(init.headers);\r\n\r\n  // \u274C \u042D\u041D\u042D \u0411\u041B\u041E\u041A\u042B\u0413 \u0423\u0421\u0422\u0413\u0410 / COMMENT\r\n  // if (token && !headers.has(\"Authorization\")) {\r\n  //   headers.set(\"Authorization\", `Bearer ${token}`);\r\n  // }\r\n\r\n  // \u2705 cookie auth-\u0434 \u04AF\u0440\u0433\u044D\u043B\u0436 include\r\n  return originalFetch(input, { credentials: \"include\", ...init, headers });\r\n};", "class SiteHeader extends HTMLElement {\r\n  connectedCallback() {\r\n    this.render = this.render.bind(this);\r\n    this.updateActive = this.updateActive.bind(this);\r\n    this.handleDocClick = this.handleDocClick.bind(this);\r\n    this.handleUserUpdated = this.handleUserUpdated.bind(this);\r\n    this.handleAppStateChanged = this.handleAppStateChanged.bind(this);\r\n    this.loadUser = this.loadUser.bind(this);\r\n\r\n    this.render();\r\n\r\n    window.addEventListener('hashchange', this.updateActive);\r\n    window.addEventListener('user-updated', this.handleUserUpdated);\r\n    window.addEventListener('app-state-changed', this.handleAppStateChanged);\r\n    this.loadUser();\r\n    this.updateActive();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('hashchange', this.updateActive);\r\n    window.removeEventListener('user-updated', this.handleUserUpdated);\r\n    window.removeEventListener('app-state-changed', this.handleAppStateChanged);\r\n    document.removeEventListener('click', this.handleDocClick);\r\n  }\r\n\r\n  getAppState() {\r\n    const state = localStorage.getItem(\"appState\");\r\n    if (state === \"customer\" || state === \"courier\") return state;\r\n    const role = localStorage.getItem(\"authRole\");\r\n    if (role === \"customer\" || role === \"courier\") return role;\r\n    return \"guest\";\r\n  }\r\n\r\n  getNavLinks() {\r\n    const state = this.getAppState();\r\n    const links = [];\r\n\r\n    if (state === \"customer\") {\r\n      links.push({ href: \"#home\", label: \"\u041D\u04AF\u04AF\u0440\", icon: \"home\" });\r\n      links.push({ href: \"#orders\", label: \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430\", icon: \"orders\" });\r\n    }\r\n    if (state === \"courier\") {\r\n      links.push({ href: \"#home\", label: \"\u041D\u04AF\u04AF\u0440\", icon: \"home\" });\r\n      links.push({ href: \"#delivery\", label: \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\", icon: \"delivery\" });\r\n    }\r\n    if (state !== \"guest\") {\r\n      links.push({ href: \"#profile\", label: \"\u041F\u0440\u043E\u0444\u0430\u0439\u043B\", icon: \"profile\" });\r\n    }\r\n\r\n    return links;\r\n  }\r\n\r\n  renderNavLinks() {\r\n    const links = this.getNavLinks();\r\n    return links.map((link) => `\r\n      <a href=\"${link.href}\">\r\n        ${this.getIcon(link.icon)}\r\n        <span>${link.label}</span>\r\n      </a>\r\n    `).join(\"\");\r\n  }\r\n\r\n  getIcon(name) {\r\n    switch (name) {\r\n      case \"orders\":\r\n        return `\r\n          <svg width=\"27\" height=\"28\" viewBox=\"0 0 27 28\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path opacity=\"0.4\" d=\"M8.26012 21.9703C9.1827 21.9703 9.93865 22.7536 9.93883 23.7213C9.93883 24.6776 9.18281 25.4615 8.26012 25.4615C7.32644 25.4613 6.57066 24.6775 6.57066 23.7213C6.57084 22.7537 7.32655 21.9704 8.26012 21.9703ZM20.767 21.9703C21.6894 21.9704 22.4455 22.7536 22.4457 23.7213C22.4457 24.6775 21.6896 25.4614 20.767 25.4615C19.8331 25.4615 19.0765 24.6776 19.0765 23.7213C19.0767 22.7536 19.8333 21.9703 20.767 21.9703Z\" fill=\"#B8BABF\"/>\r\n            <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M22.4456 7.31518C23.1237 7.31518 23.5684 7.55713 24.0131 8.08714C24.4577 8.61714 24.5356 9.37757 24.4355 10.0677L23.3794 17.626C23.1793 19.0789 21.9787 20.1493 20.5669 20.1493H8.4385C6.95997 20.1493 5.73713 18.9741 5.61485 17.4543L4.5921 4.89445L2.91348 4.59489C2.46881 4.51423 2.15754 4.06488 2.23535 3.60401C2.31317 3.13162 2.74672 2.82053 3.20251 2.88966L5.85386 3.30445C6.23182 3.37473 6.50974 3.69619 6.54309 4.08793L6.75431 6.66881C6.78766 7.03865 7.0767 7.31518 7.43243 7.31518H22.4456ZM15.7089 13.3053H18.7882C19.2551 13.3053 19.622 12.9136 19.622 12.4412C19.622 11.9573 19.2551 11.5771 18.7882 11.5771H15.7089C15.242 11.5771 14.8751 11.9573 14.8751 12.4412C14.8751 12.9136 15.242 13.3053 15.7089 13.3053Z\" fill=\"#B8BABF\"/>\r\n          </svg>\r\n        `;\r\n      case \"delivery\":\r\n        return `\r\n          <svg width=\"32\" height=\"28\" viewBox=\"0 0 32 28\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M23.4385 0C23.7214 0 23.9933 0.132431 24.1934 0.368164C24.3933 0.603844 24.5058 0.923595 24.5059 1.25684V3.77051H27.7051C27.9137 3.77053 28.1178 3.84327 28.292 3.97852C28.4662 4.11392 28.6033 4.30714 28.6855 4.5332L31.8857 13.332C31.9426 13.4884 31.9716 13.657 31.9717 13.8271V22.626C31.9717 22.9594 31.8592 23.2789 31.6592 23.5146C31.4592 23.7503 31.1881 23.8828 30.9053 23.8828H28.6201C28.3881 24.9616 27.8576 25.9191 27.1123 26.6025C26.3672 27.2857 25.4499 27.6561 24.5059 27.6562C23.5616 27.6562 22.6437 27.2859 21.8984 26.6025C21.1531 25.9191 20.6227 24.9616 20.3906 23.8828H13.6875C13.4279 25.0676 12.8105 26.1003 11.9512 26.7871C11.0917 27.4739 10.0487 27.7685 9.01855 27.6143C7.98863 27.46 7.04187 26.8681 6.35547 25.9502C5.66899 25.0319 5.29004 23.8498 5.29004 22.626C5.29004 21.4022 5.66899 20.22 6.35547 19.3018C7.04187 18.3838 7.98864 17.7919 9.01855 17.6377C10.0487 17.4835 11.0917 17.778 11.9512 18.4648C12.8105 19.1517 13.4279 20.1843 13.6875 21.3691H20.3906C20.533 20.7285 20.781 20.1268 21.1211 19.5996C21.4612 19.0725 21.8864 18.6299 22.3721 18.2969V2.51367H6.37207V0H23.4385Z\" fill=\"#C4C4C4\"/>\r\n          </svg>\r\n        `;\r\n      case \"profile\":\r\n        return `\r\n          <svg width=\"27\" height=\"28\" viewBox=\"0 0 27 28\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M13.3403 17.4831C18.1633 17.4831 22.2338 18.2955 22.2338 21.4294C22.2338 24.5644 18.1366 25.3483 13.3403 25.3483C8.51842 25.3483 4.44703 24.5357 4.44672 21.402C4.44672 18.2669 8.54382 17.4831 13.3403 17.4831ZM13.3403 2.30438C16.6075 2.30447 19.225 5.01714 19.225 8.40106C19.2248 11.7848 16.6074 14.4977 13.3403 14.4977C10.0742 14.4977 7.45476 11.7848 7.45453 8.40106C7.45453 5.01708 10.0741 2.30438 13.3403 2.30438Z\" fill=\"#B8BABF\"/>\r\n          </svg>\r\n        `;\r\n      case \"home\":\r\n      default:\r\n        return `\r\n          <svg width=\"27\" height=\"27\" viewBox=\"0 0 27 27\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M26.0821 10.6965L14.9138 0.573094C14.9084 0.568518 14.9032 0.563588 14.8985 0.55834C14.4873 0.199078 13.9515 0 13.3956 0C12.8398 0 12.304 0.199078 11.8928 0.55834L11.8775 0.573094L0.72175 10.6965C0.494193 10.8975 0.31255 11.1417 0.188313 11.4137C0.0640769 11.6856 -4.69666e-05 11.9794 2.58096e-08 12.2764V24.6758C2.58096e-08 25.2449 0.235331 25.7907 0.654222 26.1932C1.07311 26.5956 1.64125 26.8217 2.23366 26.8217H8.93462C9.52702 26.8217 10.0952 26.5956 10.5141 26.1932C10.9329 25.7907 11.1683 25.2449 11.1683 24.6758V18.238H15.6356V24.6758C15.6356 25.2449 15.8709 25.7907 16.2898 26.1932C16.7087 26.5956 17.2768 26.8217 17.8692 26.8217H24.5702C25.1626 26.8217 25.7307 26.5956 26.1496 26.1932C26.5685 25.7907 26.8039 25.2449 26.8039 24.6758V12.2764C26.8039 11.9794 26.7398 11.6856 26.6156 11.4137C26.4913 11.1417 26.3097 10.8975 26.0821 10.6965ZM24.5702 24.6758H17.8692V18.238C17.8692 17.6689 17.6339 17.1231 17.215 16.7206C16.7961 16.3182 16.228 16.0921 15.6356 16.0921H11.1683C10.5759 16.0921 10.0077 16.3182 9.58884 16.7206C9.16995 17.1231 8.93462 17.6689 8.93462 18.238V24.6758H2.23366V12.2764L2.24901 12.263L13.4019 2.14364L24.5562 12.2603L24.5716 12.2737L24.5702 24.6758Z\" fill=\"#A6A6A6\"/>\r\n          </svg>\r\n        `;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const isAuthed = Boolean(this.currentUser);\r\n\r\n    document.removeEventListener(\"click\", this.handleDocClick);\r\n\r\n    const logoPng = \"assets/img/logo_light_last.png\";\r\n    const logoWebp = \"assets/img/logo_light_last.webp\";\r\n\r\n    this.innerHTML = `\r\n      <header class=\"site-top\">\r\n        <div class=\"brand\">\r\n          <picture>\r\n            <source srcset=\"${logoWebp}\" type=\"image/webp\" />\r\n            <img src=\"${logoPng}\" alt=\"Logo\" class=\"brand-logo\" width=\"272\" height=\"74\" decoding=\"async\" fetchpriority=\"high\" />\r\n          </picture>\r\n        </div>\r\n\r\n        <nav class=\"top-menu\">\r\n          ${this.renderNavLinks()}\r\n        </nav>\r\n\r\n        <div class=\"header-actions\">\r\n          ${isAuthed\r\n        ? `\r\n                <div class=\"avatar-menu\">\r\n                  <button class=\"avatar-btn\" type=\"button\" aria-label=\"\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0446\u044D\u0441 \u043D\u044D\u044D\u0445\"></button>\r\n                  <div class=\"avatar-dropdown\" role=\"menu\" aria-label=\"\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0446\u044D\u0441\">\r\n                    <button class=\"avatar-action avatar-logout\" type=\"button\" role=\"menuitem\">\u0413\u0430\u0440\u0430\u0445</button>\r\n                  </div>\r\n                </div>\r\n                <button class=\"logout-btn\" type=\"button\">\u0413\u0430\u0440\u0430\u0445</button>\r\n              `\r\n        : `<button class=\"login-btn\" type=\"button\">\u041D\u044D\u0432\u0442\u0440\u044D\u0445</button>`\r\n      }\r\n        </div>\r\n      </header>\r\n    `;\r\n\r\n    const loginBtn = this.querySelector(\".login-btn\");\r\n    if (loginBtn) {\r\n      loginBtn.addEventListener(\"click\", () => {\r\n        location.hash = \"#login\";\r\n      });\r\n    }\r\n\r\n    if (window.matchMedia) {\r\n      const media = window.matchMedia(\"(prefers-color-scheme: dark)\");\r\n      const logo = this.querySelector(\".brand-logo\");\r\n      if (logo) {\r\n        const updateLogo = () => {\r\n          logo.src = logoPng;\r\n        };\r\n        updateLogo(media);\r\n        if (media.addEventListener) {\r\n          media.addEventListener(\"change\", updateLogo);\r\n        } else {\r\n          media.addListener(updateLogo);\r\n        }\r\n      }\r\n    }\r\n\r\n    const avatarBtn = this.querySelector(\".avatar-btn\");\r\n    if (avatarBtn) {\r\n      avatarBtn.innerHTML = `<img src=\"assets/img/profile.jpg\" alt=\"\u041F\u0440\u043E\u0444\u0430\u0439\u043B\" width=\"40\" height=\"40\" decoding=\"async\">`;\r\n      avatarBtn.addEventListener(\"click\", () => {\r\n        location.hash = \"#profile\";\r\n      });\r\n    }\r\n\r\n    const profileAction = this.querySelector(\".avatar-action\");\r\n    if (profileAction) {\r\n      profileAction.addEventListener(\"click\", () => {\r\n        location.hash = \"#profile\";\r\n      });\r\n    }\r\n\r\n    const logoutHandlers = this.querySelectorAll(\".avatar-logout, .logout-btn\");\r\n    logoutHandlers.forEach((logoutBtn) => {\r\n      logoutBtn.addEventListener(\"click\", async () => {\r\n        try {\r\n          await fetch(\"/api/auth/logout\", { method: \"POST\" });\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n        localStorage.removeItem(\"auth_token\");\r\n\r\n        localStorage.removeItem(\"authLoggedIn\");\r\n        localStorage.removeItem(\"authRole\");\r\n        localStorage.removeItem(\"authPhone\");\r\n        localStorage.removeItem(\"authStudentId\");\r\n        localStorage.removeItem(\"courierPaid\");\r\n        localStorage.removeItem(\"courier_payment_paid\");\r\n        localStorage.removeItem(\"appState\");\r\n        localStorage.removeItem(\"deliveryActive\");\r\n\r\n        localStorage.setItem(\"courierPaid\", \"0\");\r\n\r\n        this.currentUser = null;\r\n        window.dispatchEvent(new Event(\"user-updated\"));\r\n        location.hash = \"#home\";\r\n\r\n      });\r\n    });\r\n  }\r\n\r\n  handleDocClick(e) {\r\n    if (!this.contains(e.target)) {\r\n      this.classList.remove(\"profile-open\");\r\n    }\r\n  }\r\n\r\n  handleUserUpdated() {\r\n    this.loadUser();\r\n  }\r\n\r\n  handleAppStateChanged() {\r\n    this.render();\r\n    this.updateActive();\r\n  }\r\n\r\n  async loadUser() {\r\n    try {\r\n      const res = await fetch(\"/api/auth/me\");\r\n      if (!res.ok) {\r\n        this.currentUser = null;\r\n      } else {\r\n        const data = await res.json();\r\n        this.currentUser = data?.user || null;\r\n      }\r\n    } catch (e) {\r\n      this.currentUser = null;\r\n    }\r\n    this.render();\r\n    this.updateActive();\r\n  }\r\n\r\n  updateActive() {\r\n    if (!location.hash) {\r\n      history.replaceState(null, '', '#home');\r\n    }\r\n\r\n    const current = location.hash || '#home';\r\n    const allowed = new Set(this.getNavLinks().map((link) => link.href));\r\n    // allow system routes even if not in nav\r\n    allowed.add(\"#pay\");\r\n    allowed.add(\"#login\");\r\n    if (!allowed.size) return;\r\n    if (!allowed.has(current)) {\r\n      location.hash = \"#home\";\r\n      return;\r\n    }\r\n\r\n    this.querySelectorAll('.top-menu a').forEach(a => {\r\n      const href = a.getAttribute('href');\r\n      a.classList.toggle('is-active', href === current);\r\n    });\r\n\r\n  }\r\n}\r\n\r\ncustomElements.define('site-header', SiteHeader);\r\n", "class NumRouter extends HTMLElement {\r\n  connectedCallback() {\r\n    this._views = Array.from(this.querySelectorAll('[data-route]'));\r\n    this._current = null;\r\n    window.addEventListener('hashchange', () => this.applyRoute());\r\n    this.applyRoute();\r\n  }\r\n\r\n  applyRoute() {\r\n    const hash = (location.hash || '#home').replace('#', '') || 'home';\r\n    const role = localStorage.getItem(\"authRole\");\r\n    const paid = localStorage.getItem(\"courierPaid\");\r\n    const loggedIn = localStorage.getItem(\"authLoggedIn\");\r\n    const appState = localStorage.getItem(\"appState\") || \"guest\";\r\n\r\n    if (appState === \"courier\" && hash === \"orders\") {\r\n      alert(\"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0445\u0438\u0439\u0436 \u0431\u0430\u0439\u0445 \u04AF\u0435\u0434 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u044B\u043D \u0445\u044D\u0441\u044D\u0433\u0442 \u043E\u0440\u043E\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0433\u04AF\u0439\");\r\n      location.hash = \"#home\";\r\n      return;\r\n    }\r\n\r\n    if (appState === \"customer\" && hash === \"delivery\") {\r\n      alert(\"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u04E9\u0433\u0441\u04E9\u043D \u04AF\u0435\u0434 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0445\u044D\u0441\u044D\u0433\u0442 \u043E\u0440\u043E\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0433\u04AF\u0439\");\r\n      location.hash = \"#home\";\r\n      return;\r\n    }\r\n\r\n    if (hash === \"delivery\") {\r\n      if (loggedIn !== \"1\") {\r\n        alert(\"\u042D\u043D\u044D \u0445\u044D\u0441\u044D\u0433 \u0437\u04E9\u0432\u0445\u04E9\u043D \u0445\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0434 \u043D\u044D\u044D\u043B\u0442\u0442\u044D\u0439\");\r\n        location.hash = \"#login\";\r\n        return;\r\n      }\r\n      if (role !== \"courier\") {\r\n        alert(\"\u042D\u043D\u044D \u0445\u044D\u0441\u044D\u0433 \u0437\u04E9\u0432\u0445\u04E9\u043D \u0445\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0434 \u043D\u044D\u044D\u043B\u0442\u0442\u044D\u0439\");\r\n        location.hash = \"#home\";\r\n        return;\r\n      }\r\n      if (paid !== \"1\") {\r\n        alert(\"\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u0441\u043D\u0438\u0439 \u0434\u0430\u0440\u0430\u0430 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0445\u044D\u0441\u044D\u0433 \u043D\u044D\u044D\u0433\u0434\u044D\u043D\u044D\");\r\n        location.hash = \"#pay\";\r\n        return;\r\n      }\r\n    }\r\n\r\n    const next = this._views.find((section) => section.dataset.route === hash);\r\n    if (!next) {\r\n      return;\r\n    }\r\n\r\n    if (!this._current) {\r\n      this._views.forEach((section) => {\r\n        const isActive = section === next;\r\n        section.hidden = !isActive;\r\n        section.classList.toggle('is-active', isActive);\r\n        section.classList.remove('is-leaving');\r\n      });\r\n      this._current = next;\r\n      return;\r\n    }\r\n\r\n    if (this._current === next) {\r\n      return;\r\n    }\r\n\r\n    const prev = this._current;\r\n    this._current = next;\r\n\r\n    prev.hidden = true;\r\n    prev.classList.remove('is-active');\r\n\r\n    next.hidden = false;\r\n    next.classList.add('is-active');\r\n  }\r\n}\r\n\r\ncustomElements.define('num-router', NumRouter);\r\n", "// assets/components/state-ui.js\r\nfunction getState() {\r\n  return localStorage.getItem(\"appState\") || \"guest\";\r\n}\r\n\r\n/**\r\n * Rule:\r\n * - customer -> block courier accept UI\r\n */\r\nexport function applyStateUI(root = document) {\r\n  const state = getState();\r\n  const role = localStorage.getItem(\"authRole\") || \"\";\r\n  const deliveryActive = localStorage.getItem(\"deliveryActive\") === \"1\";\r\n\r\n  // 1) Order related (place order / checkout)\r\n  // Add data-role=\"order-action\" to buttons/sections you want blocked while courier\r\n  root.querySelectorAll('[data-role=\"order-action\"]').forEach((el) => {\r\n    const blocked = state === \"courier\" && deliveryActive && role !== \"courier\";\r\n    if (\"disabled\" in el) el.disabled = blocked;\r\n    el.style.pointerEvents = blocked ? \"none\" : \"\";\r\n    el.style.opacity = blocked ? \"0.5\" : \"\";\r\n    el.title = blocked ? \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0445\u0438\u0439\u0436 \u0431\u0430\u0439\u0445 \u04AF\u0435\u0434 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u04E9\u0433\u04E9\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0433\u04AF\u0439\" : \"\";\r\n  });\r\n\r\n  // 2) Courier accept related (accept offer buttons etc.)\r\n  // Add data-role=\"courier-action\" to accept buttons you want blocked while customer\r\n  root.querySelectorAll('[data-role=\"courier-action\"]').forEach((el) => {\r\n    const blocked = role !== \"courier\";\r\n    if (\"disabled\" in el) el.disabled = blocked;\r\n    el.style.pointerEvents = blocked ? \"none\" : \"\";\r\n    el.style.opacity = blocked ? \"0.5\" : \"\";\r\n    el.title = blocked ? \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440 \u043D\u044D\u0432\u0442\u044D\u0440\u0441\u043D\u0438\u0439 \u0434\u0430\u0440\u0430\u0430 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442 \u0430\u0432\u0430\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0442\u043E\u0439\" : \"\";\r\n  });\r\n\r\n  // 3) Optional: hide/show whole sections\r\n  // data-show-in=\"guest|customer|courier\"   (comma allowed)\r\n  root.querySelectorAll(\"[data-show-in]\").forEach((el) => {\r\n    const allowed = String(el.getAttribute(\"data-show-in\") || \"\")\r\n      .split(\",\")\r\n      .map((s) => s.trim())\r\n      .filter(Boolean);\r\n    el.style.display = allowed.includes(state) ? \"\" : \"none\";\r\n  });\r\n\r\n  // 4) Optional: tiny badge somewhere\r\n  root.querySelectorAll(\"[data-appstate-label]\").forEach((el) => {\r\n    el.textContent = state.toUpperCase();\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\n// Auto re-apply when state changes\r\nwindow.addEventListener(\"app-state-changed\", () => applyStateUI(document));\r\nwindow.addEventListener(\"DOMContentLoaded\", () => applyStateUI(document));\r\n", "const API_BASE = \"http://localhost:3000\";\r\n\r\nexport function apiFetch(path, init = {}) {\r\n  const url = path.startsWith(\"http\") ? path : `${API_BASE}${path}`;\r\n  return fetch(url, { credentials: \"include\", ...init });\r\n}\r\n\r\nexport { API_BASE };\r\n", "// assets/components/app-state.js\r\nimport { apiFetch } from \"../api_client.js\";\r\nconst KEY = \"appState\";\r\nconst VALID = new Set([\"guest\", \"customer\", \"courier\"]);\r\n\r\nexport function getState() {\r\n  const v = localStorage.getItem(KEY);\r\n  return VALID.has(v) ? v : \"guest\";\r\n}\r\n\r\nexport function setState(state, reason = \"\") {\r\n  const next = VALID.has(state) ? state : \"guest\";\r\n  const prev = getState();\r\n  localStorage.setItem(KEY, next);\r\n\r\n  if (prev !== next) {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"app-state-changed\", { detail: { prev, next, reason } })\r\n    );\r\n  }\r\n  return next;\r\n}\r\n\r\nexport async function resetToGuest(reason = \"\") {\r\n  setState(\"guest\", reason);\r\n  localStorage.setItem(\"deliveryActive\", \"0\");\r\n\r\n  // active-order \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u0445\r\n  try {\r\n    await apiFetch(\"/api/active-order\", {\r\n      method: \"PUT\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ order: null }),\r\n    });\r\n  } catch { }\r\n\r\n  //  courier \u0442\u0430\u043B\u044B\u043D delivery steps \u0443\u0441\u0442\u0433\u0430\u0445\r\n  localStorage.removeItem(\"deliverySteps\");\r\n\r\n  //  courier delivery cart DB-\u044D\u044D\u0441 \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u0445\r\n  try {\r\n    await apiFetch(\"/api/delivery-cart\", {\r\n      method: \"DELETE\",\r\n    });\r\n  } catch { }\r\n\r\n\r\n  // local step \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u0445\r\n  localStorage.removeItem(\"orderStep\");\r\n\r\n  // UI refresh\r\n  window.dispatchEvent(new Event(\"order-updated\"));\r\n  window.dispatchEvent(new Event(\"delivery-cart-updated\"));\r\n}\r\n\r\n// global shortcut (import \u0445\u0438\u0439\u0445\u0433\u04AF\u0439 \u0430\u0448\u0438\u0433\u043B\u0430\u0445\u0430\u0434)\r\nwindow.NumAppState = { getState, setState, resetToGuest };\r\n", "import { apiFetch } from \"../api_client.js\";\r\n\r\nclass HomePage extends HTMLElement {\r\n  connectedCallback() {\r\n    this.currentUser = null;\r\n    this.pendingOrder = null;\r\n    this.pendingOffer = null;\r\n\r\n    this.render();\r\n    this.cacheEls();\r\n    this.bindConfirmModal();\r\n    this.bindEvents();\r\n\r\n    this.loadPlaces();\r\n    this.hydrateCustomerFromDb();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.orderBtn && this.handleOrderClick) {\r\n      this.orderBtn.removeEventListener(\"click\", this.handleOrderClick);\r\n    }\r\n    if (this.fromSel && this.handleFromChange) {\r\n      this.fromSel.removeEventListener(\"change\", this.handleFromChange);\r\n    }\r\n    if (this.confirmModal && this.handleConfirm) {\r\n      this.confirmModal.removeEventListener(\"confirm\", this.handleConfirm);\r\n      this.confirmModal.removeEventListener(\"cancel\", this.handleCancel);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/index.css\" />\r\n      <style>\r\n        .sr-only {\r\n          position: absolute;\r\n          width: 1px;\r\n          height: 1px;\r\n          padding: 0;\r\n          margin: -1px;\r\n          overflow: hidden;\r\n          clip: rect(0, 0, 0, 0);\r\n          white-space: nowrap;\r\n          border: 0;\r\n        }\r\n      </style>\r\n\r\n      <section class=\"filter-section\">\r\n        <div class=\"middle-row\">\r\n          <div class=\"ctrl\">\r\n            <span><img src=\"assets/img/map_pin.svg\" alt=\"icon\" width=\"16\" height=\"16\" /></span>\r\n            <label class=\"sr-only\" for=\"fromPlace\">\u0425\u0430\u0430\u043D\u0430\u0430\u0441</label>\r\n            <select id=\"fromPlace\">\r\n              <option value=\"\" disabled selected hidden>\u0425\u0430\u0430\u043D\u0430\u0430\u0441</option>\r\n            </select>\r\n          </div>\r\n\r\n          <span class=\"arrow-icon\"><img src=\"assets/img/arrow.svg\" alt=\"icon\" width=\"67\" height=\"67\" /></span>\r\n\r\n          <div class=\"ctrl\">\r\n            <span><img src=\"assets/img/map_pin.svg\" alt=\"icon\" width=\"16\" height=\"16\" /></span>\r\n            <label class=\"sr-only\" for=\"toPlace\">\u0425\u0430\u0430\u0448\u0430\u0430</label>\r\n            <select id=\"toPlace\">\r\n              <option value=\"\" disabled selected hidden>\u0425\u0430\u0430\u0448\u0430\u0430</option>\r\n            </select>\r\n          </div>\r\n\r\n          <date-time-picker></date-time-picker>\r\n        </div>\r\n\r\n        <div class=\"bottom-row\">\r\n          <div class=\"ctrl wide\">\r\n            <span><img src=\"assets/img/fork.svg\" alt=\"icon\" width=\"40\" height=\"38\" /></span>\r\n            <label class=\"sr-only\" for=\"what\">\u042E\u0443\u0433</label>\r\n            <select id=\"what\">\r\n              <option value=\"\" disabled selected hidden>\u042E\u0443\u0433</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        <sh-cart class=\"cart\"></sh-cart>\r\n\r\n        <div class=\"top-row\">\r\n          <button class=\"btn btn--accent order-btn\" data-role=\"order-action\">\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0445</button>\r\n        </div>\r\n      </section>\r\n\r\n      <div class=\"offers-layout\">\r\n        <div class=\"offers-panel\">\r\n          <offers-list id=\"offers\"></offers-list>\r\n        </div>\r\n        <aside class=\"delivery-cart-panel\">\r\n          <delivery-cart></delivery-cart>\r\n        </aside>\r\n      </div>\r\n      <offer-modal></offer-modal>\r\n      <confirm-modal></confirm-modal>\r\n    `;\r\n  }\r\n\r\n  cacheEls() {\r\n    this.fromSel = this.querySelector(\"#fromPlace\");\r\n    this.toSel = this.querySelector(\"#toPlace\");\r\n    this.whatSel = this.querySelector(\"#what\");\r\n    this.orderBtn = this.querySelector(\".order-btn\");\r\n  }\r\n\r\n  bindEvents() {\r\n    this.handleOrderClick = () => this.prepareOrder();\r\n    this.handleFromChange = (e) => this.onFromPlaceChange(e);\r\n\r\n    if (this.orderBtn) {\r\n      this.orderBtn.addEventListener(\"click\", this.handleOrderClick);\r\n    }\r\n    if (this.fromSel) {\r\n      this.fromSel.addEventListener(\"change\", this.handleFromChange);\r\n    }\r\n  }\r\n\r\n  bindConfirmModal() {\r\n    this.confirmModal = this.querySelector(\"confirm-modal\");\r\n    if (!this.confirmModal) return;\r\n    this.handleConfirm = () => this.confirmOrder();\r\n    this.handleCancel = () => this.hideConfirmModal();\r\n    this.confirmModal.addEventListener(\"confirm\", this.handleConfirm);\r\n    this.confirmModal.addEventListener(\"cancel\", this.handleCancel);\r\n  }\r\n\r\n  async hydrateCustomerFromDb() {\r\n    const user = await this.fetchCurrentUser();\r\n    if (!user?.id) return;\r\n\r\n    try {\r\n      await this.syncCustomerInfo(user.id);\r\n    } catch (e) {\r\n      console.error(\"Failed to sync customer info:\", e);\r\n    }\r\n  }\r\n\r\n  async fetchCurrentUser() {\r\n    if (this.currentUser) return this.currentUser;\r\n    try {\r\n      const res = await apiFetch(\"/api/auth/me\");\r\n      if (!res.ok) return null;\r\n      const data = await res.json();\r\n      this.currentUser = data?.user || null;\r\n      return this.currentUser;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async syncCustomerInfo(userId) {\r\n    if (!userId) return;\r\n    const res = await apiFetch(`/api/customers/${userId}`);\r\n    if (!res.ok) return;\r\n    const data = await res.json();\r\n    if (data) {\r\n      window.dispatchEvent(new Event(\"user-updated\"));\r\n    }\r\n  }\r\n\r\n  async loadPlaces() {\r\n    try {\r\n      const [fromRes, toRes] = await Promise.all([\r\n        apiFetch(\"/api/from-places\"),\r\n        apiFetch(\"/api/to-places\"),\r\n      ]);\r\n      if (!fromRes.ok || !toRes.ok) return;\r\n\r\n      const [from, to] = await Promise.all([fromRes.json(), toRes.json()]);\r\n      this.fillPlaceSelect(this.fromSel, from, \"\u0425\u0430\u0430\u043D\u0430\u0430\u0441\", (p) =>\r\n        `${p.name}${p.detail ? \" - \" + p.detail : \"\"}`\r\n      );\r\n      this.fillPlaceSelect(this.toSel, to, \"\u0425\u0430\u0430\u0448\u0430\u0430\", (p) => p.name);\r\n    } catch (e) {\r\n      console.warn(\"Failed to load places:\", e);\r\n    }\r\n  }\r\n\r\n  fillPlaceSelect(select, items, placeholder, labelFn) {\r\n    if (!select) return;\r\n    const list = Array.isArray(items) ? items : [];\r\n    select.innerHTML = `<option value=\"\" disabled selected hidden>${placeholder}</option>`;\r\n    select.innerHTML += list\r\n      .map((p) => `<option value=\"${p.id}\">${labelFn(p)}</option>`)\r\n      .join(\"\");\r\n  }\r\n\r\n  async onFromPlaceChange(e) {\r\n    const placeId = e?.target?.value;\r\n    if (!placeId || !this.whatSel) return;\r\n\r\n    try {\r\n      const res = await apiFetch(`/api/menus/${placeId}`);\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      const items = Array.isArray(data?.menu_json) ? data.menu_json : [];\r\n\r\n      this.populateMenuSelect(items);\r\n    } catch (err) {\r\n      console.warn(\"Failed to load menu:\", err);\r\n    }\r\n  }\r\n\r\n  populateMenuSelect(items) {\r\n    if (!this.whatSel) return;\r\n    const foods = items.filter((i) => i.category === \"food\");\r\n    const drinks = items.filter((i) => i.category === \"drink\");\r\n    const others = items.filter((i) => !i.category);\r\n\r\n    this.whatSel.innerHTML = `<option value=\"\" disabled selected hidden>\u042E\u0443\u0433</option>`;\r\n    this.appendMenuGroup(\"\u0418\u0434\u044D\u0445 \u044E\u043C\", foods);\r\n    this.appendMenuGroup(\"\u0423\u0443\u0445 \u044E\u043C\", drinks);\r\n    this.appendMenuGroup(\"\u0411\u0443\u0441\u0430\u0434\", others);\r\n  }\r\n\r\n  appendMenuGroup(label, items) {\r\n    if (!items.length || !this.whatSel) return;\r\n    const group = document.createElement(\"optgroup\");\r\n    group.label = label;\r\n    items.forEach((item) => {\r\n      const opt = document.createElement(\"option\");\r\n      opt.value = item.id;\r\n      opt.dataset.price = item.price;\r\n      opt.dataset.name = item.name;\r\n      opt.textContent = `${item.name} \u2014 ${item.price}\u20AE`;\r\n      group.appendChild(opt);\r\n    });\r\n    this.whatSel.appendChild(group);\r\n  }\r\n\r\n  formatPrice(n) {\r\n    return Number(n || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  formatMeta(ts) {\r\n    const d = new Date(ts);\r\n    if (isNaN(d.getTime())) return \"\";\r\n    const date = d.toLocaleDateString(\"en-US\", {\r\n      month: \"2-digit\",\r\n      day: \"2-digit\",\r\n      year: \"2-digit\",\r\n    });\r\n    const time = d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n    return `${date} \u2022 ${time}`;\r\n  }\r\n\r\n  getScheduledAtISO() {\r\n    const picker = this.querySelector(\"date-time-picker\");\r\n    const dateVal = picker?.shadowRoot?.querySelector(\".date\")?.value;\r\n    const timeVal = picker?.shadowRoot?.querySelector(\".time\")?.value;\r\n\r\n    if (dateVal && timeVal) {\r\n      const iso = new Date(`${dateVal}T${timeVal}:00`);\r\n      if (!isNaN(iso.getTime())) return iso.toISOString();\r\n    }\r\n\r\n    return new Date().toISOString();\r\n  }\r\n\r\n  hideConfirmModal() {\r\n    if (this.confirmModal && typeof this.confirmModal.close === \"function\") {\r\n      this.confirmModal.close();\r\n    }\r\n    this.pendingOrder = null;\r\n    this.pendingOffer = null;\r\n  }\r\n\r\n  prepareOrder() {\r\n    if (!this.fromSel || !this.toSel || !this.whatSel) return;\r\n\r\n    if (!this.fromSel.value) {\r\n      alert(\"\u0425\u0430\u0430\u043D\u0430\u0430\u0441\u0430\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443\");\r\n      return;\r\n    }\r\n    if (!this.toSel.value) {\r\n      alert(\"\u0425\u0430\u0430\u0448\u0430\u0430\u0433\u0430\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443\");\r\n      return;\r\n    }\r\n\r\n    const cartSummary = this.getCartSummary();\r\n    const itemOpt = this.whatSel.selectedOptions?.[0];\r\n\r\n    if (cartSummary.totalQty === 0 && (!itemOpt || !itemOpt.value)) {\r\n      alert(\"\u042E\u0443\u0433 (\u0445\u043E\u043E\u043B/\u0431\u0430\u0440\u0430\u0430) \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443\");\r\n      return;\r\n    }\r\n\r\n    const { fromName, fromDetail } = this.parseFromPlace(this.fromSel);\r\n    const scheduledAt = this.getScheduledAtISO();\r\n    const items = cartSummary.totalQty > 0\r\n      ? this.buildItemsFromCart(cartSummary)\r\n      : this.buildSingleItem(itemOpt);\r\n\r\n    this.pendingOrder = {\r\n      fromId: this.fromSel.value,\r\n      toId: this.toSel.value,\r\n      from: fromName,\r\n      fromDetail,\r\n      to: this.toSel.selectedOptions[0].textContent,\r\n      createdAt: scheduledAt,\r\n    };\r\n\r\n    this.pendingOffer = {\r\n      items,\r\n      total: cartSummary.totalQty > 0\r\n        ? cartSummary.total\r\n        : items.reduce((sum, it) => sum + (it.price * it.qty), 0),\r\n      deliveryFee: cartSummary.totalQty > 0 ? cartSummary.deliveryFee : 500,\r\n      thumb: cartSummary.deliveryIcon || \"assets/img/box.svg\",\r\n    };\r\n\r\n    if (this.confirmModal && typeof this.confirmModal.open === \"function\") {\r\n      this.confirmModal.open(this.pendingOrder, this.pendingOffer);\r\n    }\r\n  }\r\n\r\n  getCartSummary() {\r\n    const cartEl = this.querySelector(\"sh-cart\");\r\n    return cartEl?.getSummary() || { totalQty: 0, items: [], total: 0, deliveryFee: 0 };\r\n  }\r\n\r\n  parseFromPlace(select) {\r\n    const raw = select.selectedOptions[0].textContent || \"\";\r\n    const parts = raw.split(\" - \");\r\n    return {\r\n      fromName: parts[0] || raw,\r\n      fromDetail: parts[1] || \"\",\r\n    };\r\n  }\r\n\r\n  buildItemsFromCart(cartSummary) {\r\n    return cartSummary.items.map((it) => ({\r\n      id: it.key || it.name,\r\n      name: it.name,\r\n      price: Number(it.unitPrice ?? it.price ?? 0),\r\n      qty: it.qty,\r\n    }));\r\n  }\r\n\r\n  buildSingleItem(itemOpt) {\r\n    if (!itemOpt) return [];\r\n    return [{\r\n      id: itemOpt.value,\r\n      name: (itemOpt.textContent || \"\").split(\" \u2014 \")[0],\r\n      price: Number(itemOpt.dataset.price || 0),\r\n      qty: 1,\r\n    }];\r\n  }\r\n\r\n  async confirmOrder() {\r\n    if (!this.pendingOrder || !this.pendingOffer) {\r\n      this.hideConfirmModal();\r\n      return;\r\n    }\r\n\r\n    const user = await this.fetchCurrentUser();\r\n    if (!user?.id) {\r\n      localStorage.setItem(\"pendingOrderDraft\", JSON.stringify(this.pendingOrder));\r\n      localStorage.setItem(\"pendingOfferDraft\", JSON.stringify(this.pendingOffer));\r\n      this.hideConfirmModal();\r\n      location.hash = \"#login\";\r\n      return;\r\n    }\r\n\r\n    if (!this.pendingOrder.fromId || !this.pendingOrder.toId) {\r\n      alert(\"\u0425\u0430\u0430\u043D\u0430\u0430\u0441/\u0425\u0430\u0430\u0448\u0430\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443\");\r\n      return;\r\n    }\r\n\r\n    if (!Array.isArray(this.pendingOffer.items) || this.pendingOffer.items.length === 0) {\r\n      alert(\"\u0421\u0430\u0433\u0441 \u0445\u043E\u043E\u0441\u043E\u043D \u0431\u0430\u0439\u043D\u0430\");\r\n      return;\r\n    }\r\n\r\n    const safeItems = this.pendingOffer.items\r\n      .map((i) => {\r\n        const unitPrice = Number(i.price);\r\n        const qty = Number(i.qty);\r\n        return {\r\n          menuItemKey: i.id,\r\n          name: i.name,\r\n          unitPrice: Number.isFinite(unitPrice) ? unitPrice : 0,\r\n          qty: Number.isFinite(qty) && qty > 0 ? qty : 1,\r\n          options: {},\r\n        };\r\n      })\r\n      .filter((i) => i.qty > 0);\r\n\r\n    const payload = {\r\n      customerId: user.id,\r\n      fromPlaceId: this.pendingOrder.fromId,\r\n      toPlaceId: this.pendingOrder.toId,\r\n      scheduledAt: this.pendingOrder.createdAt,\r\n      deliveryFee: Number.isFinite(this.pendingOffer.deliveryFee) ? this.pendingOffer.deliveryFee : 0,\r\n      items: safeItems,\r\n      customerName: user.name || \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\",\r\n      customerPhone: user.phone || \"00000000\",\r\n      customerStudentId: user.student_id || \"\",\r\n      note: this.pendingOrder.fromDetail ? `Pickup: ${this.pendingOrder.fromDetail}` : null,\r\n    };\r\n\r\n    try {\r\n      const resp = await apiFetch(\"/api/orders\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      const data = await resp.json().catch(() => ({}));\r\n      if (!resp.ok) {\r\n        alert(data?.error || \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u04AF\u04AF\u0441\u0433\u044D\u0445\u044D\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        return;\r\n      }\r\n\r\n      if (data?.customerId) {\r\n        this.syncCustomerInfo(data.customerId);\r\n      }\r\n\r\n      const activeOrder = {\r\n        ...this.pendingOrder,\r\n        customer: {\r\n          name: user.name || \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\",\r\n          phone: user.phone || \"00000000\",\r\n          studentId: user.student_id || \"\",\r\n        },\r\n      };\r\n\r\n      try {\r\n        await apiFetch(\"/api/active-order\", {\r\n          method: \"PUT\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ order: activeOrder }),\r\n        });\r\n      } catch {\r\n        // ignore\r\n      }\r\n\r\n      window.NumAppState?.setState(\"customer\", \"order_created\");\r\n      window.dispatchEvent(new Event(\"order-updated\"));\r\n\r\n      this.addOfferToLocalList(user, data);\r\n      this.hideConfirmModal();\r\n      this.scrollOffersIntoView();\r\n    } catch {\r\n      alert(\"\u0421\u0435\u0440\u0432\u0435\u0440\u0442\u044D\u0439 \u0445\u043E\u043B\u0431\u043E\u0433\u0434\u043E\u0436 \u0447\u0430\u0434\u0441\u0430\u043D\u0433\u04AF\u0439\");\r\n    }\r\n  }\r\n\r\n  addOfferToLocalList(user, data) {\r\n    const existingOffers = JSON.parse(localStorage.getItem(\"offers\") || \"[]\");\r\n    existingOffers.unshift({\r\n      ...this.pendingOffer,\r\n      orderId: data.orderId,\r\n      meta: this.formatMeta(this.pendingOrder.createdAt),\r\n      from: this.pendingOrder.from,\r\n      fromDetail: this.pendingOrder.fromDetail,\r\n      to: this.pendingOrder.to,\r\n      title: `${this.pendingOrder.from} - ${this.pendingOrder.to}`,\r\n      price: this.formatPrice((data?.total ?? this.pendingOffer.total) || 0),\r\n      thumb: this.pendingOffer.thumb || \"assets/img/box.svg\",\r\n      customer: {\r\n        name: user.name || \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\",\r\n        phone: user.phone || \"00000000\",\r\n        studentId: user.student_id || \"\",\r\n        avatar: user.avatar || \"assets/img/profile.jpg\",\r\n      },\r\n      sub: this.pendingOffer.items.map((it) => ({\r\n        name: `${it.name} x${it.qty}`,\r\n        price: this.formatPrice(it.price * it.qty),\r\n      })),\r\n    });\r\n\r\n    localStorage.setItem(\"offers\", JSON.stringify(existingOffers));\r\n    const offersEl = this.querySelector(\"#offers\");\r\n    if (offersEl && \"items\" in offersEl) {\r\n      offersEl.items = existingOffers;\r\n    }\r\n    window.dispatchEvent(new Event(\"offers-updated\"));\r\n  }\r\n\r\n  scrollOffersIntoView() {\r\n    const offersSection = document.querySelector(\"#offers\");\r\n    if (!offersSection || !offersSection.scrollIntoView) return;\r\n    setTimeout(() => {\r\n      offersSection.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\r\n    }, 150);\r\n  }\r\n}\r\n\r\ncustomElements.define(\"home-page\", HomePage);\r\n", "class DeliveryPage extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.handleRouteChange = this.handleRouteChange.bind(this);\r\n    this.applyActiveOrderBound = this.applyActiveOrder.bind(this);\r\n    this.renderDeliveryCartBound = this.renderDeliveryCart.bind(this);\r\n    this._initialized = false;\r\n  }\r\n  connectedCallback() {\r\n    window.addEventListener('hashchange', this.handleRouteChange);\r\n    this.handleRouteChange();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('hashchange', this.handleRouteChange);\r\n    window.removeEventListener('order-updated', this.applyActiveOrderBound);\r\n    window.removeEventListener('delivery-cart-updated', this.renderDeliveryCartBound);\r\n  }\r\n\r\n  handleRouteChange() {\r\n    if (location.hash !== '#delivery') return;\r\n\r\n    const loggedIn = localStorage.getItem(\"authLoggedIn\");\r\n    const role = localStorage.getItem(\"authRole\");\r\n    const paid = localStorage.getItem(\"courierPaid\");\r\n\r\n    if (loggedIn !== \"1\") {\r\n      location.hash = \"#login\";\r\n      return;\r\n    }\r\n    if (role !== \"courier\") {\r\n      location.hash = \"#home\";\r\n      return;\r\n    }\r\n    if (paid !== \"1\") {\r\n      location.hash = \"#pay\";\r\n      return;\r\n    }\r\n\r\n    if (!this._initialized) {\r\n      this.render();\r\n      window.addEventListener('order-updated', this.applyActiveOrderBound);\r\n      window.addEventListener('delivery-cart-updated', this.renderDeliveryCartBound);\r\n      this._initialized = true;\r\n    }\r\n\r\n    this.applyActiveOrder();\r\n    this.renderDeliveryCart();\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n    <link rel=\"stylesheet\" href=\"assets/css/delivery.css\">\r\n      <div class=\"container\">\r\n        <section class=\"orders\">\r\n          <h2>\u041C\u0438\u043D\u0438\u0439 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442</h2>\r\n          <div id=\"deliveryList\" class=\"order-list\"></div>\r\n        </section>\r\n\r\n        <section class=\"details\">\r\n          <del-order-details></del-order-details>\r\n        </section>\r\n\r\n        <section class=\"order-step\">\r\n          <h2>\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u044B\u043D \u044F\u0432\u0446</h2>\r\n          <del-order-progress></del-order-progress>\r\n        </section>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  applyActiveOrder() {\r\n    this.fetchActiveOrder();\r\n  }\r\n\r\n  async fetchActiveOrder() {\r\n    try {\r\n      const res = await fetch(\"/api/active-order\");\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      const order = data?.order;\r\n      if (!order) return;\r\n      const first = this.querySelector('d-orders[data-active=\"true\"]');\r\n      if (first && order.from && order.to) {\r\n        first.setAttribute('header', `${order.from} \u2192 ${order.to}`);\r\n        if (order.item) {\r\n          first.setAttribute('detail', order.item);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  renderDeliveryCart() {\r\n    const listEl = this.querySelector('#deliveryList');\r\n    if (!listEl) return;\r\n    this.fetchDeliveryItems(listEl);\r\n  }\r\n\r\n  attachOrderSelection(items = []) {\r\n    const orderElements = this.querySelectorAll('d-orders');\r\n    if (!orderElements.length) return;\r\n\r\n    const byId = new Map(\r\n      items.map((item) => [String(item.id || \"\"), item])\r\n    );\r\n\r\n    orderElements.forEach(orderEl => {\r\n      orderEl.addEventListener('click', () => {\r\n        const itemId = orderEl.getAttribute('data-id');\r\n        const payload = byId.get(String(itemId)) || null;\r\n        this.selectOrder(payload, orderEl);\r\n      });\r\n    });\r\n\r\n    const first = orderElements[0];\r\n    const firstId = first?.getAttribute('data-id');\r\n    const firstPayload = byId.get(String(firstId)) || null;\r\n    if (firstPayload) {\r\n      this.selectOrder(firstPayload, first);\r\n    }\r\n  }\r\n\r\n  selectOrder(payload, activeEl) {\r\n    if (!payload) return;\r\n    this.querySelectorAll('d-orders').forEach((el) => {\r\n      el.classList.toggle('is-active', el === activeEl);\r\n    });\r\n    const event = new CustomEvent('delivery-select', {\r\n      detail: {\r\n        ...payload,\r\n        id: payload.orderId || payload.id || null,\r\n        orderId: payload.orderId || null,\r\n      },\r\n    });\r\n    document.dispatchEvent(event);\r\n  }\r\n\r\n  escapeAttr(value) {\r\n    return String(value || '')\r\n      .replace(/&/g, '&amp;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;');\r\n  }\r\n\r\n  async fetchDeliveryItems(listEl) {\r\n    let items = [];\r\n    try {\r\n      const res = await fetch(\"/api/delivery-cart\");\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        items = Array.isArray(data?.items) ? data.items : [];\r\n      }\r\n    } catch (e) {\r\n      items = [];\r\n    }\r\n\r\n    if (!items.length) {\r\n      listEl.innerHTML = '<p class=\"muted\">\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0441\u043E\u043D\u0433\u043E\u043E\u0433\u04AF\u0439 \u0431\u0430\u0439\u043D\u0430.</p>';\r\n\r\n      // \u2705 details + progress \u0434\u043E\u0442\u043E\u0440\u0445\u0438\u0439\u0433 empty \u0431\u043E\u043B\u0433\u043E\u0436 \u04AF\u043B\u0434\u044D\u044D\u043D\u044D (section title \u04AF\u043B\u0434\u044D\u043D\u044D)\r\n      const details = this.querySelector(\"del-order-details\");\r\n      const progress = this.querySelector(\"del-order-progress\");\r\n      if (details) details.setAttribute(\"data-empty\", \"1\");\r\n      if (progress) progress.setAttribute(\"data-empty\", \"1\");\r\n\r\n      return;\r\n    }\r\n\r\n    // \u2705 items \u0431\u0430\u0439\u0433\u0430\u0430 \u04AF\u0435\u0434 empty mode-\u0433 \u0441\u0430\u043B\u0433\u0430\u043D\u0430\r\n    const details = this.querySelector(\"del-order-details\");\r\n    const progress = this.querySelector(\"del-order-progress\");\r\n    if (details) details.removeAttribute(\"data-empty\");\r\n    if (progress) progress.removeAttribute(\"data-empty\");\r\n\r\n\r\n    const normalized = items.map((item) => {\r\n      const qty = Number(item.qty || 1);\r\n      const detailParts = [];\r\n      if (item.meta) detailParts.push(item.meta);\r\n      if (qty) detailParts.push(`x${qty}`);\r\n      const detail = detailParts.join(' \u2022 ');\r\n\r\n      const title = String(item.title || \"\");\r\n      const parts = title.split(\" - \");\r\n      const from = parts[0] || title;\r\n      const to = parts.slice(1).join(\" - \");\r\n      const orderId = item.order_id || null;\r\n\r\n      return {\r\n        ...item,\r\n        detail,\r\n        from,\r\n        to,\r\n        createdAt: item.meta || \"\",\r\n        orderId,\r\n      };\r\n    });\r\n\r\n    listEl.innerHTML = normalized.map((item) => `\r\n        <d-orders\r\n          data-id=\"${this.escapeAttr(item.id || '')}\"\r\n          data-order-id=\"${this.escapeAttr(item.orderId || '')}\"\r\n          data-from=\"${this.escapeAttr(item.from || '')}\"\r\n          data-to=\"${this.escapeAttr(item.to || '')}\"\r\n          data-created-at=\"${this.escapeAttr(item.createdAt || '')}\"\r\n          header=\"${this.escapeAttr(item.title || '')}\"\r\n          detail=\"${this.escapeAttr(item.detail || '')}\">\r\n        </d-orders>\r\n      `).join('');\r\n\r\n    this.attachOrderSelection(normalized);\r\n  }\r\n}\r\n\r\ncustomElements.define('delivery-page', DeliveryPage);\r\n", "const API = \"http://localhost:3000\";\r\n\r\nclass OrdersPage extends HTMLElement {\r\n  connectedCallback() {\r\n    this.selectedOrder = null;\r\n    this._onDocClick = this._onDocClick?.bind(this) || ((e) => this.onDocClick(e));\r\n    this.render();\r\n    this.bindModal();\r\n    this.bindClicks();\r\n    this.bindProgress(); \r\n    this.loadOrders();\r\n    this.initOrderStream();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    document.removeEventListener(\"click\", this._onDocClick);\r\n\r\n    if (this.orderStream) {\r\n      if (this.handleOrderStatusEvent) {\r\n        this.orderStream.removeEventListener(\"order-status\", this.handleOrderStatusEvent);\r\n      }\r\n      if (this.handleOrderUpdatedEvent) {\r\n        this.orderStream.removeEventListener(\"order-updated\", this.handleOrderUpdatedEvent);\r\n      }\r\n      this.orderStream.close();\r\n      this.orderStream = null;\r\n    }\r\n  }\r\n\r\n  renderCourier(courier) {\r\n    const box = this.querySelector(\"#courierBox\");\r\n    if (!box) return;\r\n    if (!courier) {\r\n      box.setEmpty?.();\r\n      return;\r\n    }\r\n    box.setData?.(courier);\r\n  }\r\n\r\n  async loadCourierForOrder(order) {\r\n    const courier = order?.courier || null;\r\n    this.renderCourier(courier);\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/order.css\">\r\n      <main class=\"container\">\r\n        <section class=\"order-side\">\r\n          <section class=\"orders\">\r\n            <h2>\u041C\u0438\u043D\u0438\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430</h2>\r\n            <div class=\"order-list\" id=\"orderList\">\r\n              <p class=\"muted\">\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0430\u0447\u0430\u0430\u043B\u043B\u0430\u0436 \u0431\u0430\u0439\u043D\u0430...</p>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"delivery-info\">\r\n            <couriers-card id=\"courierBox\"></couriers-card>\r\n          </section>\r\n        </section>\r\n\r\n        <section class=\"details\">\r\n          <h2>\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u044B\u043D \u044F\u0432\u0446</h2>\r\n\r\n          <div class=\"order-progress\">\r\n            <div class=\"step\" data-step=\"0\">\r\n              <div class=\"step-indicator\">\r\n                <svg viewBox=\"0 0 24 24\">\r\n                  <path d=\"M12 2C8.962 2 6.5 4.462 6.5 7.5C6.5 11.438 12 18 12 18C12 18 17.5 11.438 17.5 7.5C17.5 4.462 15.038 2 12 2ZM12 9.5C10.895 9.5 10 8.605 10 7.5C10 6.395 10.895 5.5 12 5.5C13.105 5.5 14 6.395 14 7.5C14 8.605 13.105 9.5 12 9.5Z\"/>\r\n                </svg>\r\n              </div>\r\n              <div><div class=\"step-label\">\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0445\u04AF\u043B\u044D\u044D\u043D \u0430\u0432\u0441\u0430\u043D</div></div>\r\n            </div>\r\n\r\n            <div class=\"step\" data-step=\"1\">\r\n              <div class=\"step-indicator\">\r\n                <svg viewBox=\"0 0 24 24\">\r\n                  <path d=\"M12 2C8.962 2 6.5 4.462 6.5 7.5C6.5 11.438 12 18 12 18C12 18 17.5 11.438 17.5 7.5C17.5 4.462 15.038 2 12 2ZM12 9.5C10.895 9.5 10 8.605 10 7.5C10 6.395 10.895 5.5 12 5.5C13.105 5.5 14 6.395 14 7.5C14 8.605 13.105 9.5 12 9.5Z\"/>\r\n                </svg>\r\n              </div>\r\n              <div><div class=\"step-label\">\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u044D\u043D\u0434 \u0433\u0430\u0440\u0441\u0430\u043D</div></div>\r\n            </div>\r\n\r\n            <div class=\"step\" data-step=\"2\">\r\n              <div class=\"step-indicator\">\r\n                <svg viewBox=\"0 0 24 24\">\r\n                  <path d=\"M12 2C8.962 2 6.5 4.462 6.5 7.5C6.5 11.438 12 18 12 18C12 18 17.5 11.438 17.5 7.5C17.5 4.462 15.038 2 12 2ZM12 9.5C10.895 9.5 10 8.605 10 7.5C10 6.395 10.895 5.5 12 5.5C13.105 5.5 14 6.395 14 7.5C14 8.605 13.105 9.5 12 9.5Z\"/>\r\n                </svg>\r\n              </div>\r\n              <div><div class=\"step-label\">\u0410\u043C\u0436\u0438\u043B\u0442\u0442\u0430\u0439 \u0445\u04AF\u043B\u044D\u044D\u043D \u0430\u0432\u0441\u0430\u043D</div></div>\r\n            </div>\r\n          </div>\r\n\r\n          <button id=\"openModal\" style=\"display:none;\">\u04AE\u043D\u044D\u043B\u0433\u044D\u044D \u04E9\u0433\u04E9\u0445</button>\r\n\r\n          <div id=\"ratingModal\" class=\"modal\" style=\"display:none;\">\r\n            <div class=\"modal-content\">\r\n              <span class=\"close\" role=\"button\" aria-label=\"\u0425\u0430\u0430\u0445\">&times;</span>\r\n              <h3>\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u04AF\u043B\u0434\u044D\u044D\u043D\u044D \u04AF\u04AF...</h3>\r\n              <rating-stars max=\"5\" color=\"orange\" size=\"28px\"></rating-stars>\r\n              <input type=\"text\" id=\"comment\" placeholder=\"\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u04AF\u043B\u0434\u044D\u044D\u043D\u044D \u04AF\u04AF...\">\r\n              <button class=\"submit\" id=\"sendBtn\">\u0418\u043B\u0433\u044D\u044D\u0445</button>\r\n            </div>\r\n          </div>\r\n        </section>\r\n      </main>\r\n    `;\r\n  }\r\n\r\n  markOrderRated(orderId) {\r\n    const key = \"ratedOrders\";\r\n    let arr = [];\r\n    try { arr = JSON.parse(localStorage.getItem(key) || \"[]\"); } catch {}\r\n    const set = new Set(arr.map(String));\r\n    set.add(String(orderId));\r\n    localStorage.setItem(key, JSON.stringify([...set]));\r\n  }\r\n\r\n  isOrderRated(orderId) {\r\n    let arr = [];\r\n    try { arr = JSON.parse(localStorage.getItem(\"ratedOrders\") || \"[]\"); } catch {}\r\n    return arr.map(String).includes(String(orderId));\r\n  }\r\n\r\n  async loadOrders() {\r\n    const listEl = this.querySelector(\"#orderList\");\r\n    if (!listEl) return;\r\n\r\n    let userId = \"\";\r\n    try {\r\n      const resUser = await fetch(\"/api/auth/me\", { credentials: \"include\" });\r\n      if (resUser.ok) {\r\n        const data = await resUser.json();\r\n        userId = data?.user?.id || \"\";\r\n      }\r\n    } catch {\r\n      userId = \"\";\r\n    }\r\n\r\n    if (!userId) {\r\n      location.hash = \"#login\";\r\n      return;\r\n    }\r\n\r\n    const qs = `?customerId=${encodeURIComponent(userId)}`;\r\n\r\n    try {\r\n      const res = await fetch(`${API}/api/orders${qs}`, { credentials: \"include\" });\r\n      const data = await res.json().catch(() => ([]));\r\n      if (!res.ok) throw new Error(data?.error || \"\u0410\u043B\u0434\u0430\u0430\");\r\n\r\n      const filtered = this.filterExpired(Array.isArray(data) ? data : []);\r\n      const notRated = filtered.filter((o) => !this.isOrderRated(o.id));\r\n\r\n      if (Array.isArray(data) && data.length > 0 && filtered.length === 0) {\r\n        window.NumAppState?.resetToGuest(\"order_expired\");\r\n      }\r\n\r\n      this.renderOrders(notRated);\r\n    } catch (e) {\r\n      listEl.innerHTML = `<p class=\"muted\">\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0443\u043D\u0448\u0438\u0445\u0430\u0434 \u0430\u043B\u0434\u0430\u0430: ${this.escapeHtml(e.message)}</p>`;\r\n    }\r\n  }\r\n\r\n  renderOrders(orders) {\r\n    const listEl = this.querySelector(\"#orderList\");\r\n    if (!listEl) return;\r\n\r\n    if (!orders.length) {\r\n      listEl.innerHTML = `<p class=\"muted\">\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0430\u043B\u0433\u0430.</p>`;\r\n      this.selectedOrder = null;\r\n      this.setProgressFromStatus(null);\r\n      this.syncRatingUI(null);\r\n      this.renderCourier(null);\r\n      return;\r\n    }\r\n\r\n    listEl.innerHTML = orders.map((o) => {\r\n      const ts = this.getOrderTimestamp(o) || Date.now();\r\n      const dt = new Date(ts);\r\n      const meta = `${dt.toLocaleDateString()} \u2022 ${dt.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}`;\r\n      const items = Array.isArray(o.items) ? o.items : [];\r\n      const itemsTxt = items.map(it => `${it.name} \u00D7${it.qty}`).join(\" \u00B7 \");\r\n      const totalQty = items.reduce((sum, it) => sum + (Number(it?.qty) || 0), 0);\r\n      const iconSrc = this.getOfferThumb(o?.id) || this.getDeliveryIcon(totalQty);\r\n\r\n      return `\r\n        <div class=\"order-card\" data-order='${encodeURIComponent(JSON.stringify(o))}'>\r\n          <div class=\"order-info\">\r\n            <h3 class=\"order-title\">${this.escapeHtml(o.from_name || \"\")} - ${this.escapeHtml(o.to_name || \"\")}</h3>\r\n            <h4>${this.escapeHtml(meta)}</h4>\r\n            <p>${this.escapeHtml(itemsTxt || \"\u0411\u0430\u0440\u0430\u0430 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\")}</p>\r\n            <p class=\"order-total\">\u0414\u04AF\u043D: ${this.formatPrice(o.total_amount || 0)}</p>\r\n          </div>\r\n          <img src=\"${iconSrc}\" alt=\"hemjee\" width=\"57\" height=\"57\" decoding=\"async\">\r\n        </div>\r\n      `;\r\n    }).join(\"\");\r\n\r\n    this.selectedOrder = orders[0] || null;\r\n    this.setProgressFromStatus(this.selectedOrder?.status);\r\n    this.loadCourierForOrder(this.selectedOrder);\r\n\r\n    const st = String(this.selectedOrder?.status || \"\").toLowerCase();\r\n    this.syncRatingUI(st);\r\n\r\n    if (st === \"delivered\") {\r\n      localStorage.setItem(\"pendingRatingOrder\", String(this.selectedOrder?.id || \"\"));\r\n      this.openRatingModal();\r\n    }\r\n  }\r\n\r\n  bindClicks() {\r\n    this.addEventListener(\"click\", (e) => {\r\n      const card = e.target.closest(\".order-card\");\r\n      if (!card) return;\r\n\r\n      const raw = card.getAttribute(\"data-order\");\r\n      if (!raw) return;\r\n\r\n      const order = JSON.parse(decodeURIComponent(raw));\r\n      this.selectedOrder = order;\r\n\r\n      this.setProgressFromStatus(order.status);\r\n      this.loadCourierForOrder(order);\r\n\r\n      const st = String(order.status || \"\").toLowerCase();\r\n      this.syncRatingUI(st);\r\n    });\r\n  }\r\n\r\n  mapStatusToStep(status) {\r\n    switch ((status || \"\").toLowerCase()) {\r\n      case \"delivering\":\r\n        return 1;\r\n      case \"delivered\":\r\n        return 2;\r\n      default:\r\n        return 0;\r\n    }\r\n  }\r\n\r\n  setProgressFromStatus(status) {\r\n    const stepIndex = this.mapStatusToStep(status);\r\n    localStorage.setItem(\"orderStep\", String(stepIndex));\r\n    this.bindProgress();\r\n  }\r\n\r\n  bindProgress() {\r\n    const stepIndex = parseInt(localStorage.getItem(\"orderStep\"), 10) || 0;\r\n    const steps = this.querySelectorAll(\".step\");\r\n    steps.forEach((step, idx) => {\r\n      step.classList.remove(\"active\", \"completed\");\r\n      if (idx < stepIndex) step.classList.add(\"completed\");\r\n      else if (idx === stepIndex) step.classList.add(\"active\");\r\n    });\r\n  }\r\n\r\n  syncRatingUI(status) {\r\n    const openBtn = this.querySelector(\"#openModal\");\r\n    if (!openBtn) return;\r\n\r\n    const st = String(status || \"\").toLowerCase();\r\n    const delivered = st === \"delivered\";\r\n\r\n    openBtn.style.display = delivered ? \"block\" : \"none\";\r\n\r\n    openBtn.disabled = !delivered;\r\n    openBtn.style.opacity = delivered ? \"\" : \"0.5\";\r\n    openBtn.title = delivered ? \"\" : \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0434\u0443\u0443\u0441\u0441\u0430\u043D\u044B \u0434\u0430\u0440\u0430\u0430 \u04AF\u043D\u044D\u043B\u0433\u044D\u044D \u04E9\u0433\u043D\u04E9\";\r\n    openBtn.textContent = \"\u04AE\u043D\u044D\u043B\u0433\u044D\u044D \u04E9\u0433\u04E9\u0445\";\r\n  }\r\n\r\n  openRatingModal() {\r\n    const modal = this.querySelector(\"#ratingModal\");\r\n    if (modal) modal.style.display = \"block\";\r\n  }\r\n\r\n  closeRatingModal() {\r\n    const modal = this.querySelector(\"#ratingModal\");\r\n    if (modal) modal.style.display = \"none\";\r\n  }\r\n\r\n  onDocClick(e) {\r\n    const modal = this.querySelector(\"#ratingModal\");\r\n    if (!modal) return;\r\n    if (modal.style.display !== \"block\") return;\r\n\r\n    const content = modal.querySelector(\".modal-content\");\r\n    if (!content) return;\r\n\r\n    if (e.target === modal) this.closeRatingModal();\r\n  }\r\n\r\n  bindModal() {\r\n    const modal = this.querySelector(\"#ratingModal\");\r\n    const openBtn = this.querySelector(\"#openModal\");\r\n    const closeBtn = this.querySelector(\".close\");\r\n    const sendBtn = this.querySelector(\"#sendBtn\");\r\n    const ratingEl = this.querySelector(\"rating-stars\");\r\n\r\n    document.removeEventListener(\"click\", this._onDocClick);\r\n    document.addEventListener(\"click\", this._onDocClick);\r\n\r\n    if (openBtn && modal) {\r\n      openBtn.onclick = () => {\r\n        if (!this.selectedOrder?.id) {\r\n          alert(\"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443.\");\r\n          return;\r\n        }\r\n        const st = String(this.selectedOrder?.status || \"\").toLowerCase();\r\n        if (st !== \"delivered\") {\r\n          alert(\"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0434\u0443\u0443\u0441\u0441\u0430\u043D\u044B \u0434\u0430\u0440\u0430\u0430 \u04AF\u043D\u044D\u043B\u0433\u044D\u044D \u04E9\u0433\u043D\u04E9.\");\r\n          return;\r\n        }\r\n        this.openRatingModal();\r\n      };\r\n    }\r\n\r\n    if (closeBtn && modal) {\r\n      closeBtn.onclick = () => this.closeRatingModal();\r\n    }\r\n\r\n    if (sendBtn && modal) {\r\n      sendBtn.onclick = async () => {\r\n        const rating = Number(ratingEl?.getAttribute(\"value\") || 0);\r\n        const comment = this.querySelector(\"#comment\")?.value || \"\";\r\n        const orderId = this.selectedOrder?.id;\r\n\r\n        if (!orderId) {\r\n          alert(\"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443.\");\r\n          return;\r\n        }\r\n\r\n        const uuidRe = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n        if (!uuidRe.test(orderId)) {\r\n          alert(\"\u042D\u043D\u044D \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430\u0434 \u0441\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u04AF\u043B\u0434\u044D\u044D\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0433\u04AF\u0439.\");\r\n          return;\r\n        }\r\n\r\n        if (!Number.isInteger(rating) || rating < 1 || rating > 5) {\r\n          alert(\"\u04AE\u043D\u044D\u043B\u0433\u044D\u044D \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443.\");\r\n          return;\r\n        }\r\n\r\n        try {\r\n          const res = await fetch(\"/api/ratings\", {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({ orderId, stars: rating, comment }),\r\n          });\r\n\r\n          if (!res.ok) {\r\n            const err = await res.json().catch(() => ({}));\r\n            alert(err.error || \"\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u0445\u0430\u0434\u0433\u0430\u043B\u0430\u0445\u0430\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n            return;\r\n          }\r\n\r\n          this.markOrderRated(orderId);\r\n\r\n          this.closeRatingModal();\r\n          localStorage.removeItem(\"pendingRatingOrder\");\r\n          window.dispatchEvent(new Event(\"reviews-updated\"));\r\n\r\n          try {\r\n            await fetch(\"/api/delivery-cart\", { method: \"DELETE\", credentials: \"include\" });\r\n          } catch {\r\n            // ignore\r\n          }\r\n\r\n          await window.NumAppState?.resetToGuest(\"rating_submitted\");\r\n          window.dispatchEvent(new Event(\"delivery-cart-updated\"));\r\n          window.dispatchEvent(new Event(\"order-updated\"));\r\n          if (localStorage.getItem(\"authLoggedIn\") === \"1\") {\r\n            window.NumAppState?.setState(\"customer\", \"rating_submitted\");\r\n          }\r\n\r\n          this.loadOrders();\r\n        } catch {\r\n          alert(\"\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u0445\u0430\u0434\u0433\u0430\u043B\u0430\u0445\u0430\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        }\r\n      };\r\n    }\r\n\r\n    if (ratingEl) {\r\n      ratingEl.addEventListener(\"rate\", (e) => {\r\n        console.log(\"\u04AE\u043D\u044D\u043B\u0433\u044D\u044D:\", e.detail);\r\n      });\r\n    }\r\n  }\r\n\r\n  initOrderStream() {\r\n    const role = localStorage.getItem(\"authRole\");\r\n    if (role !== \"customer\") return;\r\n    if (!window.EventSource) return;\r\n    if (this.orderStream) return;\r\n\r\n    this.orderStream = new EventSource(`${API}/api/orders/stream`);\r\n\r\n    this.handleOrderStatusEvent = (e) => {\r\n      try {\r\n        const data = JSON.parse(e.data || \"{}\");\r\n        if (!data.orderId || !data.status) return;\r\n\r\n        if (!this.selectedOrder || String(this.selectedOrder.id) === String(data.orderId)) {\r\n          if (this.selectedOrder) this.selectedOrder.status = data.status;\r\n\r\n          this.setProgressFromStatus(data.status);\r\n\r\n          const st = String(data.status).toLowerCase();\r\n          this.syncRatingUI(st);\r\n\r\n          if (st === \"delivered\") {\r\n            localStorage.setItem(\"pendingRatingOrder\", String(data.orderId));\r\n            this.openRatingModal();\r\n          }\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n    };\r\n\r\n    this.handleOrderUpdatedEvent = () => {\r\n      this.loadOrders();\r\n    };\r\n\r\n    this.orderStream.addEventListener(\"order-status\", this.handleOrderStatusEvent);\r\n    this.orderStream.addEventListener(\"order-updated\", this.handleOrderUpdatedEvent);\r\n  }\r\n\r\n  filterExpired(orders) {\r\n    return orders.filter((o) => {\r\n      const ts = this.getOrderTimestamp(o);\r\n      if (ts === null) return false;\r\n      return ts >= Date.now();\r\n    });\r\n  }\r\n\r\n  getOrderTimestamp(o) {\r\n    const raw =\r\n      o.scheduled_at ||\r\n      o.scheduledAt ||\r\n      o.created_at ||\r\n      o.createdAt ||\r\n      o.meta ||\r\n      null;\r\n    return this.parseDate(raw);\r\n  }\r\n\r\n  parseDate(val) {\r\n    if (!val) return null;\r\n    const parsed = Date.parse(val);\r\n    if (!Number.isNaN(parsed)) return parsed;\r\n\r\n    const m = String(val).match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4}).*?(\\d{1,2}:\\d{2}\\s*[AP]M)/i);\r\n    if (m) {\r\n      const [_, mm, dd, yyRaw, time] = m;\r\n      const yy = yyRaw.length === 2 ? `20${yyRaw}` : yyRaw;\r\n      const d = new Date(`${yy}-${mm}-${dd} ${time}`);\r\n      if (!Number.isNaN(d.getTime())) return d.getTime();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  formatPrice(v) {\r\n    return Number(v || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  getOfferThumb(orderId) {\r\n    if (!orderId) return \"\";\r\n    try {\r\n      const raw = localStorage.getItem(\"offers\");\r\n      const offers = raw ? JSON.parse(raw) : [];\r\n      const match = Array.isArray(offers)\r\n        ? offers.find((o) => (o?.orderId || o?.id) === orderId)\r\n        : null;\r\n      return match?.thumb || \"\";\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n\r\n  getDeliveryIcon(totalQty) {\r\n    if (totalQty > 10) return \"assets/img/box.svg\";\r\n    if (totalQty >= 2) return \"assets/img/tor.svg\";\r\n    if (totalQty === 1) return \"assets/img/document.svg\";\r\n    return \"assets/img/box.svg\";\r\n  }\r\n\r\n  escapeHtml(value) {\r\n    return String(value ?? \"\")\r\n      .replace(/&/g, \"&amp;\")\r\n      .replace(/</g, \"&lt;\")\r\n      .replace(/>/g, \"&gt;\")\r\n      .replace(/\\\"/g, \"&quot;\")\r\n      .replace(/'/g, \"&#39;\");\r\n  }\r\n}\r\n\r\ncustomElements.define(\"orders-page\", OrdersPage);\r\n", "class ProfilePage extends HTMLElement {\r\n  connectedCallback() {\r\n    this.renderAccessGate();\r\n    this.ensureAuthenticated();\r\n  }\r\n\r\n  renderAccessGate() {\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/profile.css\" />\r\n      <section class=\"profile-page\">\r\n        <div class=\"profile-hero\">\r\n          <div class=\"profile-hero__content\">\r\n            <div class=\"profile-meta\">\r\n              <div class=\"hero-info hero-info--stack\">\r\n                <strong>\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0430\u0447\u0430\u0430\u043B\u0436 \u0431\u0430\u0439\u043D\u0430...</strong>\r\n                <span class=\"muted\">\u041D\u044D\u0432\u0442\u0440\u044D\u043B\u0442 \u0448\u0430\u043B\u0433\u0430\u0436 \u0431\u0430\u0439\u043D\u0430</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  async ensureAuthenticated() {\r\n    try {\r\n      const res = await fetch(\"/api/auth/me\");\r\n      if (!res.ok) {\r\n        this.redirectToLogin();\r\n        return;\r\n      }\r\n      const data = await res.json();\r\n      if (!data?.user?.id) {\r\n        this.redirectToLogin();\r\n        return;\r\n      }\r\n      this.currentUser = data.user;\r\n      this.renderProfile();\r\n    } catch (e) {\r\n      this.redirectToLogin();\r\n    }\r\n  }\r\n\r\n  redirectToLogin() {\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/profile.css\" />\r\n      <section class=\"profile-page\">\r\n        <div class=\"profile-hero\">\r\n          <div class=\"profile-hero__content\">\r\n            <div class=\"profile-meta\">\r\n              <div class=\"hero-info hero-info--stack\">\r\n                <strong>\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0445\u0430\u0440\u0430\u0445\u044B\u043D \u0442\u0443\u043B\u0434 \u043D\u044D\u0432\u0442\u044D\u0440\u043D\u044D \u04AF\u04AF.</strong>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    `;\r\n    location.hash = \"#login\";\r\n  }\r\n\r\n  renderProfile() {\r\n    this.profileData = this.loadProfileData();\r\n    const activeOrders = this.getActiveOrders();\r\n    const activeOrdersMarkup = this.buildActiveOrdersMarkup(activeOrders);\r\n    const reviews = this.getReviews();\r\n    const reviewsMarkup = this.buildReviewsMarkup(reviews);\r\n    const reviewsModalMarkup = this.buildReviewsMarkup(reviews);\r\n    const orderHistory = this.getOrderHistory();\r\n    const deliveryHistory = this.getDeliveryHistory();\r\n    const isCourier = this.currentUser?.role === \"courier\";\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/profile.css\" />\r\n      <section class=\"profile-page\">\r\n        <div class=\"profile-hero\">\r\n          <div class=\"profile-hero__content\">\r\n            <div class=\"avatar-wrap\">\r\n              <img src=\"${this.profileData.avatar || 'assets/img/profile.jpg'}\" alt=\"\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0437\u0443\u0440\u0430\u0433\" class=\"avatar profile-avatar\" width=\"120\" height=\"120\" decoding=\"async\" />\r\n            </div>\r\n\r\n            <div class=\"profile-meta\">\r\n              <div class=\"hero-info hero-info--stack\">\r\n                <div><span class=\"label\">\u041D\u044D\u0440:</span><strong class=\"profile-name\">${this.profileData.name}</strong></div>\r\n                <div><span class=\"label\">\u0423\u0442\u0430\u0441:</span><strong class=\"profile-phone\">${this.profileData.phone}</strong></div>\r\n                <div><span class=\"label\">ID:</span><strong class=\"profile-id\">${this.profileData.id}</strong></div>\r\n                <div><span class=\"label\">\u0418\u043C\u044D\u0439\u043B:</span><strong class=\"profile-email\">${this.profileData.email}</strong></div>\r\n              </div>\r\n\r\n              <div class=\"hero-actions\">\r\n                <button class=\"btn primary\" data-modal-open=\"ordersModal\" id=\"openOrderBtn\">\u041C\u0438\u043D\u0438\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430</button>\r\n                <button class=\"btn ghost\" data-modal-open=\"deliveryModal\" id=\"openDeliveryBtn\">\u041C\u0438\u043D\u0438\u0439 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442</button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"hero-stats\">\r\n              <div class=\"stat-card\">\r\n                <p>\u041D\u0438\u0439\u0442 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430</p>\r\n                <strong id=\"orderTotal\">0</strong>\r\n              </div>\r\n              ${isCourier ? `\r\n                <div class=\"stat-card\">\r\n                  <p>\u0414\u0443\u043D\u0434\u0430\u0436 \u04AF\u043D\u044D\u043B\u0433\u044D\u044D</p>\r\n                  <div class=\"stars avg-stars\" aria-label=\"0 \u043E\u0434\">\r\n                    <span>\u2605</span><span>\u2605</span><span>\u2605</span><span>\u2605</span><span>\u2605</span>\r\n                  </div>\r\n                  <small class=\"avg-rating-text\">0 / 5</small>\r\n                </div>\r\n              ` : \"\"}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"profile-actions-desktop\">\r\n          <button class=\"action-card\" type=\"button\" data-modal-open=\"ordersModal\">\r\n            <span class=\"action-title\">\u041C\u0438\u043D\u0438\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430</span>\r\n            <span class=\"action-subtitle\">\u0422\u04AF\u04AF\u0445, \u0442\u04E9\u043B\u04E9\u0432\u0438\u0439\u0433 \u0445\u0430\u0440\u0430\u0445</span>\r\n          </button>\r\n          <button class=\"action-card\" type=\"button\" data-modal-open=\"deliveryModal\">\r\n            <span class=\"action-title\">\u041C\u0438\u043D\u0438\u0439 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442</span>\r\n            <span class=\"action-subtitle\">\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u043C\u044D\u0434\u044D\u044D\u043B\u044D\u043B</span>\r\n          </button>\r\n        </div>\r\n\r\n        ${isCourier ? `\r\n          <div class=\"profile-grid\">\r\n            <article class=\"profile-card reviews\">\r\n              <header>\r\n                <div>\r\n                  <p class=\"eyebrow\">\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B</p>\r\n                </div>\r\n                <button class=\"ghost-btn small open-reviews\">\u0411\u04AF\u0433\u0434\u0438\u0439\u0433 \u0445\u0430\u0440\u0430\u0445</button>\r\n              </header>\r\n\r\n              <div class=\"review-list\">${reviewsMarkup}</div>\r\n            </article>\r\n          </div>\r\n        ` : \"\"}\r\n      </section>\r\n\r\n      <div class=\"modal-backdrop\" data-modal=\"profileModal\">\r\n        <div class=\"modal-card\">\r\n          <header class=\"modal-header\">\r\n            <div>\r\n              <p class=\"eyebrow\">\u041F\u0440\u043E\u0444\u0430\u0439\u043B \u0437\u0430\u0441\u0430\u0445</p>\r\n              <h3>\u041C\u044D\u0434\u044D\u044D\u043B\u043B\u044D\u044D \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445</h3>\r\n            </div>\r\n            <button class=\"icon-btn close-modal\" data-close=\"profileModal\">\u00D7</button>\r\n          </header>\r\n          <form id=\"profileForm\" class=\"modal-body\">\r\n            <label>\r\n              <span>\u041D\u044D\u0440</span>\r\n              <input type=\"text\" name=\"name\" required />\r\n            </label>\r\n            <label>\r\n              <span>\u0423\u0442\u0430\u0441</span>\r\n              <input type=\"tel\" name=\"phone\" required />\r\n            </label>\r\n            <label>\r\n              <span>\u0418\u043C\u044D\u0439\u043B</span>\r\n              <input type=\"email\" name=\"email\" required />\r\n            </label>\r\n            <label>\r\n              <span>ID</span>\r\n              <input type=\"text\" name=\"id\" />\r\n            </label>\r\n            <label>\r\n              <span>\u0417\u0443\u0440\u0430\u0433 (URL)</span>\r\n              <input type=\"url\" name=\"avatar\" placeholder=\"assets/img/profile.jpg\" />\r\n            </label>\r\n            <div class=\"modal-actions\">\r\n              <button type=\"button\" class=\"btn ghost close-modal\" data-close=\"profileModal\">\u0411\u043E\u043B\u0438\u0445</button>\r\n              <button type=\"submit\" class=\"btn primary\">\u0425\u0430\u0434\u0433\u0430\u043B\u0430\u0445</button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n      ${isCourier ? `\r\n        <div class=\"modal-backdrop\" data-modal=\"reviewsModal\">\r\n          <div class=\"modal-card\">\r\n            <header class=\"modal-header\">\r\n              <div>\r\n                <p class=\"eyebrow\">\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u043B\u04AF\u04AF\u0434</p>\r\n              </div>\r\n              <button class=\"icon-btn close-modal\" data-close=\"reviewsModal\">\u00D7</button>\r\n            </header>\r\n            <div class=\"modal-body review-list modal-scroll\">\r\n              ${reviewsModalMarkup}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ` : \"\"}\r\n\r\n      <div class=\"modal-backdrop\" data-modal=\"ordersModal\">\r\n        <div class=\"modal-card\">\r\n          <header class=\"modal-header\">\r\n            <div>\r\n              <h3 class=\"modal-title\">\u041C\u0438\u043D\u0438\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430</h3>\r\n            </div>\r\n            <button class=\"icon-btn close-modal\" data-close=\"ordersModal\">\u00D7</button>\r\n          </header>\r\n          <div class=\"modal-body modal-scroll history-list\" data-history=\"orders\">\r\n            ${this.buildHistoryMarkup(orderHistory, '\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"modal-backdrop\" data-modal=\"deliveryModal\">\r\n        <div class=\"modal-card\">\r\n          <header class=\"modal-header\">\r\n            <div>\r\n              <h3 class=\"modal-title\">\u041C\u0438\u043D\u0438\u0439 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442</h3>\r\n            </div>\r\n            <button class=\"icon-btn close-modal\" data-close=\"deliveryModal\">\u00D7</button>\r\n          </header>\r\n          <div class=\"modal-body modal-scroll history-list\" data-history=\"deliveries\">\r\n            ${this.buildHistoryMarkup(deliveryHistory, '\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"history\">\r\n        <section class=\"btn-order\" id=\"openOrderBtn\">\r\n          \u041C\u0438\u043D\u0438\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430\r\n          <div class=\"history-inline\" data-history=\"orders\">\r\n            ${this.buildHistoryMarkup(orderHistory, '\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439')}\r\n          </div>\r\n        </section>\r\n        <section class=\"btn-delivery\" id=\"openDeliveryBtn\">\r\n          \u041C\u0438\u043D\u0438\u0439 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442\r\n          <div class=\"history-inline\" data-history=\"deliveries\">\r\n            ${this.buildHistoryMarkup(deliveryHistory, '\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439')}\r\n          </div>\r\n        </section>\r\n      </div>\r\n    `;\r\n\r\n    this.bindProfileData();\r\n    this.attachNavigation();\r\n    this.attachModalHandlers();\r\n    this.hydrateProfileFromApi();\r\n    this.loadActiveOrder();\r\n    this.loadOrderStats();\r\n    this.handleReviewsUpdated = this.loadReviews.bind(this);\r\n    window.addEventListener(\"reviews-updated\", this.handleReviewsUpdated);\r\n    this.loadReviews();\r\n    this.loadOrderHistory();\r\n    this.loadDeliveryHistory();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.handleReviewsUpdated) {\r\n      window.removeEventListener(\"reviews-updated\", this.handleReviewsUpdated);\r\n    }\r\n  }\r\n\r\n  loadProfileData() {\r\n    return {\r\n      name: '',\r\n      phone: '',\r\n      email: '',\r\n      id: '',\r\n      avatar: 'assets/img/profile.jpg',\r\n    };\r\n  }\r\n\r\n  async hydrateProfileFromApi() {\r\n    try {\r\n      const res = await fetch(\"/api/auth/me\");\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      const user = data?.user;\r\n      if (!user) return;\r\n      this.profileData = {\r\n        ...this.profileData,\r\n        name: user.name || this.profileData.name,\r\n        phone: user.phone || this.profileData.phone,\r\n        id: user.student_id || this.profileData.id,\r\n        avatar: user.avatar || this.profileData.avatar,\r\n      };\r\n      this.bindProfileData();\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  getActiveOrders() {\r\n    return [];\r\n  }\r\n\r\n  getReviews() {\r\n    return [];\r\n  }\r\n\r\n  getOrderHistory() {\r\n    return [];\r\n  }\r\n\r\n  getDeliveryHistory() {\r\n    return [];\r\n  }\r\n\r\n  buildActiveOrdersMarkup(orders) {\r\n    if (!orders.length) {\r\n      return '<span class=\"pill pill--muted\">\u0418\u0434\u044D\u0432\u0445\u0442\u044D\u0439 \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0430\u043B\u0433\u0430</span>';\r\n    }\r\n    return orders.map((order) => {\r\n      const route = [order.from, order.to].filter(Boolean).join(' \u2192 ');\r\n      const item = order.item ? ` \u00B7 ${order.item}` : '';\r\n      return `<span class=\"pill pill--order\">${route || '\u0428\u0438\u043D\u044D \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u0430'}${item}</span>`;\r\n    }).join('');\r\n  }\r\n\r\n  buildReviewsMarkup(list) {\r\n    if (!list.length) {\r\n      return `<p class=\"muted\">\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u0431\u0430\u0439\u0445\u0433\u04AF\u0439</p>`;\r\n    }\r\n    const safeItems = list\r\n      .map((r) => ({ ...r, safeText: this.cleanReviewText(r.text) }))\r\n      .filter((r) => r.safeText);\r\n    if (!safeItems.length) {\r\n      return `<p class=\"muted\">\u0421\u044D\u0442\u0433\u044D\u0433\u0434\u044D\u043B \u0431\u0430\u0439\u0445\u0433\u04AF\u0439</p>`;\r\n    }\r\n    return safeItems.map((r) => `\r\n      <div class=\"review\">\r\n        <div>\r\n          <p>${r.safeText}</p>\r\n        </div>\r\n        <span class=\"stars\" aria-label=\"${r.stars} \u043E\u0434\">${this.toStars(r.stars)}</span>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  escapeHtml(value) {\r\n    return String(value ?? \"\")\r\n      .replace(/&/g, \"&amp;\")\r\n      .replace(/</g, \"&lt;\")\r\n      .replace(/>/g, \"&gt;\")\r\n      .replace(/\\\"/g, \"&quot;\")\r\n      .replace(/'/g, \"&#39;\");\r\n  }\r\n\r\n  cleanReviewText(value) {\r\n    const raw = String(value ?? \"\").trim();\r\n    if (!raw) return \"\";\r\n    if (/<[^>]*>/.test(raw)) return \"\";\r\n    if (/&lt;|&gt;|&#60;|&#62;/i.test(raw)) return \"\";\r\n    return this.escapeHtml(raw);\r\n  }\r\n\r\n  buildHistoryMarkup(list, emptyText) {\r\n    if (!list.length) {\r\n      return `<div class=\"muted\">${emptyText}</div>`;\r\n    }\r\n    return list.map((item, idx) => {\r\n      const icon = this.getHistoryIcon(idx);\r\n      return `\r\n      <div class=\"history-card\">\r\n        <div class=\"history-icon\" aria-hidden=\"true\">\r\n          <img src=\"${icon}\" alt=\"\" width=\"32\" height=\"32\" decoding=\"async\">\r\n        </div>\r\n        <div class=\"history-info\">\r\n          <h4>${item.title}</h4>\r\n          <p class=\"muted\">${item.detail}</p>\r\n        </div>\r\n        <div class=\"history-price\">${item.price || ''}</div>\r\n      </div>\r\n    `;\r\n    }).join('');\r\n  }\r\n\r\n  formatPrice(amount) {\r\n    return Number(amount || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  formatHistoryDetail(item) {\r\n    const ts = this.getOrderTimestamp(item);\r\n    if (!ts) return \"\";\r\n    const dt = new Date(ts);\r\n    return `${dt.toLocaleDateString()} \u00B7 ${dt.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}`;\r\n  }\r\n\r\n  async loadOrderHistory() {\r\n    try {\r\n      if (this.currentUser?.role && this.currentUser.role !== \"customer\") {\r\n        this.updateHistoryUI(\"orders\", [], \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\");\r\n        return;\r\n      }\r\n      this.updateHistoryMessage(\"orders\", \"\u0410\u0447\u0430\u0430\u043B\u043B\u0430\u0436 \u0431\u0430\u0439\u043D\u0430...\");\r\n      const res = await fetch(\"/api/orders/history/customer\", { credentials: \"include\" });\r\n      const data = await res.json().catch(() => ({}));\r\n      if (!res.ok) return;\r\n      const items = Array.isArray(data?.items) ? data.items : [];\r\n      const list = items.map((item) => ({\r\n        title: `${item.from_name || \"\"} \u2192 ${item.to_name || \"\"}`.trim(),\r\n        detail: this.formatHistoryDetail(item),\r\n        price: this.formatPrice(item.total_amount || 0),\r\n      }));\r\n      this.updateHistoryUI(\"orders\", list, \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\");\r\n    } catch (e) {\r\n      this.updateHistoryMessage(\"orders\", \"\u0410\u0447\u0430\u0430\u043B\u043B\u0430\u0436 \u0447\u0430\u0434\u0441\u0430\u043D\u0433\u04AF\u0439\");\r\n    }\r\n  }\r\n\r\n  async loadDeliveryHistory() {\r\n    try {\r\n      if (this.currentUser?.role && this.currentUser.role !== \"courier\") {\r\n        this.updateHistoryUI(\"deliveries\", [], \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\");\r\n        return;\r\n      }\r\n      this.updateHistoryMessage(\"deliveries\", \"\u0410\u0447\u0430\u0430\u043B\u043B\u0430\u0436 \u0431\u0430\u0439\u043D\u0430...\");\r\n      const res = await fetch(\"/api/orders/history/courier\", { credentials: \"include\" });\r\n      const data = await res.json().catch(() => ({}));\r\n      if (!res.ok) return;\r\n      const items = Array.isArray(data?.items) ? data.items : [];\r\n      const list = items.map((item) => ({\r\n        title: `${item.from_name || \"\"} \u2192 ${item.to_name || \"\"}`.trim(),\r\n        detail: this.formatHistoryDetail(item),\r\n        price: this.formatPrice(item.total_amount || 0),\r\n      }));\r\n      this.updateHistoryUI(\"deliveries\", list, \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\");\r\n    } catch (e) {\r\n      this.updateHistoryMessage(\"deliveries\", \"\u0410\u0447\u0430\u0430\u043B\u043B\u0430\u0436 \u0447\u0430\u0434\u0441\u0430\u043D\u0433\u04AF\u0439\");\r\n    }\r\n  }\r\n\r\n  updateHistoryUI(type, list, emptyText) {\r\n    const html = this.buildHistoryMarkup(list, emptyText);\r\n    this.querySelectorAll(`[data-history=\"${type}\"]`).forEach((el) => {\r\n      el.innerHTML = html;\r\n    });\r\n  }\r\n\r\n  updateHistoryMessage(type, message) {\r\n    const html = `<div class=\"muted\">${this.escapeHtml(message)}</div>`;\r\n    this.querySelectorAll(`[data-history=\"${type}\"]`).forEach((el) => {\r\n      el.innerHTML = html;\r\n    });\r\n  }\r\n\r\n  getHistoryIcon(idx = 0) {\r\n    const icons = [\r\n      'assets/img/document.svg',\r\n      'assets/img/tor.svg',\r\n      'assets/img/box.svg',\r\n    ];\r\n    return icons[idx % icons.length];\r\n  }\r\n\r\n\r\n\r\n  bindProfileData() {\r\n    const { name, phone, email, id, avatar } = this.profileData;\r\n    const nameEls = this.querySelectorAll('.profile-name');\r\n    nameEls.forEach((el) => { el.textContent = name; });\r\n\r\n    const phoneEl = this.querySelector('.profile-phone');\r\n    if (phoneEl) {\r\n      phoneEl.textContent = phone;\r\n      const row = phoneEl.closest('div');\r\n      if (row) row.style.display = phone ? '' : 'none';\r\n    }\r\n\r\n    const emailEl = this.querySelector('.profile-email');\r\n    if (emailEl) {\r\n      emailEl.textContent = email;\r\n      const row = emailEl.closest('div');\r\n      if (row) row.style.display = email ? '' : 'none';\r\n    }\r\n\r\n    const idEl = this.querySelector('.profile-id');\r\n    if (idEl) {\r\n      idEl.textContent = id;\r\n      const row = idEl.closest('div');\r\n      if (row) row.style.display = id ? '' : 'none';\r\n    }\r\n\r\n    const avatarEl = this.querySelector('.profile-avatar');\r\n    if (avatarEl) avatarEl.src = avatar || 'assets/img/profile.jpg';\r\n\r\n    const form = this.querySelector('#profileForm');\r\n    if (form) {\r\n      form.name.value = name;\r\n      form.phone.value = phone;\r\n      form.email.value = email;\r\n      form.id.value = id;\r\n      form.avatar.value = avatar || '';\r\n    }\r\n  }\r\n\r\n  attachNavigation() {\r\n    const navButtons = this.querySelectorAll('[data-nav]');\r\n    navButtons.forEach((btn) => {\r\n      btn.addEventListener('click', () => {\r\n        const target = btn.getAttribute('data-nav');\r\n        if (target) {\r\n          location.hash = target;\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  attachModalHandlers() {\r\n    const editBtn = this.querySelector('#editProfileBtn');\r\n    if (editBtn) {\r\n      editBtn.addEventListener('click', () => this.toggleModal('profileModal', true));\r\n    }\r\n\r\n    this.querySelectorAll('[data-modal-open]').forEach((btn) => {\r\n      btn.addEventListener('click', () => {\r\n        const id = btn.getAttribute('data-modal-open');\r\n        this.toggleModal(id, true);\r\n      });\r\n    });\r\n\r\n    const reviewBtn = this.querySelector('.open-reviews');\r\n    if (reviewBtn) {\r\n      reviewBtn.addEventListener('click', () => this.toggleModal('reviewsModal', true));\r\n    }\r\n\r\n    this.querySelectorAll('.close-modal').forEach((btn) => {\r\n      btn.addEventListener('click', () => {\r\n        const id = btn.getAttribute('data-close');\r\n        this.toggleModal(id, false);\r\n      });\r\n    });\r\n\r\n    this.querySelectorAll('.modal-backdrop').forEach((backdrop) => {\r\n      backdrop.addEventListener('click', (e) => {\r\n        if (e.target === backdrop) {\r\n          const id = backdrop.getAttribute('data-modal');\r\n          this.toggleModal(id, false);\r\n        }\r\n      });\r\n    });\r\n\r\n    const form = this.querySelector('#profileForm');\r\n    if (form) {\r\n      form.addEventListener('submit', (e) => {\r\n        e.preventDefault();\r\n        this.profileData = {\r\n          ...this.profileData,\r\n          name: form.name.value.trim(),\r\n          phone: form.phone.value.trim(),\r\n          email: form.email.value.trim(),\r\n          id: form.id.value.trim(),\r\n          avatar: this.profileData.avatar,\r\n        };\r\n        this.saveProfileToApi();\r\n        this.bindProfileData();\r\n        window.dispatchEvent(new Event('user-updated'));\r\n        this.toggleModal('profileModal', false);\r\n      });\r\n    }\r\n  }\r\n\r\n  async loadReviews() {\r\n    try {\r\n      if (this.currentUser?.role !== \"courier\") {\r\n        this.updateReviewsUI([]);\r\n        return;\r\n      }\r\n\r\n      const courierRes = await fetch(`/api/ratings/courier/${this.currentUser.id}`);\r\n      if (!courierRes.ok) return;\r\n      const courierData = await courierRes.json();\r\n      const items = Array.isArray(courierData?.items) ? courierData.items : [];\r\n      const reviews = items.map((r) => ({\r\n        text: r.comment || \"\",\r\n        stars: r.stars,\r\n      }));\r\n      this.updateReviewsUI(reviews);\r\n      this.updateAverageRating(courierData?.courier?.rating_avg);\r\n    } catch (e) {\r\n      console.error(\"Load reviews error:\", e);\r\n    }\r\n  }\r\n\r\n  updateReviewsUI(reviews) {\r\n    const content = this.buildReviewsMarkup(reviews);\r\n    const lists = this.querySelectorAll(\".review-list\");\r\n    if (lists[0]) lists[0].innerHTML = content;\r\n    if (lists[1]) lists[1].innerHTML = content;\r\n  }\r\n\r\n  toStars(value) {\r\n    const count = Math.max(0, Math.min(5, Number(value) || 0));\r\n    return \"\u2605\u2605\u2605\u2605\u2605\".slice(0, count) + \"\u2606\u2606\u2606\u2606\u2606\".slice(0, 5 - count);\r\n  }\r\n\r\n  updateAverageRating(avg) {\r\n    const starsWrap = this.querySelector(\".avg-stars\");\r\n    const textEl = this.querySelector(\".avg-rating-text\");\r\n    if (!starsWrap || !textEl) return;\r\n\r\n    const safeAvg = Math.max(0, Math.min(5, Number(avg) || 0));\r\n    const filledCount = Math.round(safeAvg);\r\n    const stars = starsWrap.querySelectorAll(\"span\");\r\n    stars.forEach((star, idx) => {\r\n      star.classList.toggle(\"dim\", idx >= filledCount);\r\n    });\r\n    starsWrap.setAttribute(\"aria-label\", `${safeAvg.toFixed(1)} \u043E\u0434`);\r\n    textEl.textContent = `${safeAvg.toFixed(1)} / 5`;\r\n  }\r\n\r\n  async saveProfileToApi() {\r\n    try {\r\n      await fetch(\"/api/auth/me\", {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          name: this.profileData.name,\r\n          phone: this.profileData.phone,\r\n          studentId: this.profileData.id,\r\n          avatar: this.profileData.avatar,\r\n        }),\r\n      });\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  async loadActiveOrder() {\r\n    try {\r\n      const res = await fetch(\"/api/active-order\");\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      const order = data?.order;\r\n      if (!order) return;\r\n      const activeOrdersMarkup = this.buildActiveOrdersMarkup([order]);\r\n      const pillWrap = this.querySelector(\".pill\");\r\n      if (pillWrap) {\r\n        pillWrap.outerHTML = activeOrdersMarkup;\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  async loadOrderStats() {\r\n    const totalEl = this.querySelector(\"#orderTotal\");\r\n    if (!totalEl) return;\r\n\r\n    const userId = this.currentUser?.id;\r\n    if (!userId) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/orders?customerId=${encodeURIComponent(userId)}`, {\r\n        credentials: \"include\",\r\n      });\r\n      const data = await res.json().catch(() => []);\r\n      if (!res.ok || !Array.isArray(data)) return;\r\n\r\n      const total = data.length;\r\n      totalEl.textContent = String(total);\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  getOrderTimestamp(o) {\r\n    const raw =\r\n      o.scheduled_at ||\r\n      o.scheduledAt ||\r\n      o.created_at ||\r\n      o.createdAt ||\r\n      o.meta ||\r\n      null;\r\n    return this.parseDate(raw);\r\n  }\r\n\r\n  parseDate(val) {\r\n    if (!val) return null;\r\n    const parsed = Date.parse(val);\r\n    if (!Number.isNaN(parsed)) return parsed;\r\n\r\n    const m = String(val).match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2,4}).*?(\\d{1,2}:\\d{2}\\s*[AP]M)/i);\r\n    if (m) {\r\n      const [_, mm, dd, yyRaw, time] = m;\r\n      const yy = yyRaw.length === 2 ? `20${yyRaw}` : yyRaw;\r\n      const d = new Date(`${yy}-${mm}-${dd} ${time}`);\r\n      if (!Number.isNaN(d.getTime())) return d.getTime();\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  toggleModal(id, open) {\r\n    const modal = this.querySelector(`[data-modal=\"${id}\"]`);\r\n    if (!modal) return;\r\n    modal.classList.toggle('open', open);\r\n  }\r\n}\r\n\r\ncustomElements.define('profile-page', ProfilePage);\r\n", "class PayPage extends HTMLElement {\n  connectedCallback() {\n    this.handleRouteChange = this.handleRouteChange.bind(this);\n    window.addEventListener(\"hashchange\", this.handleRouteChange);\n    this.handleRouteChange();\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener(\"hashchange\", this.handleRouteChange);\n  }\n\n  async handleRouteChange() {\n    if (location.hash !== \"#pay\") return;\n\n    // \uD83D\uDD10 ROLE GUARD (only logged-in courier)\n    const loggedIn = localStorage.getItem(\"authLoggedIn\");\n    const role = localStorage.getItem(\"authRole\");\n\n    if (loggedIn !== \"1\" || role !== \"courier\") {\n      location.hash = \"#login\";\n      return;\n    }\n\n    // \u2705 identify user (fallback to API if localStorage missing)\n    let phone = (localStorage.getItem(\"authPhone\") || \"\").trim();\n    let studentId = (localStorage.getItem(\"authStudentId\") || \"\").trim();\n    let userId = (localStorage.getItem(\"authUserKey\") || \"\").trim();\n\n    if (!phone && !studentId) {\n      try {\n        const meRes = await fetch(\"/api/auth/me\", { credentials: \"include\" });\n        if (meRes.ok) {\n          const data = await meRes.json();\n          const user = data?.user || {};\n          phone = String(user.phone || \"\").trim();\n          studentId = String(user.student_id || user.studentId || \"\").trim();\n          userId = String(user.id || userId || \"\").trim();\n        }\n      } catch {\n        // ignore\n      }\n    }\n\n    const keySeed = studentId || phone || userId || \"courier\";\n    const paidKey = `courierPaid:${keySeed}`;\n    const isPaid = () => localStorage.getItem(paidKey) === \"1\";\n\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/pay.css\">\r\n      <div class=\"pay-wrap\">\r\n        <div class=\"pay-card\">\r\n          <div class=\"pay-head\">\r\n            <h2>\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0439\u043D \u0442\u04E9\u043B\u0431\u04E9\u0440</h2>\r\n            <button class=\"btn-close\" type=\"button\" aria-label=\"\u0425\u0430\u0430\u0445\">\u2715</button>\r\n          </div>\r\n\r\n          <p class=\"pay-note\">\u0422\u04E9\u043B\u0431\u04E9\u0440\u04E9\u04E9 \u0441\u043E\u043D\u0433\u043E\u043E\u0434 \u0442\u04E9\u043B\u0431\u04E9\u0440\u04E9\u04E9 \u0445\u0438\u0439\u0441\u043D\u044D\u044D\u0440 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0445\u044D\u0441\u044D\u0433 \u043D\u044D\u044D\u0433\u0434\u044D\u043D\u044D.</p>\r\n\r\n          <div class=\"grid\">\r\n            <div class=\"block\">\r\n              <h4>\u0411\u0430\u0433\u0446 \u0441\u043E\u043D\u0433\u043E\u0445</h4>\r\n              <div class=\"plan-grid\">\r\n                <label class=\"plan-card\">\r\n                  <input type=\"radio\" name=\"paymentPlan\" value=\"monthly\" checked>\r\n                  <span>\u0421\u0430\u0440\u0434 3000\u20AE</span>\r\n                </label>\r\n                <label class=\"plan-card\">\r\n                  <input type=\"radio\" name=\"paymentPlan\" value=\"two-months\">\r\n                  <span>2 \u0441\u0430\u0440\u0434 5000\u20AE</span>\r\n                </label>\r\n                <label class=\"plan-card\">\r\n                  <input type=\"radio\" name=\"paymentPlan\" value=\"two-weeks\">\r\n                  <span>14 \u0445\u043E\u043D\u043E\u0433\u0442 2000\u20AE</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"block\">\r\n              <h4>\u0422\u04E9\u043B\u0431\u04E9\u0440\u0438\u0439\u043D \u0430\u0440\u0433\u0430</h4>\r\n              <div class=\"method-grid\">\r\n                <label class=\"method-card\">\r\n                  <input type=\"radio\" name=\"paymentMethod\" value=\"card\" checked>\r\n                  <span>\u041A\u0430\u0440\u0442\u0430\u0430\u0440 \u0442\u04E9\u043B\u04E9\u0445</span>\r\n                </label>\r\n                <label class=\"method-card\">\r\n                  <input type=\"radio\" name=\"paymentMethod\" value=\"qpay\">\r\n                  <span>QPay-\u0440 \u0442\u04E9\u043B\u04E9\u0445</span>\r\n                </label>\r\n              </div>\r\n\r\n              <div class=\"payment-details payment-details--card\">\r\n                <div class=\"form-group\">\r\n                  <label for=\"cardNumber\">\u041A\u0430\u0440\u0442\u044B\u043D \u0434\u0443\u0433\u0430\u0430\u0440</label>\r\n                  <input id=\"cardNumber\" type=\"text\" inputmode=\"numeric\" placeholder=\"0000 0000 0000 0000\">\r\n                </div>\r\n                <div class=\"form-row\">\r\n                  <div class=\"form-group\">\r\n                    <label for=\"cardExp\">\u0414\u0443\u0443\u0441\u0430\u0445 \u0445\u0443\u0433\u0430\u0446\u0430\u0430</label>\r\n                    <input id=\"cardExp\" type=\"text\" placeholder=\"MM/YY\">\r\n                  </div>\r\n                  <div class=\"form-group\">\r\n                    <label for=\"cardCvv\">CVV</label>\r\n                    <input id=\"cardCvv\" type=\"password\" inputmode=\"numeric\" placeholder=\"***\">\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"payment-details payment-details--qpay\" hidden>\r\n                <div class=\"qpay-box\">\r\n                  <div class=\"qpay-qr\">QR</div>\r\n                  <div>\r\n                    <strong>QPay \u0442\u04E9\u043B\u0431\u04E9\u0440</strong>\r\n                    <p>QR \u043A\u043E\u0434 \u0443\u043D\u0448\u0443\u0443\u043B\u0436 \u0442\u04E9\u043B\u043D\u04E9 \u04AF\u04AF.</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"actions\">\r\n                <button class=\"btn-pay\" type=\"button\">\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0445</button>\r\n                <button class=\"btn-go\" type=\"button\" hidden>\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0440\u04AF\u04AF \u043E\u0440\u043E\u0445</button>\r\n                <p class=\"status\" hidden>\u2705 \u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0433\u0434\u0441\u04E9\u043D.</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    const closeBtn = this.querySelector(\".btn-close\");\r\n    const payBtn = this.querySelector(\".btn-pay\");\r\n    const goBtn = this.querySelector(\".btn-go\");\r\n    const statusEl = this.querySelector(\".status\");\r\n    const methodRadios = this.querySelectorAll('input[name=\"paymentMethod\"]');\r\n\r\n    const showPaidUI = () => {\r\n      statusEl && (statusEl.hidden = false);\r\n      if (payBtn) {\r\n        payBtn.disabled = true;\r\n        payBtn.textContent = \"\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0433\u0434\u0441\u04E9\u043D\";\r\n      }\r\n      goBtn && (goBtn.hidden = false);\r\n    };\r\n\r\n    const showUnpaidUI = () => {\r\n      statusEl && (statusEl.hidden = true);\r\n      if (payBtn) {\r\n        payBtn.disabled = false;\r\n        payBtn.textContent = \"\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0445\";\r\n      }\r\n      goBtn && (goBtn.hidden = true);\r\n    };\r\n\r\n    const syncMethodUI = () => {\r\n      const method = this.querySelector('input[name=\"paymentMethod\"]:checked')?.value || \"card\";\r\n      const card = this.querySelector(\".payment-details--card\");\r\n      const qpay = this.querySelector(\".payment-details--qpay\");\r\n      card && (card.hidden = method !== \"card\");\r\n      qpay && (qpay.hidden = method !== \"qpay\");\r\n    };\r\n\r\n    closeBtn?.addEventListener(\"click\", () => (location.hash = \"#profile\"));\r\n    methodRadios.forEach((r) => r.addEventListener(\"change\", syncMethodUI));\r\n    syncMethodUI();\r\n\r\n    // \u2705 init paid sync for current session (delivery guard uses courierPaid)\r\n    localStorage.setItem(\"courierPaid\", isPaid() ? \"1\" : \"0\");\r\n    if (isPaid()) showPaidUI();\r\n    else showUnpaidUI();\r\n\r\n    payBtn?.addEventListener(\"click\", () => {\r\n      // mock payment success\r\n      localStorage.setItem(paidKey, \"1\");     // \u2705 per-user\r\n      localStorage.setItem(\"courierPaid\", \"1\"); // \u2705 current session sync\r\n      showPaidUI();\r\n      window.dispatchEvent(new Event(\"user-updated\"));\r\n    });\r\n\r\n    goBtn?.addEventListener(\"click\", () => {\r\n      location.hash = \"#delivery\";\r\n    });\r\n  }\r\n}\r\n\r\ncustomElements.define(\"pay-page\", PayPage);\r\n", "class LoginPage extends HTMLElement {\r\n  connectedCallback() {\r\n    const API = \"http://localhost:3000\";\r\n    this.currentMode = \"login\";\r\n    this.currentRole = \"customer\";\r\n    this.innerHTML = `\r\n      <link rel=\"stylesheet\" href=\"assets/css/login.css\">\r\n      <div class=\"card\" role=\"dialog\" aria-labelledby=\"login-title\">\r\n        <div style=\"display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;\">\r\n          <div style=\"width:18px\"></div>\r\n          <strong id=\"login-title\">\u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445</strong>\r\n          \r\n          <div class=\"close\">\u2715</div>\r\n        </div>\r\n\r\n        <div class=\"auth-tabs\" role=\"tablist\" aria-label=\"\u041D\u044D\u0432\u0442\u0440\u044D\u0445 \u044D\u0441\u0432\u044D\u043B \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\">\r\n          <button class=\"tab-btn is-active\" type=\"button\" data-mode=\"login\" role=\"tab\" aria-selected=\"true\">\r\n            \u041D\u044D\u0432\u0442\u0440\u044D\u0445\r\n          </button>\r\n          <button class=\"tab-btn\" type=\"button\" data-mode=\"register\" role=\"tab\" aria-selected=\"false\">\r\n            \u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"login-tabs-row\">\r\n          <div class=\"subtitle\">\r\n            \u041D\u044D\u0440 \u0431\u043E\u043B\u043E\u043D \u043D\u0443\u0443\u0446 \u04AF\u0433\u044D\u044D \u0430\u0448\u0438\u0433\u043B\u0430\u043D \u043D\u044D\u0432\u0442\u044D\u0440\u043D\u044D.\r\n          </div>\r\n           <div class=\"login-tabs register-only\" role=\"tablist\" aria-label=\"\u0411\u04AF\u0440\u0442\u0433\u044D\u043B\u0438\u0439\u043D \u0442\u04E9\u0440\u04E9\u043B\">\r\n            <button class=\"tab-btn is-active\" type=\"button\" data-role=\"customer\" role=\"tab\" aria-selected=\"true\" aria-label=\"\u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u044D\u044D\u0440\">\r\n              \u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u044D\u044D\u0440\r\n            </button>\r\n            <button class=\"tab-btn\" type=\"button\" data-role=\"courier\" role=\"tab\" aria-selected=\"false\" aria-label=\"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440\">\r\n              \u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"auth-layout\">\r\n          <form>\r\n          <input class=\"register-only\" type=\"hidden\" name=\"role\" value=\"customer\">\r\n          <div class=\"form-group register-only\">\r\n            <label for=\"name\">\u041D\u044D\u0440</label>\r\n            <input id=\"name\" name=\"name\" type=\"text\" placeholder=\"\u041D\u044D\u0440\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"phone\">\u0423\u0442\u0430\u0441\u043D\u044B \u0434\u0443\u0433\u0430\u0430\u0440</label>\r\n            <input id=\"phone\" name=\"phone\" type=\"tel\" placeholder=\"\u0423\u0442\u0430\u0441\u043D\u044B \u0434\u0443\u0433\u0430\u0430\u0440\" required>\r\n          </div>\r\n          <div class=\"form-group register-only\">\r\n            <label for=\"studentId\">ID</label>\r\n            <input id=\"studentId\" name=\"studentId\" type=\"text\" placeholder=\"ID\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"password\">\u041D\u0443\u0443\u0446 \u04AF\u0433</label>\r\n            <input id=\"password\" name=\"password\" type=\"password\" placeholder=\"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\" required>\r\n          </div>\r\n\r\n          <button class=\"continue-btn\" type=\"submit\">\u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445</button>\r\n\r\n          <div class=\"privacy\">\u041D\u0443\u0443\u0446\u043B\u0430\u043B\u044B\u043D \u0431\u043E\u0434\u043B\u043E\u0433\u043E</div>\r\n\r\n          <div class=\"or\">\u044D\u0441\u0432\u044D\u043B</div>\r\n\r\n          <div class=\"social\">\r\n            <button type=\"button\" class=\"btn-social\">\r\n              <img src=\"assets/img/num-logo.svg\" alt=\"num-logo\">\r\n              SISI-\u044D\u044D\u0440 \u04AF\u0440\u0433\u044D\u043B\u0436\u043B\u04AF\u04AF\u043B\u044D\u0445\r\n            </button>\r\n          </div>\r\n          </form>\r\n\r\n          <div class=\"payment-section\" hidden>\r\n            <h4 class=\"section-title\">\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0439\u043D \u0442\u04E9\u043B\u0431\u04E9\u0440</h4>\r\n            <p class=\"section-note\">\u0422\u04E9\u043B\u0431\u04E9\u0440\u04E9\u04E9 \u0441\u043E\u043D\u0433\u043E\u043E\u0434 \u0434\u0430\u0440\u0430\u0430 \u043D\u044C \u0442\u04E9\u043B\u043D\u04E9 \u04AF\u04AF.</p>\r\n            <div class=\"plan-grid\">\r\n              <label class=\"plan-card\">\r\n                <input type=\"radio\" name=\"paymentPlan\" value=\"monthly\" checked>\r\n                <span>\u0421\u0430\u0440\u0434 3000\u20AE</span>\r\n              </label>\r\n              <label class=\"plan-card\">\r\n                <input type=\"radio\" name=\"paymentPlan\" value=\"two-months\">\r\n                <span>2 \u0441\u0430\u0440\u0434 5000\u20AE</span>\r\n              </label>\r\n              <label class=\"plan-card\">\r\n                <input type=\"radio\" name=\"paymentPlan\" value=\"two-weeks\">\r\n                <span>14 \u0445\u043E\u043D\u043E\u0433\u0442 2000\u20AE</span>\r\n              </label>\r\n            </div>\r\n            <div class=\"method-grid\">\r\n              <label class=\"method-card\">\r\n                <input type=\"radio\" name=\"paymentMethod\" value=\"card\" checked>\r\n                <span>\u041A\u0430\u0440\u0442\u0430\u0430\u0440 \u0442\u04E9\u043B\u04E9\u0445</span>\r\n              </label>\r\n              <label class=\"method-card\">\r\n                <input type=\"radio\" name=\"paymentMethod\" value=\"qpay\">\r\n                <span>QPay-\u0440 \u0442\u04E9\u043B\u04E9\u0445</span>\r\n              </label>\r\n            </div>\r\n            <div class=\"payment-details payment-details--card\">\r\n              <div class=\"form-group\">\r\n                <label for=\"cardNumber\">\u041A\u0430\u0440\u0442\u044B\u043D \u0434\u0443\u0433\u0430\u0430\u0440</label>\r\n                <input id=\"cardNumber\" type=\"text\" inputmode=\"numeric\" placeholder=\"0000 0000 0000 0000\">\r\n              </div>\r\n              <div class=\"form-row\">\r\n                <div class=\"form-group\">\r\n                  <label for=\"cardExp\">\u0414\u0443\u0443\u0441\u0430\u0445 \u0445\u0443\u0433\u0430\u0446\u0430\u0430</label>\r\n                  <input id=\"cardExp\" type=\"text\" placeholder=\"MM/YY\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label for=\"cardCvv\">CVV</label>\r\n                  <input id=\"cardCvv\" type=\"password\" inputmode=\"numeric\" placeholder=\"***\">\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"payment-details payment-details--qpay\" hidden>\r\n              <div class=\"qpay-box\">\r\n                <div class=\"qpay-qr\">QR</div>\r\n                <div>\r\n                  <strong>QPay \u0442\u04E9\u043B\u0431\u04E9\u0440</strong>\r\n                  <p>QR \u043A\u043E\u0434 \u0443\u043D\u0448\u0443\u0443\u043B\u0436 \u0442\u04E9\u043B\u043D\u04E9 \u04AF\u04AF.</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"payment-actions\">\r\n              <button class=\"pay-btn\" type=\"button\">\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0445</button>\r\n              <p class=\"pay-status\" hidden>\u0422\u04E9\u043B\u0431\u04E9\u0440 \u0442\u04E9\u043B\u04E9\u0433\u0434\u0441\u04E9\u043D.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n  <div class=\"scene\">\r\n    <div class=\"delivery-man\">\r\n      <div class=\"head\"></div>\r\n      <div class=\"body\"></div>\r\n\r\n      <div class=\"arm left\"></div>\r\n      <div class=\"arm right\"></div>\r\n\r\n      <div class=\"leg left\"></div>\r\n      <div class=\"leg right\"></div>\r\n\r\n      <div class=\"box\">\uD83D\uDCE6</div>\r\n    </div>\r\n  </div>\r\n    `;\r\n\r\n    const form = this.querySelector(\"form\");\r\n    const closeBtn = this.querySelector(\".close\");\r\n    const roleInput = this.querySelector(\"input[name='role']\");\r\n    const modeTabs = this.querySelectorAll(\".auth-tabs .tab-btn\");\r\n    const roleTabs = this.querySelectorAll(\".login-tabs .tab-btn\");\r\n    const loginTabs = this.querySelector(\".login-tabs\");\r\n    const titleEl = this.querySelector(\"#login-title\");\r\n    const submitBtn = this.querySelector(\".continue-btn\");\r\n    const subtitleEl = this.querySelector(\".subtitle\");\r\n    const nameInput = this.querySelector(\"#name\");\r\n    const phoneInput = this.querySelector(\"#phone\");\r\n    const studentInput = this.querySelector(\"#studentId\");\r\n    const registerOnlyBlocks = this.querySelectorAll(\".register-only\");\r\n    const paymentSection = this.querySelector(\".payment-section\");\r\n    const paymentMethods = this.querySelectorAll('input[name=\"paymentMethod\"]');\r\n    const payBtn = this.querySelector(\".pay-btn\");\r\n    const payStatus = this.querySelector(\".pay-status\");\r\n    const isPaid = () =>\r\n      localStorage.getItem(\"courierPaid\") === \"1\";\r\n\r\n\r\n    if (closeBtn) {\r\n      closeBtn.addEventListener(\"click\", () => {\r\n        location.hash = \"#home\";\r\n      });\r\n    }\r\n\r\n    modeTabs.forEach((btn) => {\r\n      btn.addEventListener(\"click\", () => {\r\n        const mode = btn.getAttribute(\"data-mode\") || \"login\";\r\n        this.currentMode = mode;\r\n        modeTabs.forEach((b) => {\r\n          const isActive = b === btn;\r\n          b.classList.toggle(\"is-active\", isActive);\r\n          b.setAttribute(\"aria-selected\", isActive ? \"true\" : \"false\");\r\n        });\r\n\r\n        const isRegister = mode === \"register\";\r\n        registerOnlyBlocks.forEach((el) => {\r\n          el.style.display = isRegister ? \"\" : \"none\";\r\n        });\r\n        if (isRegister && roleInput) {\r\n          roleInput.value = this.currentRole;\r\n        }\r\n        this.classList.remove(\"show-payment\");\r\n        if (paymentSection) paymentSection.hidden = true;\r\n        if (payStatus) payStatus.hidden = true;\r\n        if (payBtn) payBtn.disabled = false;\r\n        if (nameInput) nameInput.required = isRegister;\r\n        if (studentInput) studentInput.required = false;\r\n        if (phoneInput) phoneInput.required = true;\r\n\r\n        if (titleEl) titleEl.textContent = isRegister ? \"\u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\" : \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445\";\r\n        if (submitBtn) {\r\n          submitBtn.textContent = isRegister\r\n            ? this.currentRole === \"courier\"\r\n              ? \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\"\r\n              : \"\u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\"\r\n            : \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445\";\r\n        }\r\n        if (subtitleEl) {\r\n          subtitleEl.textContent = isRegister\r\n            ? \"\u041D\u044D\u0440 \u0431\u043E\u043B\u043E\u043D \u043D\u0443\u0443\u0446 \u04AF\u0433\u044D\u044D \u0430\u0448\u0438\u0433\u043B\u0430\u043D \u043D\u044D\u0432\u0442\u044D\u0440\u043D\u044D.\"\r\n            : \"\u0423\u0442\u0430\u0441\u043D\u044B \u0434\u0443\u0433\u0430\u0430\u0440, \u043D\u0443\u0443\u0446 \u04AF\u0433\u044D\u044D \u043E\u0440\u0443\u0443\u043B\u043D\u0430 \u0443\u0443.\";\r\n        }\r\n      });\r\n    });\r\n\r\n    roleTabs.forEach((btn) => {\r\n      btn.addEventListener(\"click\", () => {\r\n        const role = btn.getAttribute(\"data-role\") || \"customer\";\r\n        this.currentRole = role;\r\n        if (loginTabs) loginTabs.dataset.activeRole = role;\r\n        roleTabs.forEach((b) => {\r\n          const isActive = b === btn;\r\n          b.classList.toggle(\"is-active\", isActive);\r\n          b.setAttribute(\"aria-selected\", isActive ? \"true\" : \"false\");\r\n        });\r\n        if (roleInput) roleInput.value = role;\r\n        if (titleEl) titleEl.textContent = \"\u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\";\r\n        if (submitBtn) {\r\n          submitBtn.textContent = role === \"courier\" ? \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\" : \"\u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\";\r\n        }\r\n        this.classList.remove(\"show-payment\");\r\n        if (paymentSection) paymentSection.hidden = true;\r\n        if (payStatus) payStatus.hidden = true;\r\n        if (payBtn) payBtn.disabled = false;\r\n      });\r\n    });\r\n\r\n    const prefillMode = localStorage.getItem(\"login_prefill_mode\");\r\n    const prefillRole = localStorage.getItem(\"login_prefill_role\");\r\n    if (prefillMode) {\r\n      this.currentMode = prefillMode === \"register\" ? \"register\" : \"login\";\r\n      localStorage.removeItem(\"login_prefill_mode\");\r\n    }\r\n    if (prefillRole) {\r\n      this.currentRole = prefillRole === \"courier\" ? \"courier\" : \"customer\";\r\n      localStorage.removeItem(\"login_prefill_role\");\r\n    }\r\n\r\n    if (registerOnlyBlocks.length) {\r\n      registerOnlyBlocks.forEach((el) => {\r\n        el.style.display = this.currentMode === \"register\" ? \"\" : \"none\";\r\n      });\r\n    }\r\n    if (loginTabs) loginTabs.dataset.activeRole = this.currentRole;\r\n    if (roleInput) roleInput.value = this.currentRole;\r\n    if (titleEl) titleEl.textContent = this.currentMode === \"register\" ? \"\u0411\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\" : \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445\";\r\n    if (submitBtn) {\r\n      submitBtn.textContent =\r\n        this.currentMode === \"register\"\r\n          ? this.currentRole === \"courier\"\r\n            ? \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\"\r\n            : \"\u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u044D\u044D\u0440 \u0431\u04AF\u0440\u0442\u0433\u04AF\u04AF\u043B\u044D\u0445\"\r\n          : \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445\";\r\n    }\r\n    if (subtitleEl) {\r\n      subtitleEl.textContent =\r\n        this.currentMode === \"register\"\r\n          ? \"\u041D\u044D\u0440 \u0431\u043E\u043B\u043E\u043D \u043D\u0443\u0443\u0446 \u04AF\u0433\u044D\u044D \u0430\u0448\u0438\u0433\u043B\u0430\u043D \u043D\u044D\u0432\u0442\u044D\u0440\u043D\u044D.\"\r\n          : \"\u0423\u0442\u0430\u0441\u043D\u044B \u0434\u0443\u0433\u0430\u0430\u0440, \u043D\u0443\u0443\u0446 \u04AF\u0433\u044D\u044D \u043E\u0440\u0443\u0443\u043B\u043D\u0430 \u0443\u0443.\";\r\n    }\r\n    if (nameInput) nameInput.required = this.currentMode === \"register\";\r\n\r\n    if (payBtn) {\r\n      payBtn.addEventListener(\"click\", () => {\r\n        localStorage.setItem(\"courierPaid\", \"1\"); payBtn.disabled = true;\r\n        if (payStatus) payStatus.hidden = false;\r\n      });\r\n    }\r\n\r\n    if (paymentMethods.length && paymentSection) {\r\n      paymentMethods.forEach((input) => {\r\n        input.addEventListener(\"change\", () => {\r\n          const method = this.querySelector('input[name=\"paymentMethod\"]:checked')?.value || \"card\";\r\n          const card = this.querySelector(\".payment-details--card\");\r\n          const qpay = this.querySelector(\".payment-details--qpay\");\r\n          if (card) card.hidden = method !== \"card\";\r\n          if (qpay) qpay.hidden = method !== \"qpay\";\r\n        });\r\n      });\r\n    }\r\n\r\n    if (form) {\r\n      form.addEventListener(\"submit\", async (e) => {\r\n        e.preventDefault();\r\n        const password = this.querySelector(\"#password\")?.value?.trim() || \"\";\r\n        const isRegister = this.currentMode === \"register\";\r\n        const isCourier = isRegister && (roleInput?.value || \"customer\") === \"courier\";\r\n        const name = this.querySelector(\"#name\")?.value?.trim() || \"\";\r\n        const phone = this.querySelector(\"#phone\")?.value?.trim() || \"\";\r\n        const studentId = this.querySelector(\"#studentId\")?.value?.trim() || \"\";\r\n        const roleValue = roleInput?.value || this.currentRole || \"customer\";\r\n        const role = isRegister && roleValue === \"courier\" ? \"courier\" : \"customer\";\r\n        const fullName = name.trim() || \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\";\r\n\r\n        try {\r\n          const res = await fetch(`${API}/api/auth/login`, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            credentials: \"include\",\r\n            body: JSON.stringify({\r\n              name: fullName,\r\n              phone,\r\n              studentId,\r\n              role,\r\n              password,\r\n              mode: this.currentMode,\r\n            }),\r\n          });\r\n\r\n          if (!res.ok) {\r\n            const err = await res.json().catch(() => ({}));\r\n            throw new Error(err.error || \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445 \u04AF\u0435\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n          }\r\n\r\n          const data = await res.json();\r\n\r\n          // \u2705 auth state (server role/identity \u0430\u0448\u0438\u0433\u043B\u0430\u043D\u0430)\r\n          const serverRole =\r\n            (data?.user?.role || data?.role || roleValue || role || \"customer\") === \"courier\"\r\n              ? \"courier\"\r\n              : \"customer\";\r\n\r\n          const serverPhone = String(data?.user?.phone || phone || \"\").trim();\r\n          const serverStudentId = String(data?.user?.student_id || data?.user?.studentId || studentId || \"\").trim();\r\n          const userKey = (serverStudentId || serverPhone).trim();\r\n\r\n          localStorage.setItem(\"authLoggedIn\", \"1\");\r\n          localStorage.setItem(\"authRole\", serverRole);\r\n          localStorage.setItem(\"authPhone\", serverPhone);\r\n          localStorage.setItem(\"authStudentId\", serverStudentId);\r\n          localStorage.setItem(\"authUserKey\", userKey);\r\n\r\n          // \u2705 courierPaid-\u0433 per-user key-\u044D\u044D\u0441 \u0441\u044D\u0440\u0433\u044D\u044D\u043D\u044D\r\n          if (serverRole === \"courier\" && userKey) {\r\n            const paidKey = `courierPaid:${userKey}`;\r\n            const paid = localStorage.getItem(paidKey) === \"1\" ? \"1\" : \"0\";\r\n            localStorage.setItem(\"courierPaid\", paid);\r\n          } else {\r\n            localStorage.setItem(\"courierPaid\", \"0\");\r\n          }\r\n\r\n\r\n\r\n          // \u2705 courierPaid-\u0433 default 0 \u0431\u043E\u043B\u0433\u043E\u0436 \u0442\u043E\u0433\u0442\u043E\u043E\u043D\u043E (null \u0431\u0438\u0448)\r\n          if (role === \"courier\") {\r\n            if (localStorage.getItem(\"courierPaid\") !== \"1\") {\r\n              localStorage.setItem(\"courierPaid\", \"0\");\r\n            }\r\n          } else {\r\n            localStorage.setItem(\"courierPaid\", \"0\");\r\n          }\r\n\r\n          window.dispatchEvent(new Event(\"user-updated\"));\r\n\r\n\r\n\r\n          // customer\r\n          const hasDraft = localStorage.getItem(\"pendingOrderDraft\");\r\n          location.hash = hasDraft ? \"#home\" : \"#profile\";\r\n          return;\r\n\r\n\r\n        } catch (err) {\r\n          const msg = String(err?.message || \"\");\r\n          if (msg.includes(\"users_phone_key\")) {\r\n            alert(\"\u042D\u043D\u044D \u0443\u0442\u0430\u0441 \u0431\u04AF\u0440\u0442\u0433\u044D\u043B\u0442\u044D\u0439 \u0431\u0430\u0439\u043D\u0430. \u041D\u044D\u0432\u0442\u0440\u044D\u0445 \u0433\u043E\u0440\u0438\u043C\u043E\u043E\u0440 \u043E\u0440\u043D\u043E \u0443\u0443.\");\r\n            const loginTab = this.querySelector('.auth-tabs .tab-btn[data-mode=\"login\"]');\r\n            if (loginTab) loginTab.click();\r\n            return;\r\n          }\r\n          alert(msg || \"\u041D\u044D\u0432\u0442\u0440\u044D\u0445 \u04AF\u0435\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  normalizeName(value) {\r\n    const raw = String(value || \"\").trim();\r\n    if (!raw) return \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\";\r\n    const tokens = raw.split(/\\s+/).filter((t) => t && t.length > 1);\r\n    return tokens.length ? tokens.join(\" \") : raw;\r\n  }\r\n}\r\n\r\ncustomElements.define('login-page', LoginPage);\r\n", "class DateTimePicker extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: \"open\" });\r\n    this._timer = null;\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.render();\r\n    this.updateToNow();     \r\n    this.startAutoUpdate(); \r\n  }\r\n\r\n  disconnectedCallback() {\r\n    clearInterval(this._timer); \r\n  }\r\n\r\n  render() {\r\n    this.shadowRoot.innerHTML = `\r\n      <style>\r\n        @import url(/assets/css/style.css);\r\n\r\n        :host {\r\n          display: flex;\r\n          gap: 0.5rem;\r\n          flex: 1 1 auto;\r\n        }\r\n\r\n        .date-time-picker {\r\n          display: flex;\r\n          gap: 0.5rem;\r\n          width: 100%;\r\n          font-family: var(--font-family);\r\n        }\r\n      \r\n        .wrapper {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          padding: 0 0.75rem;\n          height: 2.75rem;\n          border: 0.0625rem solid var(--color-border);\n          border-radius: var(--radius);\n          transition: all 0.25s ease;\n          background: var(--color-bg);\n          flex: 1 1 0;\n          min-width: 0;\n          font-family: var(--font-family);\n        }\n\n        input {\n          border: none;\n          outline: none;\n          background: transparent;\n          width: 100%;\n          font-size: var(--font-size-base, 0.875rem);\n          font-family: var(--font-family);\n          cursor: pointer;\n          color: var(--color-text);\n        }\n\n        .wrapper:has(input:focus) {\n          border-color: var(--color-accent, #d00);\n          box-shadow: 0 0 0 0.15rem rgba(201, 13, 48, 0.18);\n        }\n\n        input[type=\"date\"],\n        input[type=\"time\"] {\n          accent-color: var(--color-accent, #d00);\n          background-color: transparent;\n        }\n\n        input::-webkit-calendar-picker-indicator {\n          cursor: pointer;\n        }\n\n        @media (prefers-color-scheme: dark) {\n          input[type=\"date\"],\n          input[type=\"time\"] {\n            color-scheme: dark;\n            background-color: var(--color-bg);\n          }\n        }\n\r\n        @media (max-width: 54rem) {\r\n          :host {\r\n            gap: 0.5rem;\r\n          }\r\n          \r\n          .date-time-picker {\r\n            gap: 0.5rem;\r\n          }\r\n          \r\n          .wrapper {\r\n            padding: 0 0.625rem;\r\n            gap: 0.375rem;\r\n          }\r\n        }\r\n      </style>\r\n      \r\n      <div class=\"date-time-picker\">\r\n        <div class=\"wrapper\">\r\n          <input class=\"date\" type=\"date\" aria-label=\"\u041E\u0433\u043D\u043E\u043E \u0441\u043E\u043D\u0433\u043E\u0445\">\r\n        </div>\r\n        <div class=\"wrapper\">\r\n          <input class=\"time\" type=\"time\" aria-label=\"\u0426\u0430\u0433 \u0441\u043E\u043D\u0433\u043E\u0445\">\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  updateToNow() {\r\n    const dateEl = this.shadowRoot.querySelector(\".date\");\r\n    const timeEl = this.shadowRoot.querySelector(\".time\");\r\n\r\n    const now = new Date();\r\n    const yyyy = now.getFullYear();\r\n    const mm = String(now.getMonth() + 1).padStart(2, \"0\");\r\n    const dd = String(now.getDate()).padStart(2, \"0\");\r\n\r\n    const hh = String(now.getHours()).padStart(2, \"0\");\r\n    const mins = String(now.getMinutes()).padStart(2, \"0\");\r\n\r\n    dateEl.value = `${yyyy}-${mm}-${dd}`;\r\n    timeEl.value = `${hh}:${mins}`;\r\n  }\r\n\r\n  startAutoUpdate() {\r\n    this._timer = setInterval(() => {\r\n      this.updateToNow();\r\n    }, 1000 * 30); \r\n  }\r\n\r\n  get value() {\r\n    const d = this.shadowRoot.querySelector(\".date\").value;\r\n    const t = this.shadowRoot.querySelector(\".time\").value;\r\n    return `${d} \u2022 ${t}`;\r\n  }\r\n}\r\n\r\ncustomElements.define(\"date-time-picker\", DateTimePicker);\n", "class ShCart extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this.prices = {\r\n            \"\u041A\u0438\u043C\u0431\u0430\u0431\": 5500,\r\n            \"\u0411\u0443\u0440\u0433\u0435\u0440\": 6500,\r\n            \"\u0411\u0443\u0443\u0437\": 4000,\r\n            \"\u0421\u0430\u043B\u0430\u0434\": 3000,\r\n            \"\u041A\u043E\u043B\u0430 0.5\u043B\": 2500,\r\n            \"\u0425\u0430\u0440 \u0446\u0430\u0439\": 1500,\r\n            \"\u041A\u043E\u0444\u0435\": 3000,\r\n            \"\u0416\u04AF\u04AF\u0441 0.33\u043B\": 2500\r\n        };\r\n\r\n        this.deliveryIcons = {\r\n            single: 'assets/img/document.svg',  \r\n            medium: 'assets/img/tor.svg',       \r\n            large: 'assets/img/box.svg'         \r\n        };\r\n    }\r\n\r\n    connectedCallback() {\r\n        this.render();\r\n        this.initializeElements();\r\n        this.setupEventListeners();\r\n        this.updateTotalsAndCount();\r\n    }\r\n    render() {\r\n       this.innerHTML = `\r\n          <h3>\u0422\u0430\u043D\u044B \u0441\u0430\u0433\u0441</h3>\r\n          <div class=\"cart-icon\">\r\n            <svg><path opacity=\"0.4\" d=\"M8.26012 21.9703C9.1827 21.9703 9.93865 22.7536 9.93883 23.7213C9.93883 24.6776 9.18281 25.4615 8.26012 25.4615C7.32644 25.4613 6.57066 24.6775 6.57066 23.7213C6.57084 22.7537 7.32655 21.9704 8.26012 21.9703ZM20.767 21.9703C21.6894 21.9704 22.4455 22.7536 22.4457 23.7213C22.4457 24.6775 21.6896 25.4614 20.767 25.4615C19.8331 25.4615 19.0765 24.6776 19.0765 23.7213C19.0767 22.7536 19.8333 21.9703 20.767 21.9703Z\" fill=\"#C90D30\"/>\r\n              <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M22.4456 7.31518C23.1237 7.31518 23.5684 7.55713 24.0131 8.08714C24.4577 8.61714 24.5356 9.37757 24.4355 10.0677L23.3794 17.626C23.1793 19.0789 21.9787 20.1493 20.5669 20.1493H8.4385C6.95997 20.1493 5.73713 18.9741 5.61485 17.4543L4.5921 4.89445L2.91348 4.59489C2.46881 4.51423 2.15754 4.06488 2.23535 3.60401C2.31317 3.13162 2.74672 2.82053 3.20251 2.88966L5.85386 3.30445C6.23182 3.37473 6.50974 3.69619 6.54309 4.08793L6.75431 6.66881C6.78766 7.03865 7.0767 7.31518 7.43243 7.31518H22.4456ZM15.7089 13.3053H18.7882C19.2551 13.3053 19.622 12.9136 19.622 12.4412C19.622 11.9573 19.2551 11.5771 18.7882 11.5771H15.7089C15.242 11.5771 14.8751 11.9573 14.8751 12.4412C14.8751 12.9136 15.242 13.3053 15.7089 13.3053Z\" fill=\"#C90D30\"/>\r\n            </svg>\r\n            <span>0</span>\r\n          </div>\r\n\r\n          <div class=\"cart-content\">\r\n            <div></div>\r\n            <div class=\"delivery-box\">\r\n              <p><b>\u0425\u04AF\u0440\u0433\u044D\u043B\u0442:</b></p>\r\n              <img src=\"assets/img/box.svg\" alt=\"delivery\" width=\"57\" height=\"57\" decoding=\"async\">\r\n              <p>1500\u20AE</p>\r\n            </div>\r\n\r\n            <div class=\"total-box\">\r\n              <p><b>\u041D\u0438\u0439\u0442:</b></p>\r\n              <p class=\"total-price\">0\u20AE</p>\r\n            </div>\r\n          </div>\r\n        `;\r\n    }\r\n\r\n    initializeElements() {\r\n        this.totalPriceEl = this.querySelector(\".total-price\");\r\n        this.deliveryPriceEl = this.querySelector(\".delivery-box p:last-child\");\r\n        this.cartItemsContainer = this.querySelector(\".cart-content > div:first-child\");\r\n        this.cartBadge = this.querySelector(\".cart-icon span\");\r\n        this.foodSelect = document.querySelector(\"#what\") || document.querySelector(\".bottom-row select\");\r\n        this.deliveryImgEl = this.querySelector(\".delivery-box img\");\r\n        if (!this.cartItemsContainer) {\r\n            const cc = this.querySelector(\".cart-content\");\r\n            if (cc) {\r\n                const inner = document.createElement(\"div\");\r\n                cc.insertBefore(inner, cc.firstChild);\r\n                this.cartItemsContainer = inner;\r\n            }\r\n        }\r\n    }\r\n\r\n    setupEventListeners() {\r\n        if (this.foodSelect) {\r\n            this.foodSelect.addEventListener(\"change\", (e) => {\r\n                    const opt = e.target.selectedOptions?.[0];\r\n                    if (!opt) return;\r\n\r\n                    const name = (opt.dataset.name || opt.textContent || \"\").split(\" \u2014 \")[0].trim();\r\n                    const price = Number(opt.dataset.price || 0);\r\n                const img = e.target.selectedOptions && e.target.selectedOptions[0].dataset.img ? e.target.selectedOptions[0].dataset.img : '';\r\n                this.addItemToCart(name, price, img);\r\n                e.target.selectedIndex = 0;\r\n            });\r\n        }\r\n\r\n        if (this.cartItemsContainer) {\r\n            this.cartItemsContainer.addEventListener(\"click\", (e) => {\r\n                const delBtn = e.target.closest(\"svg.del-btn\");\r\n                if (!delBtn) return;\r\n                const box = delBtn.closest(\".item-box\");\r\n                if (!box) return;\r\n                const qty = parseInt(box.dataset.qty || (box.querySelector(\"p\")?.textContent.match(/(\\d+)/)||[0,1])[1], 10) || 1;\r\n                const base = parseInt(box.dataset.price || this.parsePrice(box.querySelector(\".price\").textContent) / Math.max(qty,1), 10) || 0;\r\n                if (qty > 1) {\r\n                    const newQty = qty - 1;\r\n                    box.dataset.qty = String(newQty);\r\n                    box.querySelector(\"p\").innerHTML = `<b>${this.escapeHtml(box.querySelector(\"b\").textContent)}</b><br>${newQty} \u0448\u0438\u0440\u0445\u044D\u0433`;\r\n                    box.querySelector(\".price\").textContent = this.formatPrice(base * newQty);\r\n                } else {\r\n                    box.remove();\r\n                }\r\n                this.updateTotalsAndCount();\r\n            });\r\n        }\r\n    }\r\n\r\n    addItemToCart(name, price, img = '') {\n        if (!name) return;\n        const boxes = [...this.cartItemsContainer.querySelectorAll(\".item-box\")];\n        const existing = boxes.find((box) => {\n            const label = box.querySelector(\"b\");\n            return label && label.textContent.trim() === name;\n        });\n\n        if (existing) {\n            const qty = parseInt(existing.dataset.qty || \"1\", 10) || 1;\n            const newQty = qty + 1;\n            const basePrice = parseInt(existing.dataset.price || price, 10) || price;\n\n            existing.dataset.qty = String(newQty);\n            existing.dataset.price = String(basePrice);\n            existing.querySelector(\"p\").innerHTML = `<b>${this.escapeHtml(name)}</b><br>${newQty} \u0448\u0438\u0440\u0445\u044D\u0433`;\n            existing.querySelector(\".price\").textContent = this.formatPrice(basePrice * newQty);\n\n            this.updateTotalsAndCount();\n            return;\n        }\n\n        const box = document.createElement(\"div\");\n        box.className = \"item-box\";\n        box.dataset.qty = \"1\";\n        box.dataset.price = String(price);\n        const imgHtml = img ? `<img class=\"item-img\" src=\"${this.escapeAttr(img)}\" alt=\"${this.escapeAttr(name)}\">` : \"\";\n        box.innerHTML = `\n            ${imgHtml}\n            <p><b>${this.escapeHtml(name)}</b><br>1 \u0448\u0438\u0440\u0445\u044D\u0433</p>\n            <p class=\"price\">${this.formatPrice(price)}</p>\n            <svg class=\"del-btn\" viewBox=\"0 0 20 20\" width=\"18\" height=\"18\" role=\"button\" aria-label=\"remove\">\n                <path d=\"M5.5415 15.75C5.10609 15.75 4.73334 15.6031 4.42327 15.3094C4.11321 15.0156 3.95817 14.6625 3.95817 14.25V4.5H3.1665V3H7.12484V2.25H11.8748V3H15.8332V4.5H15.0415V14.25C15.0415 14.6625 14.8865 15.0156 14.5764 15.3094C14.2663 15.6031 13.8936 15.75 13.4582 15.75H5.5415Z\" fill=\"#C7C4CD\"/>\n            </svg>`;\n        this.cartItemsContainer.appendChild(box);\n\n        this.updateTotalsAndCount();\n    }\n\r\n    updateTotalsAndCount() {\r\n        const boxes = [...(this.cartItemsContainer ? this.cartItemsContainer.querySelectorAll(\".item-box\") : [])];\r\n        let itemsTotal = 0;\r\n        let totalQty = 0;\r\n        const items = [];\r\n\r\n        boxes.forEach(box => {\r\n            const qty = parseInt(box.dataset.qty || (box.querySelector(\"p\")?.textContent.match(/(\\d+)/)||[0,1])[1], 10) || 1;\r\n            const base = parseInt(box.dataset.price || (this.parsePrice(box.querySelector(\".price\").textContent) / Math.max(qty,1)), 10) || 0;\r\n            itemsTotal += base * qty;\r\n            totalQty += qty;\r\n\r\n            const name = box.querySelector(\"b\")?.textContent?.trim() || \"\";\r\n            // Keep unit price to avoid NaN when sending to API\r\n            items.push({ name, qty, price: base, unitPrice: base });\r\n        });\r\n\r\n        let deliveryFee = 0;\r\n        let iconSrc = 'assets/img/box.svg';\r\n        if (totalQty > 10) {\r\n            deliveryFee = 1500;\r\n            iconSrc = this.deliveryIcons.large;\r\n        } else if (totalQty >= 2) {\r\n            deliveryFee = 1000;\r\n            iconSrc = this.deliveryIcons.medium;\r\n        } else if (totalQty === 1) {\r\n            deliveryFee = 500;\r\n            iconSrc = this.deliveryIcons.single;\r\n        } else {\r\n            deliveryFee = 0;\r\n            iconSrc = 'assets/img/box.svg';\r\n        }\r\n\r\n        const deliveryText = itemsTotal > 0 ? this.formatPrice(deliveryFee) : '0\u20AE';\r\n        if (this.deliveryPriceEl) this.deliveryPriceEl.textContent = deliveryText;\r\n\r\n        const totalWithDelivery = itemsTotal > 0 ? itemsTotal + deliveryFee : 0;\r\n        if (this.totalPriceEl) this.totalPriceEl.textContent = this.formatPrice(totalWithDelivery);\r\n\r\n        if (this.cartBadge) this.cartBadge.textContent = String(totalQty);\r\n\r\n        if (this.deliveryImgEl) {\r\n            this.deliveryImgEl.src = itemsTotal > 0 ? iconSrc : 'assets/img/box.svg';\r\n            this.deliveryImgEl.alt = `delivery tier ${totalQty}`;\r\n        }\r\n\r\n        this.style.display = totalQty === 0 ? \"none\" : \"block\";\r\n\r\n        // cache summary for external usage\r\n        this.summary = {\r\n            items,\r\n            itemsTotal,\r\n            deliveryFee,\r\n            total: totalWithDelivery,\r\n            totalQty,\r\n            deliveryIcon: iconSrc\r\n        };\r\n    }\r\n\r\n    parsePrice(str) {\r\n        return parseInt(String(str || '').replace(/[^\\d]/g, ''), 10) || 0;\r\n    }\r\n\r\n    formatPrice(n) {\r\n        return Number(n).toLocaleString('mn-MN') + '\u20AE';\r\n    }\r\n\r\n    getSummary() {\r\n        return this.summary || { items: [], itemsTotal: 0, deliveryFee: 0, total: 0, totalQty: 0 };\r\n    }\r\n\r\n    escapeAttr(s) {\r\n        return String(s || '').replace(/\"/g, '&quot;').replace(/</g, '&lt;');\r\n    }\r\n\r\n    escapeHtml(s) {\r\n        return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\r\n    }\r\n}\r\n\r\nwindow.customElements.define('sh-cart', ShCart);\r\n", "function parseJsonAttr(raw, fallback) {\r\n  if (!raw) return fallback;\r\n  try {\r\n    return JSON.parse(raw);\r\n  } catch {\r\n    return fallback;\r\n  }\r\n}\r\n\r\nclass OfferCard extends HTMLElement {\r\n  static get observedAttributes() {\r\n    return [\"thumb\", \"title\", \"meta\", \"price\", \"sub\", \"customer\", \"order-id\"];\r\n  }\r\n\r\n  connectedCallback() {\r\n    if (this._ready) return;\r\n    this._ready = true;\r\n    this.render();\r\n    this.attach();\r\n  }\r\n\r\n  attributeChangedCallback() {\r\n    if (this._ready) this.render();\r\n  }\r\n\r\n  get data() {\r\n    return {\r\n      thumb: this.getAttribute(\"thumb\") || \"assets/img/box.svg\",\r\n      title: this.getAttribute(\"title\") || \"\",\r\n      meta: this.getAttribute(\"meta\") || \"\",\r\n      price: this.getAttribute(\"price\") || \"\",\r\n      orderId: this.getAttribute(\"order-id\") || \"\",\r\n      sub: parseJsonAttr(this.getAttribute(\"sub\"), []),\r\n      customer: parseJsonAttr(this.getAttribute(\"customer\"), {}),\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const { thumb, title, meta, price } = this.data;\r\n    this.innerHTML = `\r\n      <article class=\"offer-card\" role=\"button\" tabindex=\"0\">\r\n        <div class=\"offer-thumb\">\r\n          <img src=\"${thumb}\" alt=\"icon\" width=\"57\" height=\"57\" decoding=\"async\"/>\r\n        </div>\r\n        <div class=\"offer-info\">\r\n          <div class=\"offer-title\">${title}</div>\r\n          <div class=\"offer-meta\">${meta}</div>\r\n        </div>\r\n        <div class=\"offer-price\">${price}</div>\r\n      </article>\r\n    `;\r\n  }\r\n\r\n  attach() {\r\n    this.addEventListener(\"click\", () => {\r\n      const detail = this.data;\r\n      this.dispatchEvent(new CustomEvent(\"offer-select\", { bubbles: true, detail }));\r\n    });\r\n\r\n    this.addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Enter\" || e.key === \" \") {\r\n        e.preventDefault();\r\n        this.click();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nif (!customElements.get(\"offer-card\")) {\r\n  customElements.define(\"offer-card\", OfferCard);\r\n}\r\n\r\nexport { OfferCard };\r\n", "import { apiFetch } from \"../api_client.js\";\r\nimport \"./offer-card.js\";\r\n\r\nclass OffersList extends HTMLElement {\r\n  connectedCallback() {\r\n    if (this._ready) return;\r\n    this._ready = true;\r\n    this.render();\r\n\r\n    this.handleOffersUpdated = () => loadOffers();\r\n    window.addEventListener(\"offers-updated\", this.handleOffersUpdated);\r\n    this.addEventListener(\"offer-select\", this.handleOfferSelect);\r\n\r\n    loadOffers();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.handleOffersUpdated) {\r\n      window.removeEventListener(\"offers-updated\", this.handleOffersUpdated);\r\n    }\r\n    this.removeEventListener(\"offer-select\", this.handleOfferSelect);\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n      <section class=\"offers-container\">\r\n        <div class=\"offers-row\"></div>\r\n      </section>\r\n    `;\r\n  }\r\n\r\n  set items(list) {\r\n    this.renderItems(list);\r\n  }\r\n\r\n  renderItems(list) {\r\n    const row = this.querySelector(\".offers-row\");\r\n    if (!row) return;\r\n    const items = Array.isArray(list) ? list : [];\r\n    row.innerHTML = items.map(renderOfferCard).join(\"\");\r\n  }\r\n\r\n  handleOfferSelect(event) {\r\n    const modal = document.querySelector(\"offer-modal\");\r\n    if (!modal || typeof modal.show !== \"function\") return;\r\n    modal.show(event.detail);\r\n  }\r\n}\r\n\r\nif (!customElements.get(\"offers-list\")) {\r\n  customElements.define(\"offers-list\", OffersList);\r\n}\r\n\r\nconst DELIVERY_ICONS = {\r\n  single: \"assets/img/document.svg\",\r\n  medium: \"assets/img/tor.svg\",\r\n  large: \"assets/img/box.svg\",\r\n};\r\n\r\nconst SEED_OFFERS = [\r\n  {\r\n    thumb: \"assets/img/box.svg\",\r\n    title: \"GL burger - 7-\u0440 \u0431\u0430\u0439\u0440 207\",\r\n    meta: \"11/21/25 \u2022 14:00\",\r\n    price: \"10,000\u20AE\",\r\n    sub: [\r\n      { name: \"\u0411\u0443\u0443\u0437\", price: \"5000\u20AE\" },\r\n      { name: \"\u0421\u04AF\u04AF\", price: \"2000\u20AE\" },\r\n    ],\r\n  },\r\n  {\r\n    thumb: \"assets/img/document.svg\",\r\n    title: \"GL burger - 7-\u0440 \u0431\u0430\u0439\u0440 207\",\r\n    meta: \"11/21/25 \u2022 14:00\",\r\n    price: \"10,000\u20AE\",\r\n    sub: [\r\n      { name: \"\u0411\u0443\u0443\u0437\", price: \"5000\u20AE\" },\r\n      { name: \"\u0421\u04AF\u04AF\", price: \"2000\u20AE\" },\r\n    ],\r\n  },\r\n  {\r\n    thumb: \"assets/img/tor.svg\",\r\n    title: \"GL burger - 7-\u0440 \u0431\u0430\u0439\u0440 207\",\r\n    meta: \"11/21/25 \u2022 14:00\",\r\n    price: \"10,000\u20AE\",\r\n    sub: [\r\n      { name: \"\u0411\u0443\u0443\u0437\", price: \"5000\u20AE\" },\r\n      { name: \"\u0421\u04AF\u04AF\", price: \"2000\u20AE\" },\r\n    ],\r\n  },\r\n  {\r\n    thumb: \"assets/img/tor.svg\",\r\n    title: \"GL burger - 7-\u0440 \u0431\u0430\u0439\u0440 207\",\r\n    meta: \"12/31/25 \u2022 22:20\",\r\n    price: \"10,000\u20AE\",\r\n    sub: [\r\n      { name: \"\u0411\u0443\u0443\u0437\", price: \"5000\u20AE\" },\r\n      { name: \"\u0421\u04AF\u04AF\", price: \"2000\u20AE\" },\r\n    ],\r\n  },\r\n];\r\n\r\nfunction renderOfferCard(item) {\r\n  const thumb = item.thumb || \"assets/img/box.svg\";\r\n  const title = item.title || \"\";\r\n  const meta = item.meta || \"\";\r\n  const price = item.price || \"\";\r\n  const orderId = item.orderId || item.id || \"\";\r\n  const sub = encodeURIComponent(JSON.stringify(item.sub || []));\r\n  const customer = encodeURIComponent(JSON.stringify(item.customer || {}));\r\n\r\n  return `\r\n    <offer-card\r\n      thumb=\"${thumb}\"\r\n      title=\"${title}\"\r\n      meta=\"${meta}\"\r\n      sub=\"${sub}\"\r\n      price=\"${price}\"\r\n      order-id=\"${orderId}\"\r\n      customer=\"${customer}\">\r\n    </offer-card>\r\n  `;\r\n}\r\n\r\nfunction formatMetaFromDate(ts) {\r\n  const d = new Date(ts);\r\n  if (Number.isNaN(d.getTime())) return \"\";\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  const yy = String(d.getFullYear()).slice(-2);\r\n  const hh = String(d.getHours()).padStart(2, \"0\");\r\n  const min = String(d.getMinutes()).padStart(2, \"0\");\r\n  return `${mm}/${dd}/${yy}  \u2022${hh}:${min}`;\r\n}\r\n\r\nfunction parseMetaDate(metaString) {\r\n  try {\r\n    const parts = String(metaString || \"\").split(\"\u2022\");\r\n    if (parts.length < 2) return null;\r\n\r\n    const [datePart, timePart] = parts.map((p) => p.trim());\r\n    const [month, day, year] = datePart.split(\"/\");\r\n    const [hours, minutes] = timePart.split(\":\");\r\n    const fullYear = 2000 + Number.parseInt(year, 10);\r\n\r\n    return new Date(fullYear, Number(month) - 1, Number(day), Number(hours), Number(minutes));\r\n  } catch (e) {\r\n    console.error(\"Error parsing date from meta:\", e, metaString);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction parseOrderTimestamp(order) {\r\n  const raw =\r\n    order?.scheduled_at ||\r\n    order?.scheduledAt ||\r\n    order?.created_at ||\r\n    order?.createdAt ||\r\n    order?.meta ||\r\n    null;\r\n\r\n  if (!raw) return null;\r\n\r\n  const parsed = Date.parse(raw);\r\n  if (!Number.isNaN(parsed)) return parsed;\r\n\r\n  if (typeof raw === \"string\") {\r\n    const metaDate = parseMetaDate(raw);\r\n    if (metaDate) return metaDate.getTime();\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction isOrderExpired(order) {\r\n  const ts = parseOrderTimestamp(order);\r\n  if (!ts) return true;\r\n  return ts < Date.now();\r\n}\r\n\r\nfunction formatPrice(amount) {\r\n  return Number(amount || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n}\r\n\r\nfunction getDeliveryIcon(totalQty) {\r\n  if (totalQty > 10) return DELIVERY_ICONS.large;\r\n  if (totalQty >= 2) return DELIVERY_ICONS.medium;\r\n  if (totalQty === 1) return DELIVERY_ICONS.single;\r\n  return DELIVERY_ICONS.large;\r\n}\r\n\r\nfunction buildOrderTitle(order) {\r\n  const from = order?.from_name || \"\";\r\n  const to = order?.to_name || \"\";\r\n  return [from, to].filter(Boolean).join(\" - \");\r\n}\r\n\r\nfunction mapOrdersToOffers(orders) {\r\n  const list = orders;\r\n  // console.log(list, \"ll\")\r\n\r\n  return list\r\n    .filter((order) => {\r\n     const status = order?.status;\r\n    //  console.log(status, \"ss\")\r\n      if (status === \"delivered\" || status === \"cancelled\" || status === \"canceled\") return false;\r\n      if (order?.courier) return false;\r\n      return !isOrderExpired(order);\r\n    })\r\n    .map((order) => {\r\n      const items = order?.items;\r\n      const totalQty = items.reduce((sum, it) => sum + (Number(it?.qty) || 0), 0);\r\n      const sub = items.map((it) => ({\r\n        name: `${it?.name || \"\"} x${it?.qty || 1}`.trim(),\r\n        price: \"\",\r\n      }));\r\n      const ts = parseOrderTimestamp(order);\r\n\r\n      return {\r\n        orderId: order?.id || \"\",\r\n        title: buildOrderTitle(order),\r\n        meta: ts ? formatMetaFromDate(ts) : \"\",\r\n        price: formatPrice(order?.total_amount || 0),\r\n        thumb: getDeliveryIcon(totalQty),\r\n        customer: order?.customer || {},\r\n        sub,\r\n      };\r\n    });\r\n}\r\n\r\nasync function fetchOffersFromApi() {\r\n  const res = await apiFetch(\"/api/orders\");\r\n  const data = await res.json().catch(() => []);\r\n  if (!res.ok) {\r\n    throw new Error(data?.error || \"Failed to load orders\");\r\n  }\r\n  if (!Array.isArray(data)) return [];\r\n  return mapOrdersToOffers(data);\r\n}\r\n\r\nfunction readLocalOffers() {\r\n  const raw = localStorage.getItem(\"offers\");\r\n  if (!raw) return [];\r\n  try {\r\n    return JSON.parse(raw) || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction getRemovedStorageKey(baseKey) {\r\n  const authKey = localStorage.getItem(\"authUserKey\");\r\n  return authKey ? `${baseKey}:${authKey}` : baseKey;\r\n}\r\n\r\nfunction readRemovedOfferIds() {\r\n  const raw = localStorage.getItem(getRemovedStorageKey(\"removed_offer_ids\"));\r\n  if (!raw) return [];\r\n  try {\r\n    return JSON.parse(raw) || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction readRemovedOfferKeys() {\r\n  const raw = localStorage.getItem(getRemovedStorageKey(\"removed_offer_keys\"));\r\n  if (!raw) return [];\r\n  try {\r\n    return JSON.parse(raw) || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction filterRemovedOffers(offers) {\r\n  const removedIds = readRemovedOfferIds();\r\n  const removedKeys = readRemovedOfferKeys();\r\n  if (!removedIds.length && !removedKeys.length) return offers;\r\n  return offers.filter((offer) => {\r\n    const offerId = offer?.orderId || offer?.id || null;\r\n    if (offerId && removedIds.includes(String(offerId))) return false;\r\n    const key = `${offer?.title || \"\"}|${offer?.meta || \"\"}|${offer?.price || \"\"}`;\r\n    return !removedKeys.includes(key);\r\n  });\r\n}\r\n\r\nfunction filterExpiredOffers(offers) {\r\n  return offers.filter((offer) => {\r\n    if (!offer?.meta) return true;\r\n    const parsed = parseMetaDate(offer.meta);\r\n    if (!parsed) return true;\r\n    return parsed.getTime() >= Date.now();\r\n  });\r\n}\r\n\r\nasync function loadOffers() {\r\n  let offers = [];\r\n  try {\r\n    offers = await fetchOffersFromApi();\r\n  } catch {\r\n    offers = readLocalOffers();\r\n  }\r\n\r\n  if (!offers.length) offers = SEED_OFFERS;\r\n\r\n  offers = filterExpiredOffers(offers);\r\n  offers = filterRemovedOffers(offers);\r\n  localStorage.setItem(\"offers\", JSON.stringify(offers));\r\n\r\n  document.querySelectorAll(\"offers-list\").forEach((list) => {\r\n    list.items = offers;\r\n  });\r\n}\r\n\r\nexport { OffersList };\r\n", "class DeliveryCart extends HTMLElement {\r\n  connectedCallback() {\r\n    this.handleUpdate = this.handleUpdate.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.handleViewportChange = this.handleViewportChange.bind(this);\r\n    this.render();\r\n    this.cacheEls();\r\n    this.addEventListener(\"click\", this.handleClick);\r\n    window.addEventListener(\"delivery-cart-updated\", this.handleUpdate);\r\n    this.mediaQuery = window.matchMedia(\"(max-width: 900px)\");\r\n    this.mediaQuery.addEventListener(\"change\", this.handleViewportChange);\r\n    this.handleViewportChange();\r\n    this.load();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener(\"delivery-cart-updated\", this.handleUpdate);\r\n    this.removeEventListener(\"click\", this.handleClick);\r\n    if (this.mediaQuery) {\r\n      this.mediaQuery.removeEventListener(\"change\", this.handleViewportChange);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n      <div class=\"delivery-cart\">\r\n        <div class=\"delivery-cart__header\">\r\n          <h3>\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0441\u0430\u0433\u0441</h3>\r\n          <span class=\"delivery-cart__count\">0</span>\r\n        </div>\r\n        <div class=\"delivery-cart__list\"></div>\r\n        <p class=\"delivery-cart__empty\">\u041E\u0434\u043E\u043E\u0433\u043E\u043E\u0440 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442 \u0441\u043E\u043D\u0433\u043E\u043E\u0433\u04AF\u0439 \u0431\u0430\u0439\u043D\u0430.</p>\r\n        <button class=\"delivery-cart__go\" type=\"button\">\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u0440\u04AF\u04AF</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  cacheEls() {\r\n    this.listEl = this.querySelector(\".delivery-cart__list\");\r\n    this.emptyEl = this.querySelector(\".delivery-cart__empty\");\r\n    this.countEl = this.querySelector(\".delivery-cart__count\");\r\n    this.goBtn = this.querySelector(\".delivery-cart__go\");\r\n  }\r\n\r\n  load() {\r\n    if (this.isHiddenOnMobile) {\r\n      return;\r\n    }\r\n    this.fetchItems();\r\n  }\r\n\r\n  async fetchItems() {\r\n    try {\r\n      const res = await fetch(\"/api/delivery-cart\");\r\n      if (!res.ok) {\r\n        this.items = [];\r\n      } else {\r\n        const data = await res.json();\r\n        this.items = Array.isArray(data?.items) ? data.items : [];\r\n      }\r\n    } catch (e) {\r\n      this.items = [];\r\n    }\r\n    this.renderList();\r\n  }\r\n\r\n  renderList() {\r\n    if (!this.listEl) return;\r\n    if (this.isHiddenOnMobile) {\r\n      this.style.display = \"none\";\r\n      const layout = this.closest(\".offers-layout\");\r\n      if (layout) layout.classList.remove(\"has-cart\");\r\n      return;\r\n    }\r\n    const items = Array.isArray(this.items) ? this.items : [];\r\n    this.listEl.innerHTML = \"\";\r\n    const layout = this.closest(\".offers-layout\");\r\n\r\n    if (!items.length) {\r\n      this.style.display = \"none\";\r\n      if (layout) layout.classList.remove(\"has-cart\");\r\n      if (this.emptyEl) this.emptyEl.style.display = \"block\";\r\n      if (this.countEl) this.countEl.textContent = \"0\";\r\n      if (this.goBtn) this.goBtn.style.display = \"none\";\r\n      return;\r\n    }\r\n\r\n    this.style.display = \"block\";\r\n    if (layout) layout.classList.add(\"has-cart\");\r\n    if (this.emptyEl) this.emptyEl.style.display = \"none\";\r\n    if (this.goBtn) this.goBtn.style.display = \"inline-flex\";\r\n\r\n    let count = 0;\r\n    items.forEach((item) => {\r\n      const qty = Number(item.qty || 1);\r\n      const price = this.parsePrice(item.price);\r\n      count += qty;\r\n\r\n      const sub = Array.isArray(item.sub) ? item.sub : [];\r\n      const subText = sub.length\r\n        ? sub.map((s) => s.name).filter(Boolean).join(\", \")\r\n        : \"\u0411\u0430\u0440\u0430\u0430 \u0430\u043B\u0433\u0430\";\r\n\r\n      const row = document.createElement(\"div\");\r\n      row.className = \"delivery-cart__item\";\r\n      row.dataset.id = item.id || \"\";\r\n      row.innerHTML = `\r\n        <div class=\"delivery-cart__thumb\">\r\n          <img src=\"${this.escapeAttr(item.thumb || \"assets/img/box.svg\")}\" alt=\"\" width=\"57\" height=\"57\" decoding=\"async\">\r\n        </div>\r\n        <div class=\"delivery-cart__info\">\r\n          <div class=\"delivery-cart__title\">${this.escapeHtml(item.title || \"\")}</div>\r\n          <div class=\"delivery-cart__meta\">${this.escapeHtml(item.meta || \"\")}</div>\r\n          <div class=\"delivery-cart__sub\">${this.escapeHtml(subText)}</div>\r\n        </div>\r\n        <div class=\"delivery-cart__price\">\r\n          <span>${this.formatPrice(price * qty)}</span>\r\n          <button class=\"delivery-cart__remove\" type=\"button\" data-action=\"remove\">\u2212</button>\r\n          <span class=\"delivery-cart__qty\">x${qty}</span>\r\n        </div>\r\n      `;\r\n      this.listEl.appendChild(row);\r\n    });\r\n\r\n    if (this.countEl) this.countEl.textContent = String(count);\r\n  }\r\n\r\n  handleClick(e) {\r\n    const goBtn = e.target.closest(\".delivery-cart__go\");\r\n    if (goBtn) {\r\n      location.hash = \"#delivery\";\r\n      return;\r\n    }\r\n    const btn = e.target.closest(\"[data-action='remove']\");\r\n    if (!btn) return;\r\n    const itemEl = btn.closest(\".delivery-cart__item\");\r\n    const id = itemEl?.dataset?.id;\r\n    if (!id) return;\r\n    this.decrementItem(id);\r\n  }\r\n\r\n  handleUpdate() {\r\n    this.load();\r\n  }\r\n\r\n  handleViewportChange() {\r\n    this.isHiddenOnMobile = this.mediaQuery?.matches;\r\n    if (this.isHiddenOnMobile) {\r\n      this.style.display = \"none\";\r\n      const layout = this.closest(\".offers-layout\");\r\n      if (layout) layout.classList.remove(\"has-cart\");\r\n      return;\r\n    }\r\n    this.load();\r\n  }\r\n\r\n  async decrementItem(id) {\r\n    try {\r\n      const res = await fetch(`/api/delivery-cart/${encodeURIComponent(id)}`, {\r\n        method: \"PATCH\",\r\n      });\r\n      if (!res.ok) {\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      return;\r\n    }\r\n    this.load();\r\n    window.dispatchEvent(new Event(\"delivery-cart-updated\"));\r\n  }\r\n\r\n  parsePrice(str) {\r\n    return parseInt(String(str || \"\").replace(/[^\\d]/g, \"\"), 10) || 0;\r\n  }\r\n\r\n  formatPrice(n) {\r\n    return Number(n || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  escapeHtml(s) {\r\n    return String(s || \"\")\r\n      .replace(/&/g, \"&amp;\")\r\n      .replace(/</g, \"&lt;\")\r\n      .replace(/>/g, \"&gt;\");\r\n  }\r\n\r\n  escapeAttr(s) {\r\n    return String(s || \"\").replace(/\"/g, \"&quot;\");\r\n  }\r\n}\r\n\r\ncustomElements.define(\"delivery-cart\", DeliveryCart);\r\n", "class OfferModal extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: 'open' });\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.render();\r\n    this.cacheEls();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render() {\r\n    this.API = \"http://localhost:3000\";\r\n    this.shadowRoot.innerHTML = `\r\n      <style>\r\n        :host {\r\n          --accent: var(--color-accent, #c90d30);\r\n          --radius: 14px;\r\n          --text: #1f2937;\r\n          --muted: #6b7280;\r\n          font-family: \"Roboto\", \"Poppins\", sans-serif;\r\n        }\r\n        .modal {\r\n          position: fixed;\r\n          inset: 0;\r\n          display: none;\r\n          align-items: center;\r\n          justify-content: center;\r\n          background: rgba(0, 0, 0, 0.45);\r\n          backdrop-filter: blur(6px);\r\n          z-index: 10000;\r\n          padding: 1rem;\r\n        }\r\n        .modal.open { display: flex; }\r\n\r\n        .card {\r\n          background: #fff;\r\n          border-radius: var(--radius);\r\n          width: min(540px, 100%);\r\n          box-shadow: 0 22px 60px rgba(0, 0, 0, 0.18);\r\n          padding: 1.35rem 1.5rem;\r\n          position: relative;\r\n          border: 1px solid rgba(0, 0, 0, 0.05);\r\n          display: flex;\r\n          flex-direction: column;\r\n          gap: 1rem;\r\n        }\r\n\r\n        header {\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: space-between;\r\n          gap: 0.75rem;\r\n        }\r\n\r\n        .title-wrap {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 0.75rem;\r\n        }\r\n\r\n        .thumb {\r\n          width: 60px;\r\n          height: 60px;\r\n          border-radius: 14px;\r\n          object-fit: cover;\r\n          background: #f5f6fb;\r\n          box-shadow: inset 0 0 0 1px #eef0f6;\r\n        }\r\n\r\n        h2 {\r\n          margin: 0;\r\n          font-size: 1.2rem;\r\n          color: var(--text);\r\n        }\r\n\r\n        .meta {\r\n          margin: 0.1rem 0 0;\r\n          color: var(--muted);\r\n          font-size: 0.95rem;\r\n        }\r\n\r\n        .close-btn {\r\n          background: transparent;\r\n          border: none;\r\n          font-size: 1.3rem;\r\n          cursor: pointer;\r\n          padding: 0.3rem 0.45rem;\r\n          border-radius: 8px;\r\n          color: var(--muted);\r\n        }\r\n        .close-btn:hover { background: #f3f4f6; }\r\n\r\n        .list {\r\n          list-style: none;\r\n          margin: 0;\r\n          padding: 0;\r\n          display: flex;\r\n          flex-direction: column;\r\n          gap: 0.45rem;\r\n        }\r\n        .list li {\r\n          background: #f8f9fc;\r\n          border-radius: 10px;\r\n          padding: 0.6rem 0.75rem;\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: center;\r\n          color: var(--text);\r\n          border: 1px solid #eef0f6;\r\n        }\r\n        .list span.price {\r\n          font-weight: 700;\r\n        }\r\n\r\n        .price-row {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: center;\r\n          font-weight: 700;\r\n          font-size: 1rem;\r\n          color: var(--text);\r\n        }\r\n        .price-row .pill {\r\n          background: rgba(201, 13, 48, 0.08);\r\n          color: var(--accent);\r\n          padding: 0.3rem 0.75rem;\r\n          border-radius: 999px;\r\n          font-weight: 800;\r\n        }\r\n\r\n        .courier {\r\n          border: 1px solid #eef0f6;\r\n          border-radius: 12px;\r\n          padding: 0.75rem 0.85rem;\r\n          background: #f8f9fc;\r\n          display: grid;\r\n          grid-template-columns: auto 1fr;\r\n          gap: 0.7rem;\r\n          align-items: center;\r\n        }\r\n        .courier img {\r\n          width: 52px;\r\n          height: 52px;\r\n          border-radius: 50%;\r\n          object-fit: cover;\r\n          background: #fff;\r\n          border: 1px solid #e5e7eb;\r\n        }\r\n        .courier h4 {\r\n          margin: 0;\r\n          font-size: 1rem;\r\n          color: var(--text);\r\n        }\r\n        .courier p {\r\n          margin: 0.1rem 0 0;\r\n          color: var(--muted);\r\n          font-size: 0.9rem;\r\n        }\r\n\r\n        .actions {\r\n          display: flex;\r\n          justify-content: flex-end;\r\n          gap: 0.75rem;\r\n        }\r\n\r\n        button {\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n        }\r\n\r\n        .delete {\r\n          background: #fff;\r\n          color: var(--muted);\r\n          border-radius: 10px;\r\n          padding: 0.65rem 1.25rem;\r\n          border: 1px solid #e5e7eb;\r\n        }\r\n        .confirm {\r\n          padding: 0.65rem 1.25rem;\r\n          background: var(--accent);\r\n          color: #fff;\r\n          border: none;\r\n          border-radius: 10px;\r\n          font-size: 0.95rem;\r\n          font-weight: 700;\r\n          box-shadow: 0 10px 30px rgba(201, 13, 48, 0.25);\r\n          transition: transform 0.15s ease;\r\n        }\r\n        .confirm:hover { transform: translateY(-1px); }\r\n\r\n        @media (prefers-color-scheme: dark) {\r\n          :host {\r\n            --text: #e5e7eb;\r\n            --muted: #9aa4b2;\r\n          }\r\n\r\n          .card {\r\n            background: #0f172a;\r\n            border-color: #243040;\r\n            box-shadow: 0 22px 60px rgba(0, 0, 0, 0.45);\r\n          }\r\n\r\n          .thumb {\r\n            background: #111827;\r\n            box-shadow: inset 0 0 0 1px #243040;\r\n          }\r\n\r\n          .close-btn:hover {\r\n            background: #1f2937;\r\n          }\r\n\r\n          .list li {\r\n            background: #111827;\r\n            border-color: #243040;\r\n          }\r\n\r\n          .courier {\r\n            background: #111827;\r\n            border-color: #243040;\r\n          }\r\n\r\n          .courier img {\r\n            background: #0b0f14;\r\n            border-color: #243040;\r\n          }\r\n\r\n          .delete {\r\n            background: #111827;\r\n            color: var(--muted);\r\n            border-color: #243040;\r\n          }\r\n        }\r\n      </style>\r\n      <div class=\"modal\">\r\n        <div class=\"card\">\r\n          <header>\r\n            <div class=\"title-wrap\">\r\n              <img class=\"thumb\" id=\"thumb\" alt=\"\">\r\n              <div>\r\n                <h2 id=\"title\"></h2>\r\n                <p class=\"meta\" id=\"meta\"></p>\r\n              </div>\r\n            </div>\r\n            <button class=\"close-btn\" aria-label=\"\u0425\u0430\u0430\u0445\">\u00D7</button>\r\n          </header>\r\n\r\n          <div>\r\n            <p class=\"meta\" style=\"margin:0 0 0.4rem;\">\u0411\u0430\u0440\u0430\u0430\u043D\u044B \u0436\u0430\u0433\u0441\u0430\u0430\u043B\u0442</p>\r\n            <ul class=\"list\" id=\"sub\"></ul>\r\n          </div>\r\n\r\n          <div class=\"price-row\">\r\n            <span>\u041D\u0438\u0439\u0442 \u04AF\u043D\u044D</span>\r\n            <span class=\"pill\" id=\"price\">0\u20AE</span>\r\n          </div>\r\n\r\n          <div>\r\n            <p class=\"meta\" style=\"margin:0 0 0.4rem;\">\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0433\u0447</p>\r\n            <div class=\"courier\" id=\"customerCard\">\r\n              <img id=\"customerAvatar\" alt=\"\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0433\u0447\u0438\u0439\u043D \u0437\u0443\u0440\u0430\u0433\" />\r\n              <div>\r\n                <h4 id=\"customerName\"></h4>\r\n                <p id=\"customerPhone\"></p>\r\n                <p id=\"customerId\"></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"actions\">\r\n            <button class=\"delete\" type=\"button\">\u0423\u0441\u0442\u0433\u0430\u0445</button>\r\n            <button class=\"confirm\" type=\"button\" data-role=\"courier-action\">\u0425\u04AF\u0440\u0433\u044D\u0445</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  cacheEls() {\r\n    this.modal = this.shadowRoot.querySelector('.modal');\r\n    this.card = this.shadowRoot.querySelector('.card');\r\n    this.titleEl = this.shadowRoot.getElementById('title');\r\n    this.metaEl = this.shadowRoot.getElementById('meta');\r\n    this.thumbEl = this.shadowRoot.getElementById('thumb');\r\n    this.subEl = this.shadowRoot.getElementById('sub');\r\n    this.priceEl = this.shadowRoot.getElementById('price');\r\n    this.customerCard = this.shadowRoot.getElementById('customerCard');\r\n    this.customerAvatar = this.shadowRoot.getElementById('customerAvatar');\r\n    this.customerName = this.shadowRoot.getElementById('customerName');\r\n    this.customerPhone = this.shadowRoot.getElementById('customerPhone');\r\n    this.customerId = this.shadowRoot.getElementById('customerId');\r\n    this.closeBtn = this.shadowRoot.querySelector('.close-btn');\r\n    this.deleteBtn = this.shadowRoot.querySelector('.delete');\r\n    this.confirmBtn = this.shadowRoot.querySelector('.confirm');\r\n  }\r\n\r\n  bindEvents() {\r\n    this.closeBtn.addEventListener('click', () => this.close());\r\n    this.modal.addEventListener('click', (e) => {\r\n      if (e.target === this.modal) this.close();\r\n    });\r\n\r\n    // \u0423\u0441\u0442\u0433\u0430\u0445 \u0442\u043E\u0432\u0447 \u0434\u0430\u0440\u0441\u0430\u043D \u04AF\u0435\u0434 \u0441\u0430\u043D\u0430\u043B \u0443\u0441\u0442\u0433\u0430\u0445\r\n    this.deleteBtn.addEventListener('click', () => {\r\n      this.handleDelete();\r\n    });\r\n\r\n    this.confirmBtn.addEventListener('click', () => this.handleConfirm());\r\n  }\r\n\r\n  // Offers \u0436\u0430\u0433\u0441\u0430\u0430\u043B\u0442\u044B\u0433 \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445 \u0442\u0443\u0441\u043B\u0430\u0445 \u0430\u0440\u0433\u0430\r\n  refreshOffersList() {\r\n    window.dispatchEvent(new Event('offers-updated'));\r\n  }\r\n\r\n\r\n  show(data) {\r\n    if (!this.modal) return;\r\n    this.currentData = data;\r\n    this.thumbEl.src = data.thumb || 'assets/img/box.svg';\r\n    this.thumbEl.alt = data.title || 'offer thumbnail';\r\n    this.titleEl.textContent = data.title || '\u0421\u0430\u043D\u0430\u043B';\r\n    this.metaEl.textContent = data.meta || '';\r\n    const sub = Array.isArray(data.sub) ? data.sub : [];\r\n    this.subEl.innerHTML = sub.map((item) => {\r\n      const name = item?.name || '';\r\n      const price = item?.price || '';\r\n      return `<li><span>${name}</span><span class=\"price\">${price}</span></li>`;\r\n    }).join('') || '<li><span>\u0411\u0430\u0440\u0430\u0430 \u0430\u043B\u0433\u0430</span><span class=\"price\">-</span></li>';\r\n    this.priceEl.textContent = data.price ? String(data.price) : '0\u20AE';\r\n\r\n    const customer = data?.customer || {};\r\n    const customerName = customer?.name || \"\u0422\u043E\u0434\u043E\u0440\u0445\u043E\u0439\u0433\u04AF\u0439\";\r\n    const customerPhone = customer?.phone || \"\u0423\u0442\u0430\u0441\u0433\u04AF\u0439\";\r\n    const customerId = customer?.student_id || customer?.studentId || \"ID \u0431\u0430\u0439\u0445\u0433\u04AF\u0439\";\r\n    if (this.customerCard) {\r\n      this.customerCard.style.display = customerName || customerPhone || customerId ? \"\" : \"none\";\r\n    }\r\n    if (this.customerAvatar) {\r\n      this.customerAvatar.src = customer?.avatar || \"assets/img/profile.jpg\";\r\n      this.customerAvatar.alt = customerName;\r\n    }\r\n    if (this.customerName) this.customerName.textContent = customerName;\r\n    if (this.customerPhone) this.customerPhone.textContent = customerPhone;\r\n    if (this.customerId) this.customerId.textContent = `ID: ${customerId}`;\r\n\r\n    this.modal.classList.add('open');\r\n  }\r\n\r\n  close() {\r\n    if (this.modal) this.modal.classList.remove('open');\r\n  }\r\n\r\n  parseMetaToISO(meta) {\r\n    if (!meta) return null;\r\n    const sanitized = meta.replace('\u2022', '');\r\n    const parsed = Date.parse(sanitized);\r\n    if (!Number.isNaN(parsed)) return new Date(parsed).toISOString();\r\n    return null;\r\n  }\r\n\r\n  buildActiveOrder(data, orderDetail) {\r\n    const [fromRaw = '', toRaw = ''] = (data.title || '').split('-').map((s) => s.trim());\r\n    const firstItem = Array.isArray(data.sub) && data.sub.length ? data.sub[0] : null;\r\n    const customer = orderDetail?.customer || data?.customer || null;\r\n    const customerName = customer?.name || \"\u0427\u0438\u0433\u0446\u0430\u043B\u043C\u0430\u0430\";\r\n    const customerPhone = customer?.phone || \"99001234\";\r\n    const customerId = customer?.studentId || \"23b1num0245\";\r\n    const customerAvatar = customer?.avatar || \"assets/img/profile.jpg\";\r\n    const from = orderDetail?.from_name || fromRaw;\r\n    const to = orderDetail?.to_name || toRaw;\r\n    const createdAt = orderDetail?.created_at || this.parseMetaToISO(data.meta) || new Date().toISOString();\r\n    return {\r\n      orderId: data?.orderId || null,\r\n      from,\r\n      to,\r\n      item: firstItem?.name || '',\r\n      items: Array.isArray(data.sub) ? data.sub : [],\r\n      total: data.price || '',\r\n      createdAt,\r\n      customer: {\r\n        name: this.normalizeName(customerName),\r\n        phone: customerPhone,\r\n        studentId: customerId,\r\n        avatar: customerAvatar,\r\n      },\r\n    };\r\n  }\r\n\r\n  normalizeName(value) {\r\n    const raw = String(value || \"\").trim();\r\n    if (!raw) return \"\u0427\u0438\u0433\u0446\u0430\u043B\u043C\u0430\u0430\";\r\n    const tokens = raw.split(/\\s+/).filter((t) => t && t.length > 1);\r\n    return tokens.length ? tokens.join(\" \") : raw;\r\n  }\r\n\r\n  async handleConfirm() {\r\n    if (!this.currentData) {\r\n      this.close();\r\n      return;\r\n    }\r\n\r\n    await this.fetchCurrentUser();\r\n    const isCourier = this.currentUser?.role === \"courier\";\r\n    if (!isCourier) {\r\n      localStorage.setItem(\"login_prefill_role\", \"courier\");\r\n      localStorage.setItem(\"login_prefill_mode\", \"register\");\r\n      location.hash = \"#login\";\r\n      return;\r\n    }\r\n\r\n    const customer = this.currentData?.customer || {};\r\n    const customerId = customer?.id || customer?.customer_id || null;\r\n    const customerStudentId = customer?.student_id || customer?.studentId || null;\r\n    const selfId = this.currentUser?.id || null;\r\n    const selfStudentId = this.currentUser?.student_id || this.currentUser?.studentId || null;\r\n    if (\r\n      (customerId && selfId && String(customerId) === String(selfId)) ||\r\n      (customerStudentId && selfStudentId && String(customerStudentId) === String(selfStudentId))\r\n    ) {\r\n      alert(\"\u04E8\u04E9\u0440\u0438\u0439\u043D \u0437\u0430\u0445\u0438\u0430\u043B\u0433\u044B\u0433 \u04E9\u04E9\u0440\u04E9\u04E9 \u0445\u04AF\u0440\u0433\u044D\u0445 \u0431\u043E\u043B\u043E\u043C\u0436\u0433\u04AF\u0439.\");\r\n      return;\r\n    }\r\n\r\n    let orderDetail = null;\r\n    const orderId = this.currentData?.orderId;\r\n\r\n    //  \u0425\u04AE\u0420\u0413\u042D\u0425 \u0442\u043E\u0432\u0447 \u0434\u0430\u0440\u0441\u0430\u043D \u04AF\u0435\u0434 offers \u0436\u0430\u0433\u0441\u0430\u0430\u043B\u0442\u0430\u0430\u0441 \u0443\u0441\u0442\u0433\u0430\u0445\r\n    this.removeOfferFromList(this.currentData);\r\n\r\n    if (orderId) {\r\n      try {\r\n        const assignRes = await fetch(`${this.API}/api/orders/${encodeURIComponent(orderId)}/assign-courier`, {\r\n          method: \"POST\",\r\n          credentials: \"include\",\r\n        });\r\n        if (assignRes.ok) {\r\n          const payload = await assignRes.json();\r\n          orderDetail = payload?.order || null;\r\n        }\r\n      } catch (e) {\r\n        // \u0430\u043B\u0434\u0430\u0430\u0433 \u04AF\u043B \u0442\u043E\u043E\u043C\u0441\u043E\u0440\u043B\u043E\u043D\u043E\r\n      }\r\n    }\r\n\r\n    const activeOrder = this.buildActiveOrder(this.currentData, orderDetail);\r\n    const added = await this.addToDeliveryCart(this.currentData);\r\n\r\n    if (!added) {\r\n      // \u0425\u044D\u0440\u044D\u0432 \u0445\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0441\u0430\u0433\u0441\u0430\u043D\u0434 \u043D\u044D\u043C\u044D\u0445\u044D\u0434 \u0431\u04AF\u0442\u044D\u043B\u0433\u04AF\u0439\u0442\u0432\u044D\u043B \u043C\u043E\u0434\u0430\u043B\u044B\u0433 \u0445\u0430\u0430\u043D\u0430\r\n      this.close();\r\n      return;\r\n    }\r\n\r\n    await this.saveActiveOrder(activeOrder);\r\n    // \u2705 appState: \u0445\u04AF\u0440\u0433\u044D\u043B\u0442 \u044D\u0445\u044D\u043B\u0441\u044D\u043D \u0442\u0443\u043B courier \u0431\u043E\u043B\u0433\u043E\u043D\u043E\r\n    window.NumAppState?.setState(\"courier\", \"delivery_started\");\r\n    localStorage.setItem(\"deliveryActive\", \"1\");\r\n\r\n\r\n    // \u0414\u0430\u0445\u0438\u043D \u0443\u0441\u0442\u0433\u0430\u0445 (\u0434\u0430\u0432\u0445\u0430\u0440\u0434\u0441\u0430\u043D \u0447 \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u0433\u044D\u044D\u043D\u0438\u0439 \u04AF\u04AF\u0434\u043D\u044D\u044D\u0441)\r\n    this.removeOfferFromList(this.currentData);\r\n\r\n    try {\r\n      const res = await fetch(`${this.API}/api/courier/me`, {\r\n        credentials: \"include\",\r\n      });\r\n\r\n      if (res.ok) {\r\n        const courier = await res.json();\r\n      }\r\n    } catch (e) {\r\n      console.warn('courier fetch failed', e);\r\n    }\r\n\r\n    this.close();\r\n\r\n    // UI-\u0433 \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445 \u04AF\u0439\u043B \u044F\u0432\u0434\u043B\u0443\u0443\u0434\u044B\u0433 \u0438\u043B\u0433\u044D\u044D\u0445\r\n    window.dispatchEvent(new Event('order-updated'));\r\n    window.dispatchEvent(new Event('delivery-cart-updated'));\r\n    window.dispatchEvent(new Event('offers-updated')); // \u2705 Offers \u0436\u0430\u0433\u0441\u0430\u0430\u043B\u0442\u044B\u0433 \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445 \u0448\u0438\u043D\u044D \u04AF\u0439\u043B \u044F\u0432\u0434\u0430\u043B\r\n\r\n    // \u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u0438\u0439\u043D \u0441\u0430\u0433\u0441\u044B\u0433 \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445\r\n    const cartEl = document.querySelector('delivery-cart');\r\n    if (cartEl && typeof cartEl.load === 'function') {\r\n      cartEl.load();\r\n    }\r\n\r\n    // Offers \u0436\u0430\u0433\u0441\u0430\u0430\u043B\u0442\u044B\u0433 \u0448\u0438\u043D\u044D\u0447\u043B\u044D\u0445\r\n    if (!document.querySelector('delivery-cart')) {\r\n      location.hash = '#delivery';\r\n    }\r\n  }\r\n\r\n  async handleDelete() {\r\n    if (!this.currentData) {\r\n      this.close();\r\n      return;\r\n    }\r\n\r\n    await this.fetchCurrentUser();\r\n    const orderId = this.currentData?.orderId || this.currentData?.id || null;\r\n    const isOwner = this.isOwnerOfOrder(this.currentData);\r\n\r\n    if (isOwner && orderId) {\r\n      const cancelled = await this.cancelOrderOnServer(orderId);\r\n      if (!cancelled) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.removeOfferFromList(this.currentData);\r\n    this.refreshOffersList();\r\n    this.close();\r\n  }\r\n\r\n  isOwnerOfOrder(data) {\r\n    const customer = data?.customer || {};\r\n    const user = this.currentUser || {};\r\n    const customerId = customer?.id || customer?.customer_id || null;\r\n    const customerStudentId = customer?.student_id || customer?.studentId || null;\r\n    const userId = user?.id || null;\r\n    const userStudentId = user?.student_id || user?.studentId || null;\r\n    if (customerId && userId && String(customerId) === String(userId)) return true;\r\n    if (customerStudentId && userStudentId && String(customerStudentId) === String(userStudentId)) return true;\r\n    return false;\r\n  }\r\n\r\n  async cancelOrderOnServer(orderId) {\r\n    try {\r\n      const res = await fetch(`${this.API}/api/orders/${encodeURIComponent(orderId)}`, {\r\n        method: \"DELETE\",\r\n        credentials: \"include\",\r\n      });\r\n      if (res.status === 401) {\r\n        location.hash = \"#login\";\r\n        return false;\r\n      }\r\n      if (!res.ok) {\r\n        const err = await res.json().catch(() => ({}));\r\n        alert(err?.error || \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0443\u0441\u0442\u0433\u0430\u0445\u0430\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (e) {\r\n      alert(\"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0443\u0441\u0442\u0433\u0430\u0445\u0430\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async addToDeliveryCart(data) {\r\n    const title = data.title || '';\r\n    const meta = data.meta || '';\r\n    const price = data.price || '';\r\n    const orderId = data.orderId || data.id || null;\r\n    try {\r\n      const res = await fetch(`${this.API}/api/delivery-cart`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          title,\r\n          meta,\r\n          price,\r\n          thumb: data.thumb || \"assets/img/box.svg\",\r\n          sub: Array.isArray(data.sub) ? data.sub : [],\r\n          orderId,\r\n        }),\r\n      });\r\n      if (!res.ok) {\r\n        const err = await res.json().catch(() => ({}));\r\n        if (String(err.error || \"\").toLowerCase().includes(\"unauthorized\")) {\r\n          location.hash = \"#login\";\r\n          return false;\r\n        }\r\n        alert(err.error || \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u043D\u044D\u043C\u044D\u0445\u044D\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        return false;\r\n      }\r\n      await res.json().catch(() => ({}));\r\n      return true;\r\n    } catch (e) {\r\n      alert(\"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442 \u043D\u044D\u043C\u044D\u0445\u044D\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async saveActiveOrder(order) {\r\n    try {\r\n      await fetch(`${this.API}/api/active-order`, {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ order }),\r\n      });\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  async fetchCurrentUser() {\r\n    if (this.currentUser) return this.currentUser;\r\n    try {\r\n      const res = await fetch(`${this.API}/api/auth/me`, {\r\n        credentials: \"include\",\r\n      });\r\n      if (!res.ok) {\r\n        this.currentUser = null;\r\n      } else {\r\n        const data = await res.json();\r\n        this.currentUser = data?.user || null;\r\n      }\r\n    } catch (e) {\r\n      this.currentUser = null;\r\n    }\r\n    return this.currentUser;\r\n  }\r\n\r\n  getRemovedStorageKey(baseKey) {\r\n    const authKey = localStorage.getItem(\"authUserKey\");\r\n    const userId = this.currentUser?.id || \"\";\r\n    const suffix = authKey || userId || \"\";\r\n    return suffix ? `${baseKey}:${suffix}` : baseKey;\r\n  }\r\n\r\n  removeOfferFromList(data) {\r\n    // Validate input\r\n    if (!data || typeof data !== 'object') return false;\r\n\r\n    // Get offers from localStorage\r\n    const raw = localStorage.getItem('offers');\r\n\r\n    // Parse offers\r\n    let offers = [];\r\n    try {\r\n      offers = raw ? (JSON.parse(raw) || []) : [];\r\n    } catch (e) {\r\n      console.error('Failed to parse offers from localStorage:', e);\r\n      offers = [];\r\n    }\r\n\r\n    const orderId = data.orderId || data.id || null;\r\n    const key = `${data.title || ''}|${data.meta || ''}|${data.price || ''}`;\r\n    const originalLength = offers.length;\r\n\r\n    // Filter out the matching offer\r\n    const next = offers.filter(item => {\r\n      const itemId = item.orderId || item.id || null;\r\n      if (orderId && itemId && String(itemId) === String(orderId)) {\r\n        return false;\r\n      }\r\n      const itemKey = `${item.title || ''}|${item.meta || ''}|${item.price || ''}`;\r\n      return itemKey !== key;\r\n    });\r\n\r\n    // Track removed offers to avoid rehydrating from API\r\n    if (orderId) {\r\n      const removedIdsKey = this.getRemovedStorageKey('removed_offer_ids');\r\n      const removedIdsRaw = localStorage.getItem(removedIdsKey);\r\n      let removedIds = [];\r\n      try {\r\n        removedIds = JSON.parse(removedIdsRaw) || [];\r\n      } catch (e) {\r\n        removedIds = [];\r\n      }\r\n      const normalizedId = String(orderId);\r\n      if (!removedIds.includes(normalizedId)) {\r\n        removedIds.push(normalizedId);\r\n        localStorage.setItem(removedIdsKey, JSON.stringify(removedIds));\r\n      }\r\n    } else if (key) {\r\n      const removedKeysKey = this.getRemovedStorageKey('removed_offer_keys');\r\n      const removedKeysRaw = localStorage.getItem(removedKeysKey);\r\n      let removedKeys = [];\r\n      try {\r\n        removedKeys = JSON.parse(removedKeysRaw) || [];\r\n      } catch (e) {\r\n        removedKeys = [];\r\n      }\r\n      if (!removedKeys.includes(key)) {\r\n        removedKeys.push(key);\r\n        localStorage.setItem(removedKeysKey, JSON.stringify(removedKeys));\r\n      }\r\n    }\r\n\r\n    // Check if anything was actually removed\r\n    if (next.length === originalLength) {\r\n      return false; // No offer was removed\r\n    }\r\n\r\n    // Save to localStorage\r\n    localStorage.setItem('offers', JSON.stringify(next));\r\n\r\n    // Dispatch event for other parts of the app\r\n    window.dispatchEvent(new CustomEvent('offer-removed', {\r\n      detail: {\r\n        removedOffer: data,\r\n        remainingOffers: next\r\n      }\r\n    }));\r\n\r\n    return true;\r\n  }\r\n\r\n  async populateCourier(data) {\r\n    // courier details removed\r\n  }\r\n}\r\n\r\ncustomElements.define('offer-modal', OfferModal);\r\n", "class ConfirmModal extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: \"open\" });\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.render();\r\n    this.cacheEls();\r\n    this.bindEvents();\r\n  }\r\n\r\n  render() {\r\n    this.shadowRoot.innerHTML = `\r\n      <style>\r\n        :host {\r\n          font-family: inherit;\r\n        }\r\n        .sr-only {\r\n          position: absolute;\r\n          width: 1px;\r\n          height: 1px;\r\n          padding: 0;\r\n          margin: -1px;\r\n          overflow: hidden;\r\n          clip: rect(0, 0, 0, 0);\r\n          white-space: nowrap;\r\n          border: 0;\r\n        }\r\n        #confirm-modal {\r\n          position: fixed;\r\n          inset: 0;\r\n          display: none;\r\n          align-items: center;\r\n          justify-content: center;\r\n          background: rgba(0, 0, 0, 0.4);\r\n          backdrop-filter: blur(4px);\r\n          z-index: 10000;\r\n          padding: 1rem;\r\n        }\r\n        #confirm-modal.show { display: flex; }\r\n        #confirm-modal .modal-content {\r\n          background: #fff;\r\n          border-radius: 20px;\r\n          width: min(480px, 100%);\r\n          padding: 1.6rem 1.8rem;\r\n          box-shadow: 0 24px 70px rgba(0,0,0,0.2);\r\n          display: flex;\r\n          flex-direction: column;\r\n          gap: 0.9rem;\r\n          text-align: center;\r\n        }\r\n        #confirm-modal h3 {\r\n          margin: 0;\r\n          font-size: 1.3rem;\r\n          color: #111827;\r\n        }\r\n        #confirm-modal p {\r\n          margin: 0;\r\n          color: #374151;\r\n          line-height: 1.45;\r\n        }\r\n        #confirm-modal .modal-actions {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          gap: 0.75rem;\r\n          margin-top: 0.75rem;\r\n        }\r\n        #confirm-modal .btn {\r\n          border: none;\r\n          background: transparent;\r\n          font: inherit;\r\n          cursor: pointer;\r\n        }\r\n        #confirm-modal .btn--gray {\r\n          background: #f9fafb;\r\n          color: #111827;\r\n          border: 1px solid #e5e7eb;\r\n          border-radius: 12px;\r\n          padding: 0.85rem 1.4rem;\r\n          font-weight: 700;\r\n        }\r\n        #confirm-modal .btn--accent {\r\n          background: var(--color-accent);\r\n          color: #fff;\r\n          border-radius: 12px;\r\n          padding: 0.85rem 1.4rem;\r\n          font-weight: 800;\r\n        }\r\n        #confirm-modal .detail-row {\r\n          text-align: left;\r\n          background: #f9fafb;\r\n          border-radius: 12px;\r\n          padding: 0.85rem 1rem;\r\n          border: 1px solid #eef2f7;\r\n          color: #1f2937;\r\n          line-height: 1.5;\r\n        }\r\n        #confirm-modal .detail-row strong {\r\n          display: inline-block;\r\n          min-width: 4.7rem;\r\n        }\r\n        @media (prefers-color-scheme: dark) {\r\n          #confirm-modal .modal-content {\r\n            background: #0f172a;\r\n            color: #e5e7eb;\r\n            border: 1px solid #243040;\r\n            box-shadow: 0 24px 70px rgba(0,0,0,0.45);\r\n          }\r\n          #confirm-modal h3 {\r\n            color: #f9fafb;\r\n          }\r\n          #confirm-modal p {\r\n            color: #9aa4b2;\r\n          }\r\n          #confirm-modal .btn--gray {\r\n            background: #111827;\r\n            color: #e5e7eb;\r\n            border-color: #243040;\r\n          }\r\n          #confirm-modal .detail-row {\r\n            background: #111827;\r\n            border-color: #243040;\r\n            color: #e5e7eb;\r\n          }\r\n        }\r\n      </style>\r\n\r\n      <div id=\"confirm-modal\" hidden>\r\n        <div class=\"modal-content\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"confirm-title\">\r\n          <h3 id=\"confirm-title\">\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u0430\u0442\u0430\u043B\u0433\u0430\u0430\u0436\u0443\u0443\u043B\u0430\u0445 \u0443\u0443?</h3>\r\n          <p id=\"confirm-text\"></p>\r\n          <div class=\"modal-actions\">\r\n            <button id=\"cancel-order\" class=\"btn btn--gray\">\u0426\u0443\u0446\u043B\u0430\u0445</button>\r\n            <button id=\"confirm-order\" class=\"btn btn--accent\">\u0411\u0430\u0442\u0430\u043B\u0433\u0430\u0430\u0436\u0443\u0443\u043B\u0430\u0445</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  cacheEls() {\r\n    this.modal = this.shadowRoot.querySelector(\"#confirm-modal\");\r\n    this.confirmTextEl = this.shadowRoot.querySelector(\"#confirm-text\");\r\n    this.cancelBtn = this.shadowRoot.querySelector(\"#cancel-order\");\r\n    this.confirmBtn = this.shadowRoot.querySelector(\"#confirm-order\");\r\n  }\r\n\r\n  bindEvents() {\r\n    if (this.cancelBtn) {\r\n      this.cancelBtn.addEventListener(\"click\", () => {\r\n        this.close();\r\n        this.dispatchEvent(new Event(\"cancel\"));\r\n      });\r\n    }\r\n    if (this.confirmBtn) {\r\n      this.confirmBtn.addEventListener(\"click\", () => {\r\n        this.dispatchEvent(new Event(\"confirm\"));\r\n      });\r\n    }\r\n    if (this.modal) {\r\n      this.modal.addEventListener(\"click\", (e) => {\r\n        if (e.target === this.modal) {\r\n          this.close();\r\n          this.dispatchEvent(new Event(\"cancel\"));\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  formatPrice(n) {\r\n    return Number(n || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  open(order, summary) {\r\n    if (!this.modal || !this.confirmTextEl) return;\r\n    this._lastFocus = document.activeElement;\r\n\r\n    const items = summary?.items?.length\r\n      ? summary.items.map((i) => `\u2022 ${i.name} \u2014 ${i.qty} \u0448\u0438\u0440\u0445\u044D\u0433`).join(\"<br>\")\r\n      : \"\u0411\u0430\u0440\u0430\u0430 \u0441\u043E\u043D\u0433\u043E\u0433\u0434\u043E\u043E\u0433\u04AF\u0439\";\r\n\r\n    const d = new Date(order.createdAt);\r\n\r\n    const totalRaw = summary?.total;\r\n    const totalText = Number.isFinite(Number(totalRaw))\r\n      ? this.formatPrice(Number(totalRaw))\r\n      : (totalRaw || \"0\u20AE\");\r\n\r\n    this.confirmTextEl.innerHTML = `\r\n      <div class=\"detail-row\">\r\n        <strong>\u0425\u0430\u0430\u043D\u0430\u0430\u0441:</strong> ${order.from}<br>\r\n        <strong>\u0425\u0430\u0430\u0448\u0430\u0430:</strong> ${order.to}<br>\r\n        <strong>\u04E8\u0434\u04E9\u0440:</strong> ${order.createdAt.split(\"T\")[0]}<br>\r\n        <strong>\u0426\u0430\u0433:</strong> ${d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}\r\n      </div>\r\n      <div class=\"detail-row\">\r\n        <strong>\u0422\u0430\u043D\u044B \u0445\u043E\u043E\u043B:</strong><br>\r\n        ${items}\r\n      </div>\r\n      <div class=\"detail-row\" style=\"text-align:center;\">\r\n        <strong>\u041D\u0438\u0439\u0442 \u04AF\u043D\u044D:</strong> ${totalText}\r\n      </div>\r\n    `;\r\n\r\n    this.modal.removeAttribute(\"hidden\");\r\n    this.modal.classList.add(\"show\");\r\n    if (this.confirmBtn) this.confirmBtn.focus();\r\n  }\r\n\r\n  close() {\r\n    if (!this.modal) return;\r\n    if (this._lastFocus && typeof this._lastFocus.focus === \"function\") {\r\n      this._lastFocus.focus();\r\n    }\r\n    this.modal.classList.remove(\"show\");\r\n    this.modal.setAttribute(\"hidden\", \"\");\r\n  }\r\n}\r\n\r\ncustomElements.define(\"confirm-modal\", ConfirmModal);\r\n", "import { apiFetch } from \"../api_client.js\";\r\n\r\nclass OrderConfirm extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.pendingOrder = null;\r\n    this.pendingOffer = null;\r\n    this.confirmModal = null;\r\n    this.handleConfirm = () => this.batalgaajuulahZahialga();\r\n    this.handleCancel = () => this.hideBatalgaajiltModal();\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.bindModal();\r\n    this.attach();\r\n  }\r\n\r\n  attach() {\r\n    if (!this.confirmModal) return;\r\n    this.confirmModal.addEventListener(\"confirm\", this.handleConfirm);\r\n    this.confirmModal.addEventListener(\"cancel\", this.handleCancel);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    this.detach();\r\n  }\r\n\r\n  detach() {\r\n    if (!this.confirmModal) return;\r\n    this.confirmModal.removeEventListener(\"confirm\", this.handleConfirm);\r\n    this.confirmModal.removeEventListener(\"cancel\", this.handleCancel);\r\n  }\r\n\r\n  bindModal() {\r\n    const root = this.closest(\"home-page\") || document;\r\n    this.confirmModal = root.querySelector(\"confirm-modal\");\r\n  }\r\n\r\n  formatUne(n) {\r\n    return Number(n || 0).toLocaleString(\"mn-MN\") + \"\u20AE\";\r\n  }\r\n\r\n  formatTovch(ts) {\r\n    const d = new Date(ts);\r\n    if (isNaN(d.getTime())) return \"\";\r\n    const date = d.toLocaleDateString(\"en-US\", {\r\n      month: \"2-digit\",\r\n      day: \"2-digit\",\r\n      year: \"2-digit\",\r\n    });\r\n    const time = d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n    return `${date} \u2022 ${time}`;\r\n  }\r\n\r\n  open(order, summary) {\r\n    if (!this.confirmModal) this.bindModal();\r\n    if (!this.confirmModal || typeof this.confirmModal.open !== \"function\") return;\r\n    this.pendingOrder = order || null;\r\n    this.pendingOffer = summary || null;\r\n    this.confirmModal.open(order, summary);\r\n  }\r\n\r\n  hideBatalgaajiltModal() {\r\n    if (!this.confirmModal) return;\r\n    this.confirmModal.close();\r\n    this.pendingOrder = null;\r\n    this.pendingOffer = null;\r\n  }\r\n\r\n  async tentsvvlehHereglegchMedeelel(userId) {\r\n    if (!userId) return;\r\n    const res = await apiFetch(`/api/customers/${userId}`);\r\n    if (!res.ok) return;\r\n    const data = await res.json();\r\n    if (data) {\r\n      if (data.name) localStorage.setItem(\"userName\", data.name);\r\n      if (data.phone) localStorage.setItem(\"userPhone\", data.phone);\r\n      localStorage.setItem(\"userId\", data.id);\r\n      if (data.student_id) {\r\n        localStorage.setItem(\"userDisplayId\", data.student_id);\r\n      }\r\n      window.dispatchEvent(new Event(\"user-updated\"));\r\n    }\r\n  }\r\n\r\n  async batalgaajuulahZahialga() {\r\n    if (!this.pendingOrder || !this.pendingOffer) {\r\n      this.hideBatalgaajiltModal();\r\n      return;\r\n    }\r\n\r\n    const { userId, registered } = this.readNevtrelt();\r\n    if (!registered || !this.shalgahUuid(userId)) {\r\n      localStorage.setItem(\"pendingOrderDraft\", JSON.stringify(this.pendingOrder));\r\n      localStorage.setItem(\"pendingOfferDraft\", JSON.stringify(this.pendingOffer));\r\n      this.hideBatalgaajiltModal();\r\n      location.hash = \"#login\";\r\n      return;\r\n    }\r\n\r\n    if (!this.pendingOrder.fromId || !this.pendingOrder.toId) {\r\n      alert(\"\u0425\u0430\u0430\u043D\u0430\u0430\u0441/\u0425\u0430\u0430\u0448\u0430\u0430 \u0441\u043E\u043D\u0433\u043E\u043D\u043E \u0443\u0443\");\r\n      return;\r\n    }\r\n\r\n    if (!Array.isArray(this.pendingOffer.items) || this.pendingOffer.items.length === 0) {\r\n      alert(\"\u0421\u0430\u0433\u0441 \u0445\u043E\u043E\u0441\u043E\u043D \u0431\u0430\u0439\u043D\u0430\");\r\n      return;\r\n    }\r\n\r\n    const safeItems = this.pendingOffer.items\r\n      .map((i) => {\r\n        const unitPrice = Number(i.price);\r\n        const qty = Number(i.qty);\r\n        return {\r\n          menuItemKey: i.id,\r\n          name: i.name,\r\n          unitPrice: Number.isFinite(unitPrice) ? unitPrice : 0,\r\n          qty: Number.isFinite(qty) && qty > 0 ? qty : 1,\r\n          options: {},\r\n        };\r\n      })\r\n      .filter((i) => i.qty > 0);\r\n\r\n    const payload = this.buildIlgeehData(userId, safeItems);\r\n\r\n    try {\r\n      const resp = await apiFetch(`/api/orders`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      const data = await resp.json().catch(() => ({}));\r\n\r\n      if (!resp.ok) {\r\n        alert(data?.error || \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u04AF\u04AF\u0441\u0433\u044D\u0445\u044D\u0434 \u0430\u043B\u0434\u0430\u0430 \u0433\u0430\u0440\u043B\u0430\u0430\");\r\n        return;\r\n      }\r\n\r\n      if (data?.customerId) {\r\n        localStorage.setItem(\"userId\", data.customerId);\r\n        this.tentsvvlehHereglegchMedeelel(data.customerId);\r\n      }\r\n\r\n      this.writeIdevhteiZahialga();\r\n      this.saveSanal(data);\r\n      this.hideBatalgaajiltModal();\r\n      this.guilgehSanalRuu();\r\n    } catch (e) {\r\n      alert(\"\u0421\u0435\u0440\u0432\u0435\u0440\u0442\u044D\u0439 \u0445\u043E\u043B\u0431\u043E\u0433\u0434\u043E\u0436 \u0447\u0430\u0434\u0441\u0430\u043D\u0433\u04AF\u0439\");\r\n    }\r\n  }\r\n\r\n  readNevtrelt() {\r\n    return {\r\n      userId: localStorage.getItem(\"userId\"),\r\n      registered: localStorage.getItem(\"userRegistered\") === \"1\",\r\n    };\r\n  }\r\n\r\n  shalgahUuid(value) {\r\n    const uuidRe = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n    return uuidRe.test(value || \"\");\r\n  }\r\n\r\n  buildIlgeehData(userId, safeItems) {\r\n    return {\r\n      customerId: userId || null,\r\n      fromPlaceId: this.pendingOrder.fromId,\r\n      toPlaceId: this.pendingOrder.toId,\r\n      scheduledAt: this.pendingOrder.createdAt,\r\n      deliveryFee: Number.isFinite(this.pendingOffer.deliveryFee) ? this.pendingOffer.deliveryFee : 0,\r\n      items: safeItems,\r\n      customerName: `${localStorage.getItem(\"userLastName\") || \"\"} ${localStorage.getItem(\"userName\") || \"\u0417\u043E\u0447\u0438\u043D \u0445\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\"}`.trim(),\r\n      customerPhone: localStorage.getItem(\"userPhone\") || \"00000000\",\r\n      customerStudentId: localStorage.getItem(\"userDisplayId\") || \"\",\r\n      note: this.pendingOrder.fromDetail ? `Pickup: ${this.pendingOrder.fromDetail}` : null,\r\n    };\r\n  }\r\n\r\n  writeIdevhteiZahialga() {\r\n    localStorage.setItem(\"activeOrder\", JSON.stringify(this.pendingOrder));\r\n    localStorage.setItem(\"orderStep\", \"0\");\r\n    window.dispatchEvent(new Event(\"order-updated\"));\r\n  }\r\n\r\n  saveSanal(data) {\r\n    const existingOffers = JSON.parse(localStorage.getItem(\"offers\") || \"[]\");\r\n    existingOffers.unshift({\r\n      ...this.pendingOffer,\r\n      orderId: data.orderId,\r\n      meta: this.formatTovch(this.pendingOrder.createdAt),\r\n      from: this.pendingOrder.from,\r\n      fromDetail: this.pendingOrder.fromDetail,\r\n      to: this.pendingOrder.to,\r\n      title: `${this.pendingOrder.from} - ${this.pendingOrder.to}`,\r\n      price: this.formatUne((data?.total ?? this.pendingOffer.total) || 0),\r\n      thumb: this.pendingOffer.thumb || \"assets/img/box.svg\",\r\n      sub: this.pendingOffer.items.map((it) => ({\r\n        name: `${it.name} x${it.qty}`,\r\n        price: this.formatUne(it.price * it.qty)\r\n      }))\r\n    });\r\n    localStorage.setItem(\"offers\", JSON.stringify(existingOffers));\r\n\r\n    const offersEl = document.querySelector(\"#offers\");\r\n    if (offersEl && \"items\" in offersEl) {\r\n      offersEl.items = existingOffers;\r\n    }\r\n  }\r\n\r\n  guilgehSanalRuu() {\r\n    const offersSection = document.querySelector(\"#offers\");\r\n    if (!offersSection || !offersSection.scrollIntoView) return;\r\n    setTimeout(() => {\r\n      offersSection.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\r\n    }, 150);\r\n  }\r\n}\r\n\r\ncustomElements.define(\"order-confirm\", OrderConfirm);\r\n", "// assets/components/orders.js\r\nclass DOrders extends HTMLElement {\r\n  connectedCallback() {\n    const isActive = this.hasAttribute('data-active');\n    let header = this.getAttribute('header') || '';\n    let detail = this.getAttribute('detail') || '';\n\n    this.innerHTML = `\n      <article class=\"order-card\">\n        <div class=\"order-info\">\n          <h3>${header}</h3>\n          <p>${detail}</p>\n        </div>\n        <button class=\"view-btn\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\">\r\n  <title>i</title>\r\n  <g id=\"Complete\">\r\n    <g id=\"expand\">\r\n      <g>\r\n        <polyline id=\"Right-2\" data-name=\"Right\" points=\"3 17.3 3 21 6.7 21\" fill=\"none\" stroke=\"#ffffff\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\r\n        <line x1=\"10\" y1=\"14\" x2=\"3.8\" y2=\"20.2\" fill=\"none\" stroke=\"#ffffff\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\r\n        <line x1=\"14\" y1=\"10\" x2=\"20.2\" y2=\"3.8\" fill=\"none\" stroke=\"#ffffff\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\r\n        <polyline id=\"Right-3\" data-name=\"Right\" points=\"21 6.7 21 3 17.3 3\" fill=\"none\" stroke=\"#ffffff\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"/>\r\n      </g>\r\n    </g>\r\n  </g>\r\n</svg></button>\r\n      </article>\n    `;\n\n    if (isActive) {\n      this.loadActiveOrder();\n    }\n  }\n\n  async loadActiveOrder() {\n    try {\n      const res = await fetch(\"/api/active-order\");\n      if (!res.ok) return;\n      const data = await res.json();\n      const order = data?.order;\n      if (!order) return;\n      const header = order.from && order.to ? `${order.from} \u2192 ${order.to}` : \"\";\n      const detail = order.item || \"\";\n      const titleEl = this.querySelector(\".order-info h3\");\n      const detailEl = this.querySelector(\".order-info p\");\n      if (titleEl) titleEl.textContent = header;\n      if (detailEl) detailEl.textContent = detail;\n    } catch (e) {\n      // ignore\n    }\n  }\n}\n\r\ncustomElements.define('d-orders', DOrders);\r\n", "class DelOrderDetails extends HTMLElement {\r\n  connectedCallback() {\r\n    // \u2705 \u044D\u0445\u043B\u044D\u044D\u0434 \u0445\u043E\u043E\u0441\u043E\u043D \u0431\u0430\u0439\u0434\u0430\u043B\u0442\u0430\u0439\r\n    this.renderEmpty();\r\n    this.handleDeliverySelect = (e) => {\r\n      const data = e.detail || null;\r\n      if (!data) {\r\n        this.renderEmpty();\r\n        return;\r\n      }\r\n      this.hasSelection = true;\r\n      this.render({\r\n        from: data.from || \"\",\r\n        to: data.to || \"\",\r\n        createdAt: data.createdAt || \"\",\r\n      });\r\n    };\r\n    document.addEventListener(\"delivery-select\", this.handleDeliverySelect);\r\n    this.loadOrder();\r\n  }\r\n\r\n  renderEmpty() {\r\n    // \u0437\u04E9\u0432\u0445\u04E9\u043D component \u0434\u043E\u0442\u043E\u0440\u0445 \u0445\u043E\u043E\u0441\u043E\u0440\u043D\u043E (section \u04AF\u043B\u0434\u044D\u043D\u044D)\r\n    this.innerHTML = \"\";\r\n  }\r\n\r\n  render(data = {}) {\r\n    const from = data.from || \"\";\r\n    const to = data.to || \"\";\r\n    const dateText = data.createdAt || \"\";\r\n\r\n    // \u0445\u044D\u0440\u044D\u0432 \u04E9\u0433\u04E9\u0433\u0434\u04E9\u043B\u0433\u04AF\u0439 \u0431\u043E\u043B \u0445\u043E\u043E\u0441\u043E\u043D \u0431\u0430\u0439\u043B\u0433\u0430\u043D\u0430\r\n    if (!from && !to && !dateText) {\r\n      this.renderEmpty();\r\n      return;\r\n    }\r\n\r\n    this.innerHTML = `\r\n      <div class=\"detail-header\">\r\n        <p><strong>${from}</strong> \u2192 <strong>${to}</strong></p>\r\n        <p class=\"date\">${dateText}</p>\r\n        <person-detail title=\"\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0433\u0447\u0438\u0439\u043D \u043C\u044D\u0434\u044D\u044D\u043B\u044D\u043B\" type=\"medium\"></person-detail>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  async loadOrder() {\r\n    // \u2705 delivery-page empty mode \u0430\u0441\u0430\u0430\u0441\u0430\u043D \u0431\u043E\u043B \u044E\u043C \u0445\u0430\u0440\u0443\u0443\u043B\u0430\u0445\u0433\u04AF\u0439\r\n    if (this.getAttribute(\"data-empty\") === \"1\") {\r\n      this.renderEmpty();\r\n      return;\r\n    }\r\n    if (this.hasSelection) return;\r\n\r\n    try {\r\n      const res = await fetch(\"/api/active-order\");\r\n      if (!res.ok) {\r\n        this.renderEmpty();\r\n        return;\r\n      }\r\n\r\n      const data = await res.json();\r\n      const order = data?.order;\r\n      if (!order) {\r\n        this.renderEmpty();\r\n        return;\r\n      }\r\n\r\n      let dateText = order.createdAt || \"\";\r\n      if (order.createdAt) {\r\n        const dt = new Date(order.createdAt);\r\n        const pad = (n) => n.toString().padStart(2, \"0\");\r\n        dateText = `${dt.getFullYear()}.${pad(dt.getMonth() + 1)}.${pad(dt.getDate())} \u2022 ${pad(dt.getHours())}:${pad(dt.getMinutes())}`;\r\n      }\r\n\r\n      this.render({ from: order.from, to: order.to, createdAt: dateText });\r\n    } catch (e) {\r\n      this.renderEmpty();\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.handleDeliverySelect) {\r\n      document.removeEventListener(\"delivery-select\", this.handleDeliverySelect);\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(\"del-order-details\", DelOrderDetails);\r\n", "export const ORDERS = [\r\n  {\r\n    id: \"o1\",\r\n    title: \"GL Burger - 7-\u0440 \u0431\u0430\u0439\u0440 207\",\r\n    summary: \"3 \u0448\u0438\u0440\u0445\u044D\u0433 \u2022 10,000\u20AE\",\r\n    from: \"GL Burger\",\r\n    to: \"\u041C\u0423\u0418\u0421 7-\u0440 \u0431\u0430\u0439\u0440\",\r\n    datetime: \"2025.10.08 \u2022 09:36\",\r\n    total: \"37,000\u20AE\",\r\n    items: [\r\n      \"XL \u0431\u0430\u0433\u0446: 10,000\u20AE\",\r\n      \"M \u0431\u0430\u0433\u0446: 8,000\u20AE\",\r\n      \"L \u0431\u0430\u0433\u0446: 9,000\u20AE\"\r\n    ],\r\n    courier: {\r\n      name: \"\u0427\u0438\u0433\u0446\u0430\u043B\u043C\u0430\u0430\",\r\n      phone: \"99001234\",\r\n      id: \"23B1NUM0245\",\r\n      avatar: \"assets/img/profile.jpg\"\r\n    },\r\n    defaultStep: 0\r\n  },\r\n  {\r\n    id: \"o2\",\r\n    title: \"CU - 8-\u0440 \u0431\u0430\u0439\u0440 209\",\r\n    summary: \"1 \u0448\u0438\u0440\u0445\u044D\u0433 \u2022 5,000\u20AE\",\r\n    from: \"CU\",\r\n    to: \"\u041C\u0423\u0418\u0421 8-\u0440 \u0431\u0430\u0439\u0440\",\r\n    datetime: \"2025.10.08 \u2022 10:15\",\r\n    total: \"5,000\u20AE\",\r\n    items: [\r\n      \"\u041A\u043E\u043B\u0430 0.5\u043B: 2,500\u20AE\",\r\n      \"\u0427\u0438\u043F\u0441: 2,500\u20AE\"\r\n    ],\r\n    courier: {\r\n      name: \"\u0411\u0430\u0442-\u041E\u0440\u0433\u0438\u043B\",\r\n      phone: \"88112233\",\r\n      id: \"23B1NUM0312\",\r\n      avatar: \"assets/img/profile.jpg\"\r\n    },\r\n    defaultStep: 1\r\n  }\r\n];\r\n\r\nconst STEPS_KEY = \"deliverySteps\";\r\n\r\nexport function loadSteps() {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(STEPS_KEY)) || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport function saveSteps(steps) {\r\n  localStorage.setItem(STEPS_KEY, JSON.stringify(steps));\r\n}\r\n\r\nexport function getOrderById(id) {\r\n  return ORDERS.find(o => String(o.id) === String(id)) || ORDERS[0];\r\n}\r\n", "import { ORDERS, getOrderById, loadSteps, saveSteps } from \"./delivery-data.js\";\r\n\r\nconst STEP_LABELS = [\r\n  \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u0431\u044D\u043B\u0442\u0433\u044D\u0445\",\r\n  \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u044D\u043D\u0434 \u0433\u0430\u0440\u0441\u0430\u043D\",\r\n  \"\u0410\u043C\u0436\u0438\u043B\u0442\u0442\u0430\u0439 \u0445\u04AF\u0440\u0433\u044D\u0441\u044D\u043D\"\r\n];\r\n\r\nclass DelOrderProgress extends HTMLElement {\r\n  connectedCallback() {\r\n    this.stepsState = loadSteps();\r\n    this.currentId = ORDERS[0]?.id || null;\r\n    this.activeOrder = null;\r\n    this.handleDeliverySelect = (e) => {\r\n      const data = e.detail || null;\r\n      const selectedId = data?.orderId || data?.id || null;\r\n      if (!selectedId) return;\r\n      this.userSelected = true;\r\n      this.activeOrder = { id: selectedId };\r\n      this.currentId = selectedId;\r\n      this.render();\r\n    };\r\n    this.handleOrderSelect = (e) => {\r\n      this.currentId = e.detail.id;\r\n      this.render();\r\n    };\r\n    this.handleOrderUpdated = this.loadActiveOrder.bind(this);\r\n\r\n    this.render();\r\n    this.loadActiveOrder();\r\n\r\n    document.addEventListener(\"order-select\", this.handleOrderSelect);\r\n    document.addEventListener(\"delivery-select\", this.handleDeliverySelect);\r\n    window.addEventListener(\"order-updated\", this.handleOrderUpdated);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    document.removeEventListener(\"order-select\", this.handleOrderSelect);\r\n    document.removeEventListener(\"delivery-select\", this.handleDeliverySelect);\r\n    window.removeEventListener(\"order-updated\", this.handleOrderUpdated);\r\n    if (this._ratingTimer) {\r\n      clearInterval(this._ratingTimer);\r\n      this._ratingTimer = null;\r\n    }\r\n\r\n  }\r\n\r\n  async loadActiveOrder() {\r\n    try {\r\n      const res = await fetch(\"/api/active-order\", { credentials: \"include\" });\r\n      if (!res.ok) return;\r\n      const data = await res.json();\r\n      const order = data?.order || null;\r\n      if (this.userSelected) return;\r\n      this.activeOrder = order;\r\n      const activeId = order?.orderId || order?.id || null;\r\n      if (activeId) this.currentId = activeId;\r\n      this.render();\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  getCurrentStep() {\r\n    const order = this.getCurrentOrder();\r\n    if (!order) return 0;\r\n\r\n    const saved = this.stepsState[order.id];\r\n    if (saved === 0 || saved) return saved;\r\n    return order.defaultStep || 0;\r\n  }\r\n\r\n  getCurrentOrder() {\r\n    if (this.activeOrder) {\r\n      const id = this.activeOrder.orderId || this.activeOrder.id || null;\r\n      if (id) return { id, defaultStep: 0 };\r\n    }\r\n    return getOrderById(this.currentId);\r\n  }\r\n\r\n  isUuid(value) {\r\n    return /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(\r\n      String(value || \"\")\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (this.getAttribute(\"data-empty\") === \"1\") {\r\n      this.innerHTML = \"\";\r\n      return;\r\n    }\r\n    const stepIndex = this.getCurrentStep();\r\n    const order = this.getCurrentOrder();\r\n\r\n    if (!order) {\r\n      this.innerHTML = \"<p>\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u0430 \u043E\u043B\u0434\u0441\u043E\u043D\u0433\u04AF\u0439.</p>\";\r\n      return;\r\n    }\r\n\r\n    this.innerHTML = `\r\n      <div class=\"order-progress\">\r\n        ${STEP_LABELS.map((label, idx) => `\r\n          <div class=\"step\r\n            ${idx < stepIndex ? \"completed\" : \"\"}\r\n            ${idx === stepIndex ? \"active\" : \"\"}\"\r\n            data-step=\"${idx}\">\r\n            <div class=\"step-indicator\">\r\n              <svg viewBox=\"0 0 24 24\">\r\n                <path d=\"M12 2C8.962 2 6.5 4.462 6.5 7.5C6.5 11.438 12 18 12 18C12 18 17.5 11.438 17.5 7.5C17.5 4.462 15.038 2 12 2ZM12 9.5C10.895 9.5 10 8.605 10 7.5C10 6.395 10.895 5.5 12 5.5C13.105 5.5 14 6.395 14 7.5C14 8.605 13.105 9.5 12 9.5Z\"/>\r\n              </svg>\r\n            </div>\r\n            <div>\r\n              <div class=\"step-label\">${label}</div>\r\n              <p class=\"step-desc\">\r\n                ${idx === 0\r\n        ? \"\u0417\u0430\u0445\u0438\u0430\u043B\u0433\u044B\u0433 \u0431\u044D\u043B\u0442\u0433\u044D\u0436 \u0434\u0443\u0443\u0441\u0441\u0430\u043D\u044B \u0434\u0430\u0440\u0430\u0430 \u0434\u0430\u0440\u0430\u0430\u0433\u0438\u0439\u043D \u0430\u043B\u0445\u0430\u043C \u0440\u0443\u0443 \u0448\u0438\u043B\u0436\u0438\u043D\u044D.\"\r\n        : idx === 1\r\n          ? \"\u0425\u04AF\u0440\u0433\u044D\u043B\u0442\u044D\u043D\u0434 \u0433\u0430\u0440\u0441\u0430\u043D \u04AF\u0435\u0434 \u0434\u0430\u0440\u0430\u0430\u0433\u0438\u0439\u043D \u0430\u043B\u0445\u0430\u043C\u044B\u0433 \u0434\u0430\u0440\u043D\u0430.\"\r\n          : \"\u0425\u044D\u0440\u044D\u0433\u043B\u044D\u0433\u0447\u0438\u0434 \u0445\u04AF\u043B\u044D\u044D\u043B\u0433\u044D\u043D \u04E9\u0433\u0447 \u0434\u0443\u0443\u0441\u0441\u0430\u043D \u04AF\u0435\u0434 \u0442\u04E9\u0433\u0441\u04E9\u043D\u04E9.\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        `).join(\"\")}\r\n      </div>\r\n      <button class=\"next-btn\" type=\"button\">Next</button>\r\n    `;\r\n\r\n    const nextBtn = this.querySelector(\".next-btn\");\r\n    nextBtn.addEventListener(\"click\", () => {\r\n      const current = this.getCurrentStep();\r\n      const maxIndex = STEP_LABELS.length - 1;\r\n\r\n      // \u2705 Delivered \u0434\u044D\u044D\u0440 \u0434\u0430\u0445\u0438\u0436 Next \u0434\u0430\u0440\u0443\u0443\u043B\u0430\u0445\u0433\u04AF\u0439\r\n      if (current >= maxIndex) {\r\n        nextBtn.disabled = true;\r\n        nextBtn.textContent = \"\u04AE\u043D\u044D\u043B\u0433\u044D\u044D \u0445\u04AF\u043B\u044D\u044D\u0436 \u0431\u0430\u0439\u043D\u0430\";\r\n        nextBtn.style.opacity = \"0.6\";\r\n        this.startRatingPoll(order.id);\r\n        alert(\"\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0433\u0447 \u04AF\u043D\u044D\u043B\u0433\u044D\u044D \u04E9\u0433\u0441\u043D\u0438\u0439 \u0434\u0430\u0440\u0430\u0430 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0430\u0430\u0440 \u0434\u0443\u0443\u0441\u043D\u0430.\");\r\n        return;\r\n      }\r\n\r\n      const nextIdx = current + 1;\r\n\r\n      this.stepsState[order.id] = nextIdx;\r\n      saveSteps(this.stepsState);\r\n\r\n      localStorage.setItem(\"orderStep\", String(nextIdx));\r\n\r\n      const orderId = order.id;\r\n      if (this.isUuid(orderId)) {\r\n        this.updateOrderStatus(orderId, nextIdx);\r\n      }\r\n\r\n      if (nextIdx === maxIndex) {\r\n        // \u2705 Delivered \u0431\u043E\u043B\u0441\u043E\u043D: \u0443\u0441\u0442\u0433\u0430\u0445\u0433\u04AF\u0439, \u04AF\u043D\u044D\u043B\u0433\u044D\u044D \u0438\u0440\u0442\u044D\u043B \u0445\u04AF\u043B\u044D\u044D\u043D\u044D\r\n        localStorage.setItem(\"deliveryAwaitRating\", \"1\");\r\n        this.startRatingPoll(order.id);\r\n      }\r\n\r\n\r\n\r\n      this.render();\r\n    });\r\n\r\n  }\r\n\r\n  async updateOrderStatus(orderId, stepIndex) {\r\n    const statusMap = {\r\n      1: \"delivering\",\r\n      2: \"delivered\",\r\n    };\r\n    const status = statusMap[stepIndex] || \"created\";\r\n    try {\r\n      const res = await fetch(`/api/orders/${encodeURIComponent(orderId)}/status`, {\r\n        method: \"PATCH\",\r\n        credentials: \"include\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ status }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json().catch(() => ({}));\r\n        console.warn(\"status update failed\", err?.error || res.status);\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"status update error\", e);\r\n    }\r\n  }\r\n  startRatingPoll(orderId) {\r\n    if (this._ratingTimer) return;\r\n\r\n    this._ratingTimer = setInterval(async () => {\r\n      try {\r\n        // \u2705 courier \u04E9\u04E9\u0440\u0438\u0439\u043D id-\u0433 \u0430\u0432\u043D\u0430\r\n        const meRes = await fetch(\"/api/auth/me\", { credentials: \"include\" });\r\n        if (!meRes.ok) return;\r\n        const me = await meRes.json();\r\n        const courierId = me?.user?.id;\r\n        if (!courierId) return;\r\n\r\n        // \u2705 courier-\u0434 \u0438\u0440\u0441\u044D\u043D ratings-\u0430\u0430\u0441 \u044D\u043D\u044D order \u04AF\u043D\u044D\u043B\u044D\u0433\u0434\u0441\u044D\u043D \u044D\u0441\u044D\u0445\u0438\u0439\u0433 \u0448\u0430\u043B\u0433\u0430\u043D\u0430\r\n        const rRes = await fetch(`/api/ratings/courier/${encodeURIComponent(courierId)}`, {\r\n          credentials: \"include\",\r\n        });\r\n        if (!rRes.ok) return;\r\n        const data = await rRes.json();\r\n        const items = data?.items || [];\r\n\r\n        const rated = items.some(r => String(r.order_id) === String(orderId));\r\n        if (!rated) return;\r\n\r\n        // \u2705 \u04AF\u043D\u044D\u043B\u0433\u044D\u044D \u043E\u0440\u0441\u043E\u043D \u0431\u0430\u0439\u043D\u0430 \u2192 \u043E\u0434\u043E\u043E \u043B courier \u0442\u0430\u043B \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u043D\u044D\r\n        clearInterval(this._ratingTimer);\r\n        this._ratingTimer = null;\r\n\r\n        // local steps \u0446\u044D\u0432\u044D\u0440\u043B\u044D\u044D\u0434 \u0434\u0430\u0440\u0430\u0430 \u043D\u044C reset\r\n        delete this.stepsState[orderId];\r\n        saveSteps(this.stepsState);\r\n        localStorage.removeItem(\"deliveryAwaitRating\");\r\n\r\n        window.NumAppState?.resetToGuest(\"rating_done\");\r\n      } catch {\r\n        // ignore\r\n      }\r\n    }, 3000); // 3 \u0441\u0435\u043A\u0443\u043D\u0434 \u0442\u0443\u0442\u0430\u043C\r\n  }\r\n\r\n}\r\n\r\ncustomElements.define(\"del-order-progress\", DelOrderProgress);\r\n", "class PersonDetail extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    connectedCallback() {\n        this.title=this.getAttribute(\"title\") ?? \"\";\n        this.type=this.getAttribute(\"type\") ?? \"medium\";\n\n        this.render();\n\n        this.handleUserUpdated = this.loadData.bind(this);\n        window.addEventListener(\"user-updated\", this.handleUserUpdated);\n        this.loadData();\n    }\n\n    disconnectedCallback() {\n      if (this.handleUserUpdated) {\n        window.removeEventListener(\"user-updated\", this.handleUserUpdated);\n      }\n    }\n\r\n    attributeChangedCallback(name, oldVal, newVal) {\r\n    }\r\n\r\n    adoptedCallback() {\n    }\n\n    render() {\n      const orderCustomer = this.orderCustomer || null;\n      const rawName = orderCustomer?.name || \"\u0427\u0438\u0433\u0446\u0430\u043B\u043C\u0430\u0430\";\n      const name = this.normalizeName(rawName);\n      const phone = orderCustomer?.phone || \"99001234\";\n      const displayId = orderCustomer?.studentId || \"23b1num0245\";\n      const avatar = orderCustomer?.avatar || \"assets/img/profile.jpg\";\n\n      this.innerHTML=`\n        <p style=\"font-weight: bold; font-size: 1rem;\">${this.title}</p>\n        <div class=\"delivery ${this.type==\"medium\" ? \"\" : \"big\"}\">\n          <img src=\"${this.escape(avatar)}\" alt=\"\u0417\u0430\u0445\u0438\u0430\u043B\u0430\u0433\u0447\u0438\u0439\u043D \u0437\u0443\u0440\u0430\u0433\">\n          <div class=\"delivery-info\">\n            <h3>\u041D\u044D\u0440: ${this.escape(name)}</h3>\n            <p>\u0423\u0442\u0430\u0441: ${this.escape(phone)}</p>\n            <p>ID: ${this.escape(displayId)}</p>\n          </div>\n        </div>`;\n\n      const deliveryBlock = this.querySelector(\"div.delivery\");\n      if (deliveryBlock) {\n        deliveryBlock.addEventListener(\"click\", () => {\n          const card = document.querySelector(\"numd-deliverycard\");\n          if (card && typeof card.addDelivery === \"function\") {\n            card.addDelivery(this);\n          }\n        });\n      }\n    }\n\n    escape(s) {\n      return String(s || \"\").replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\\\"/g,\"&quot;\");\n    }\n\n    normalizeName(value) {\n      const raw = String(value || \"\").trim();\n      if (!raw) return \"\u0427\u0438\u0433\u0446\u0430\u043B\u043C\u0430\u0430\";\n      const tokens = raw.split(/\\s+/).filter((t) => t && t.length > 1);\n      return tokens.length ? tokens.join(\" \") : raw;\n    }\n\n    async loadData() {\n      try {\n        const res = await fetch(\"/api/auth/me\");\n        if (res.ok) {\n          const data = await res.json();\n          this.currentUser = data?.user || null;\n        } else {\n          this.currentUser = null;\n        }\n      } catch (e) {\n        this.currentUser = null;\n      }\n\n      try {\n        const res = await fetch(\"/api/active-order\");\n        if (res.ok) {\n          const data = await res.json();\n          this.orderCustomer = data?.order?.customer || null;\n        } else {\n          this.orderCustomer = null;\n        }\n      } catch (e) {\n        this.orderCustomer = null;\n      }\n\n      this.render();\n    }\n}\n\nwindow.customElements.define('person-detail', PersonDetail);\n", "const API = \"http://localhost:3000\";\r\n\r\nclass Couriers extends HTMLElement {\r\n  connectedCallback() {\r\n    this.render();\r\n    this.loadCourier();\r\n  }\r\n\r\n  async loadCourier() {\r\n    try {\r\n      const r = await fetch(`${API}/api/courier/me`);\r\n      if (!r.ok) throw new Error(\"courier not found\");\r\n      const courier = await r.json();\r\n\r\n      if (courier) this.setData(courier);\r\n    } catch {\r\n      this.setEmpty();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.innerHTML = `\r\n      <article class=\"courier-card\">\r\n        <div class=\"delivery loading\">\r\n          <div class=\"avatar skeleton\"></div>\r\n          <div class=\"delivery-info\">\r\n            <div class=\"line skeleton\"></div>\r\n            <div class=\"line skeleton short\"></div>\r\n            <div class=\"line skeleton short\"></div>\r\n          </div>\r\n        </div>\r\n      </article>\r\n    `;\r\n  }\r\n\r\n  setData({ name, phone, courier_id}) {\r\n    \r\n    this.innerHTML = `\r\n      <article class=\"courier-card\">\r\n        <div class=\"delivery\">\r\n          <div class=\"avatar\">\r\n            <img src=\"assets/img/profile.jpg\" alt=\"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0439\u043D \u0437\u0443\u0440\u0430\u0433\">\r\n          </div>\r\n          <div class=\"courier-info\">\r\n            <h3>\u041D\u044D\u0440 : ${this.escape(name || \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\")}</h3>\r\n            <p>${phone ? `\u0423\u0442\u0430\u0441: ${this.escape(phone || \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\")}` : \"\"}</p>\r\n            <p>${courier_id ? `\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0439\u043D ID: ${this.escape(courier_id || \"\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\")}` : \"\"}</p>\r\n          </div>\r\n        </div>\r\n      </article>\r\n    `;\r\n  }\r\n\r\n  setEmpty() {\r\n    this.innerHTML = `\r\n      <article class=\"courier-card\">\r\n        <p class=\"muted\">\u0425\u04AF\u0440\u0433\u044D\u0433\u0447\u0438\u0439\u043D \u043C\u044D\u0434\u044D\u044D\u043B\u044D\u043B \u043E\u043B\u0434\u0441\u043E\u043D\u0433\u04AF\u0439.</p>\r\n      </article>\r\n    `;\r\n  }\r\n\r\n  escape(s) {\r\n    return String(s || \"\").replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\\\"/g,\"&quot;\");\r\n  }\r\n\r\n  generateDisplayId(name, phone) {\r\n    if (!name || !phone) return '';\r\n    const namePart = name.substring(0, 3).toUpperCase();\r\n    const phonePart = phone.substring(phone.length - 4);\r\n    return `${namePart}${phonePart}`;\r\n  }\r\n}\r\n\r\ncustomElements.define(\"couriers-card\", Couriers);", "class RatingStars extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: 'open' });\r\n    this.value = 0;\r\n  }\r\n\r\n  connectedCallback() {\r\n    const max = parseInt(this.getAttribute('max')) || 5;\r\n    const color = this.getAttribute('color') || 'gold';\r\n    const size = this.getAttribute('size') || '26px';\r\n\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      .rating {\r\n        display: flex;\r\n        gap: 5px;\r\n        cursor: pointer;\r\n        justify-content: center;\r\n      }\r\n      .star {\r\n        font-size: ${size};\r\n        color: #ccc;\r\n        transition: color 0.25s;\r\n      }\r\n      .star.filled {\r\n        color: ${color};\r\n      }\r\n    `;\r\n\r\n    const container = document.createElement('div');\r\n    container.classList.add('rating');\r\n\r\n    for (let i = 1; i <= max; i++) {\r\n      const span = document.createElement('span');\r\n      span.textContent = '\u2605';\r\n      span.classList.add('star');\r\n\r\n      span.addEventListener('mouseover', () => this.updateStars(i));\r\n      span.addEventListener('mouseout', () => this.updateStars(this.value));\r\n\r\n      span.addEventListener('click', () => {\r\n        this.value = i;\r\n        this.setAttribute('value', i);\r\n        this.dispatchEvent(new CustomEvent('rate', { detail: i }));\r\n      });\r\n\r\n      container.appendChild(span);\r\n    }\r\n\r\n    this.shadowRoot.append(style, container);\r\n  }\r\n\r\n  updateStars(count) {\r\n    const stars = this.shadowRoot.querySelectorAll('.star');\r\n    stars.forEach((s, idx) => {\r\n      s.classList.toggle('filled', idx < count);\r\n    });\r\n  }\r\n}\r\n\r\ncustomElements.define('rating-stars', RatingStars);"],
  "mappings": "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",
  "names": ["getState", "details", "progress", "API", "box", "layout", "API"]
}
